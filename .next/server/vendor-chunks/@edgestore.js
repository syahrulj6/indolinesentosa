"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "vendor-chunks/@edgestore";
exports.ids = ["vendor-chunks/@edgestore"];
exports.modules = {

/***/ "(ssr)/./node_modules/@edgestore/react/dist/index.mjs":
/*!******************************************************!*\
  !*** ./node_modules/@edgestore/react/dist/index.mjs ***!
  \******************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createEdgeStoreProvider: () => (/* binding */ createEdgeStoreProvider)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var _edgestore_shared__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @edgestore/shared */ \"(ssr)/./node_modules/@edgestore/shared/dist/index.mjs\");\n\n\n\nclass EdgeStoreClientError extends Error {\n    constructor(message){\n        super(message);\n        this.name = 'EdgeStoreError';\n    }\n}\n\nasync function handleError(res) {\n    let json = {};\n    try {\n        json = await res.json();\n    } catch (err) {\n        throw new EdgeStoreClientError(`Failed to parse response. Make sure the api is correctly configured at ${res.url}`);\n    }\n    throw new _edgestore_shared__WEBPACK_IMPORTED_MODULE_1__.EdgeStoreApiClientError({\n        response: json\n    });\n}\n\nfunction createNextProxy({ apiPath, uploadingCountRef, maxConcurrentUploads = 5 }) {\n    return new Proxy({}, {\n        get (_, prop) {\n            const bucketName = prop;\n            const bucketFunctions = {\n                upload: async (params)=>{\n                    try {\n                        params.onProgressChange?.(0);\n                        while(uploadingCountRef.current >= maxConcurrentUploads && uploadingCountRef.current > 0){\n                            await new Promise((resolve)=>setTimeout(resolve, 300));\n                        }\n                        uploadingCountRef.current++;\n                        const test = await uploadFile(params, {\n                            bucketName: bucketName,\n                            apiPath\n                        });\n                        return test;\n                    } finally{\n                        uploadingCountRef.current--;\n                    }\n                },\n                confirmUpload: async (params)=>{\n                    const { success } = await confirmUpload(params, {\n                        bucketName: bucketName,\n                        apiPath\n                    });\n                    if (!success) {\n                        throw new EdgeStoreClientError('Failed to confirm upload');\n                    }\n                },\n                delete: async (params)=>{\n                    const { success } = await deleteFile(params, {\n                        bucketName: bucketName,\n                        apiPath\n                    });\n                    if (!success) {\n                        throw new EdgeStoreClientError('Failed to delete file');\n                    }\n                }\n            };\n            return bucketFunctions;\n        }\n    });\n}\nasync function uploadFile({ file, input, onProgressChange, options }, { apiPath, bucketName }) {\n    try {\n        onProgressChange?.(0);\n        const res = await fetch(`${apiPath}/request-upload`, {\n            method: 'POST',\n            credentials: 'include',\n            body: JSON.stringify({\n                bucketName,\n                input,\n                fileInfo: {\n                    extension: file.name.split('.').pop(),\n                    type: file.type,\n                    size: file.size,\n                    fileName: options?.manualFileName,\n                    replaceTargetUrl: options?.replaceTargetUrl,\n                    temporary: options?.temporary\n                }\n            }),\n            headers: {\n                'Content-Type': 'application/json'\n            }\n        });\n        if (!res.ok) {\n            await handleError(res);\n        }\n        const json = await res.json();\n        if ('multipart' in json) {\n            await multipartUpload({\n                bucketName,\n                multipartInfo: json.multipart,\n                onProgressChange,\n                file,\n                apiPath\n            });\n        } else if ('uploadUrl' in json) {\n            // Single part upload\n            // Upload the file to the signed URL and get the progress\n            await uploadFileInner(file, json.uploadUrl, onProgressChange);\n        } else {\n            throw new EdgeStoreClientError('An error occurred');\n        }\n        return {\n            url: getUrl(json.accessUrl, apiPath),\n            thumbnailUrl: json.thumbnailUrl ? getUrl(json.thumbnailUrl, apiPath) : null,\n            size: json.size,\n            uploadedAt: new Date(json.uploadedAt),\n            path: json.path,\n            pathOrder: json.pathOrder,\n            metadata: json.metadata\n        };\n    } catch (e) {\n        onProgressChange?.(0);\n        throw e;\n    }\n}\n/**\n * Protected files need third-party cookies to work.\n * Since third party cookies doesn't work on localhost,\n * we need to proxy the file through the server.\n */ function getUrl(url, apiPath) {\n    const mode = typeof process !== 'undefined' ? \"development\" :  false ? 0 : 'production';\n    if (mode === 'development' && !url.includes('/_public/')) {\n        const proxyUrl = new URL(window.location.origin);\n        proxyUrl.pathname = `${apiPath}/proxy-file`;\n        proxyUrl.search = new URLSearchParams({\n            url\n        }).toString();\n        return proxyUrl.toString();\n    }\n    return url;\n}\nconst uploadFileInner = async (file, uploadUrl, onProgressChange)=>{\n    const promise = new Promise((resolve, reject)=>{\n        const request = new XMLHttpRequest();\n        request.open('PUT', uploadUrl);\n        // This is for Azure provider. Specifies the blob type\n        request.setRequestHeader('x-ms-blob-type', 'BlockBlob');\n        request.addEventListener('loadstart', ()=>{\n            onProgressChange?.(0);\n        });\n        request.upload.addEventListener('progress', (e)=>{\n            if (e.lengthComputable) {\n                // 2 decimal progress\n                const progress = Math.round(e.loaded / e.total * 10000) / 100;\n                onProgressChange?.(progress);\n            }\n        });\n        request.addEventListener('error', ()=>{\n            reject(new Error('Error uploading file'));\n        });\n        request.addEventListener('abort', ()=>{\n            reject(new Error('File upload aborted'));\n        });\n        request.addEventListener('loadend', ()=>{\n            // Return the ETag header (needed to complete multipart upload)\n            resolve(request.getResponseHeader('ETag'));\n        });\n        request.send(file);\n    });\n    return promise;\n};\nasync function multipartUpload(params) {\n    const { bucketName, multipartInfo, onProgressChange, file, apiPath } = params;\n    const { partSize, parts, totalParts, uploadId, key } = multipartInfo;\n    const uploadingParts = [];\n    const uploadPart = async (params)=>{\n        const { part, chunk } = params;\n        const { uploadUrl } = part;\n        const eTag = await uploadFileInner(chunk, uploadUrl, (progress)=>{\n            const uploadingPart = uploadingParts.find((p)=>p.partNumber === part.partNumber);\n            if (uploadingPart) {\n                uploadingPart.progress = progress;\n            } else {\n                uploadingParts.push({\n                    partNumber: part.partNumber,\n                    progress\n                });\n            }\n            const totalProgress = Math.round(uploadingParts.reduce((acc, p)=>acc + p.progress * 100, 0) / totalParts) / 100;\n            onProgressChange?.(totalProgress);\n        });\n        if (!eTag) {\n            throw new EdgeStoreClientError('Could not get ETag from multipart response');\n        }\n        return {\n            partNumber: part.partNumber,\n            eTag\n        };\n    };\n    // Upload the parts in parallel\n    const completedParts = await queuedPromises({\n        items: parts.map((part)=>({\n                part,\n                chunk: file.slice((part.partNumber - 1) * partSize, part.partNumber * partSize)\n            })),\n        fn: uploadPart,\n        maxParallel: 5,\n        maxRetries: 10\n    });\n    // Complete multipart upload\n    const res = await fetch(`${apiPath}/complete-multipart-upload`, {\n        method: 'POST',\n        credentials: 'include',\n        body: JSON.stringify({\n            bucketName,\n            uploadId,\n            key,\n            parts: completedParts\n        }),\n        headers: {\n            'Content-Type': 'application/json'\n        }\n    });\n    if (!res.ok) {\n        await handleError(res);\n    }\n}\nasync function confirmUpload({ url }, { apiPath, bucketName }) {\n    const res = await fetch(`${apiPath}/confirm-upload`, {\n        method: 'POST',\n        credentials: 'include',\n        body: JSON.stringify({\n            url,\n            bucketName\n        }),\n        headers: {\n            'Content-Type': 'application/json'\n        }\n    });\n    if (!res.ok) {\n        await handleError(res);\n    }\n    return res.json();\n}\nasync function deleteFile({ url }, { apiPath, bucketName }) {\n    const res = await fetch(`${apiPath}/delete-file`, {\n        method: 'POST',\n        credentials: 'include',\n        body: JSON.stringify({\n            url,\n            bucketName\n        }),\n        headers: {\n            'Content-Type': 'application/json'\n        }\n    });\n    if (!res.ok) {\n        await handleError(res);\n    }\n    return res.json();\n}\nasync function queuedPromises({ items, fn, maxParallel, maxRetries = 0 }) {\n    const results = new Array(items.length);\n    const executeWithRetry = async (func, retries)=>{\n        try {\n            return await func();\n        } catch (error) {\n            if (retries > 0) {\n                await new Promise((resolve)=>setTimeout(resolve, 5000));\n                return executeWithRetry(func, retries - 1);\n            } else {\n                throw error;\n            }\n        }\n    };\n    const semaphore = {\n        count: maxParallel,\n        async wait () {\n            // If we've reached our maximum concurrency or it's the last item, wait\n            while(this.count <= 0)await new Promise((resolve)=>setTimeout(resolve, 500));\n            this.count--;\n        },\n        signal () {\n            this.count++;\n        }\n    };\n    const tasks = items.map((item, i)=>(async ()=>{\n            await semaphore.wait();\n            try {\n                const result = await executeWithRetry(()=>fn(item), maxRetries);\n                results[i] = result;\n            } finally{\n                semaphore.signal();\n            }\n        })());\n    await Promise.all(tasks);\n    return results;\n}\n\nconst DEFAULT_BASE_URL = (typeof process !== 'undefined' ? process.env.NEXT_PUBLIC_EDGE_STORE_BASE_URL :  undefined) ?? 'https://files.edgestore.dev';\nfunction createEdgeStoreProvider(opts) {\n    const EdgeStoreContext = /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createContext(undefined);\n    const EdgeStoreProvider = ({ children, basePath })=>{\n        return EdgeStoreProviderInner({\n            children,\n            context: EdgeStoreContext,\n            basePath,\n            maxConcurrentUploads: opts?.maxConcurrentUploads\n        });\n    };\n    function useEdgeStore() {\n        if (!EdgeStoreContext) {\n            throw new Error('React Context is unavailable in Server Components');\n        }\n        // @ts-expect-error - We know that the context value should not be undefined\n        const value = react__WEBPACK_IMPORTED_MODULE_0__.useContext(EdgeStoreContext);\n        if (!value && \"development\" !== 'production') {\n            throw new Error('[edgestore]: `useEdgeStore` must be wrapped in a <EdgeStoreProvider />');\n        }\n        return value;\n    }\n    return {\n        EdgeStoreProvider,\n        useEdgeStore\n    };\n}\nfunction EdgeStoreProviderInner({ children, context, basePath, maxConcurrentUploads }) {\n    const apiPath = basePath ? `${basePath}` : '/api/edgestore';\n    const [state, setState] = react__WEBPACK_IMPORTED_MODULE_0__.useState({\n        loading: true,\n        initialized: false,\n        error: false\n    });\n    const uploadingCountRef = react__WEBPACK_IMPORTED_MODULE_0__.useRef(0);\n    const initExecuted = react__WEBPACK_IMPORTED_MODULE_0__.useRef(false); // to make sure we don't run init twice\n    react__WEBPACK_IMPORTED_MODULE_0__.useEffect(()=>{\n        if (!initExecuted.current) {\n            void init();\n        }\n        return ()=>{\n            initExecuted.current = true;\n        };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, []);\n    async function init() {\n        try {\n            setState({\n                loading: true,\n                initialized: false,\n                error: false\n            });\n            const res = await fetch(`${apiPath}/init`, {\n                method: 'POST',\n                credentials: 'include'\n            });\n            if (res.ok) {\n                const json = await res.json();\n                const innerRes = await fetch(`${DEFAULT_BASE_URL}/_init`, {\n                    method: 'GET',\n                    credentials: 'include',\n                    headers: {\n                        'x-edgestore-token': json.token\n                    }\n                });\n                if (innerRes.ok) {\n                    // update state\n                    setState({\n                        loading: false,\n                        initialized: true,\n                        error: false\n                    });\n                } else {\n                    setState({\n                        loading: false,\n                        initialized: false,\n                        error: true\n                    });\n                    throw new EdgeStoreClientError(\"Couldn't initialize Edge Store.\");\n                }\n            } else {\n                setState({\n                    loading: false,\n                    initialized: false,\n                    error: true\n                });\n                await handleError(res);\n            }\n        } catch (err) {\n            setState({\n                loading: false,\n                initialized: false,\n                error: true\n            });\n            throw err;\n        }\n    }\n    async function reset() {\n        await init();\n    }\n    return /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment, null, /*#__PURE__*/ react__WEBPACK_IMPORTED_MODULE_0__.createElement(context.Provider, {\n        value: {\n            edgestore: createNextProxy({\n                apiPath,\n                uploadingCountRef,\n                maxConcurrentUploads\n            }),\n            reset,\n            state\n        }\n    }, children));\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGVkZ2VzdG9yZS9yZWFjdC9kaXN0L2luZGV4Lm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBK0I7QUFDNkI7O0FBRTVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTixpSEFBaUgsUUFBUTtBQUN6SDtBQUNBLGNBQWMsc0VBQXVCO0FBQ3JDO0FBQ0EsS0FBSztBQUNMOztBQUVBLDJCQUEyQixzREFBc0Q7QUFDakYsdUJBQXVCO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSw0QkFBNEIsVUFBVTtBQUN0QztBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLDRCQUE0QixVQUFVO0FBQ3RDO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSw0QkFBNEIsd0NBQXdDLElBQUkscUJBQXFCO0FBQzdGO0FBQ0E7QUFDQSxtQ0FBbUMsUUFBUTtBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0RBQWtELGFBQW9CLEdBQUcsTUFBb0IsR0FBRyxDQUFhO0FBQzdHO0FBQ0E7QUFDQSwrQkFBK0IsUUFBUTtBQUN2QztBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxZQUFZLDZEQUE2RDtBQUN6RSxZQUFZLDZDQUE2QztBQUN6RDtBQUNBO0FBQ0EsZ0JBQWdCLGNBQWM7QUFDOUIsZ0JBQWdCLFlBQVk7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSwrQkFBK0IsUUFBUTtBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsS0FBSyxJQUFJLHFCQUFxQjtBQUM3RCwrQkFBK0IsUUFBUTtBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLEtBQUssSUFBSSxxQkFBcUI7QUFDMUQsK0JBQStCLFFBQVE7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyx3Q0FBd0M7QUFDeEU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTs7QUFFQSx5R0FBeUcsVUFBb0M7QUFDN0k7QUFDQSwyQ0FBMkMsZ0RBQW1CO0FBQzlELGlDQUFpQyxvQkFBb0I7QUFDckQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0IsNkNBQWdCO0FBQ3RDLHNCQUFzQixhQUFvQjtBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsbURBQW1EO0FBQ3JGLGtDQUFrQyxTQUFTO0FBQzNDLDhCQUE4QiwyQ0FBYztBQUM1QztBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsOEJBQThCLHlDQUFZO0FBQzFDLHlCQUF5Qix5Q0FBWSxTQUFTO0FBQzlDLElBQUksNENBQWU7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLHVDQUF1QyxRQUFRO0FBQy9DO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGdEQUFnRCxpQkFBaUI7QUFDakU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckIsa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUIsZ0RBQW1CLENBQUMsMkNBQWMsc0JBQXNCLGdEQUFtQjtBQUNwRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFbUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zdG9yZS8uL25vZGVfbW9kdWxlcy9AZWRnZXN0b3JlL3JlYWN0L2Rpc3QvaW5kZXgubWpzPzRlNWYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgRWRnZVN0b3JlQXBpQ2xpZW50RXJyb3IgfSBmcm9tICdAZWRnZXN0b3JlL3NoYXJlZCc7XG5cbmNsYXNzIEVkZ2VTdG9yZUNsaWVudEVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2Upe1xuICAgICAgICBzdXBlcihtZXNzYWdlKTtcbiAgICAgICAgdGhpcy5uYW1lID0gJ0VkZ2VTdG9yZUVycm9yJztcbiAgICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGhhbmRsZUVycm9yKHJlcykge1xuICAgIGxldCBqc29uID0ge307XG4gICAgdHJ5IHtcbiAgICAgICAganNvbiA9IGF3YWl0IHJlcy5qc29uKCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIHRocm93IG5ldyBFZGdlU3RvcmVDbGllbnRFcnJvcihgRmFpbGVkIHRvIHBhcnNlIHJlc3BvbnNlLiBNYWtlIHN1cmUgdGhlIGFwaSBpcyBjb3JyZWN0bHkgY29uZmlndXJlZCBhdCAke3Jlcy51cmx9YCk7XG4gICAgfVxuICAgIHRocm93IG5ldyBFZGdlU3RvcmVBcGlDbGllbnRFcnJvcih7XG4gICAgICAgIHJlc3BvbnNlOiBqc29uXG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZU5leHRQcm94eSh7IGFwaVBhdGgsIHVwbG9hZGluZ0NvdW50UmVmLCBtYXhDb25jdXJyZW50VXBsb2FkcyA9IDUgfSkge1xuICAgIHJldHVybiBuZXcgUHJveHkoe30sIHtcbiAgICAgICAgZ2V0IChfLCBwcm9wKSB7XG4gICAgICAgICAgICBjb25zdCBidWNrZXROYW1lID0gcHJvcDtcbiAgICAgICAgICAgIGNvbnN0IGJ1Y2tldEZ1bmN0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICB1cGxvYWQ6IGFzeW5jIChwYXJhbXMpPT57XG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXMub25Qcm9ncmVzc0NoYW5nZT8uKDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUodXBsb2FkaW5nQ291bnRSZWYuY3VycmVudCA+PSBtYXhDb25jdXJyZW50VXBsb2FkcyAmJiB1cGxvYWRpbmdDb3VudFJlZi5jdXJyZW50ID4gMCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUpPT5zZXRUaW1lb3V0KHJlc29sdmUsIDMwMCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkaW5nQ291bnRSZWYuY3VycmVudCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGVzdCA9IGF3YWl0IHVwbG9hZEZpbGUocGFyYW1zLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnVja2V0TmFtZTogYnVja2V0TmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcGlQYXRoXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0ZXN0O1xuICAgICAgICAgICAgICAgICAgICB9IGZpbmFsbHl7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRpbmdDb3VudFJlZi5jdXJyZW50LS07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNvbmZpcm1VcGxvYWQ6IGFzeW5jIChwYXJhbXMpPT57XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgc3VjY2VzcyB9ID0gYXdhaXQgY29uZmlybVVwbG9hZChwYXJhbXMsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ1Y2tldE5hbWU6IGJ1Y2tldE5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBhcGlQYXRoXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFZGdlU3RvcmVDbGllbnRFcnJvcignRmFpbGVkIHRvIGNvbmZpcm0gdXBsb2FkJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGRlbGV0ZTogYXN5bmMgKHBhcmFtcyk9PntcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBzdWNjZXNzIH0gPSBhd2FpdCBkZWxldGVGaWxlKHBhcmFtcywge1xuICAgICAgICAgICAgICAgICAgICAgICAgYnVja2V0TmFtZTogYnVja2V0TmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwaVBhdGhcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVkZ2VTdG9yZUNsaWVudEVycm9yKCdGYWlsZWQgdG8gZGVsZXRlIGZpbGUnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4gYnVja2V0RnVuY3Rpb25zO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5hc3luYyBmdW5jdGlvbiB1cGxvYWRGaWxlKHsgZmlsZSwgaW5wdXQsIG9uUHJvZ3Jlc3NDaGFuZ2UsIG9wdGlvbnMgfSwgeyBhcGlQYXRoLCBidWNrZXROYW1lIH0pIHtcbiAgICB0cnkge1xuICAgICAgICBvblByb2dyZXNzQ2hhbmdlPy4oMCk7XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKGAke2FwaVBhdGh9L3JlcXVlc3QtdXBsb2FkYCwge1xuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICBjcmVkZW50aWFsczogJ2luY2x1ZGUnLFxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgIGJ1Y2tldE5hbWUsXG4gICAgICAgICAgICAgICAgaW5wdXQsXG4gICAgICAgICAgICAgICAgZmlsZUluZm86IHtcbiAgICAgICAgICAgICAgICAgICAgZXh0ZW5zaW9uOiBmaWxlLm5hbWUuc3BsaXQoJy4nKS5wb3AoKSxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogZmlsZS50eXBlLFxuICAgICAgICAgICAgICAgICAgICBzaXplOiBmaWxlLnNpemUsXG4gICAgICAgICAgICAgICAgICAgIGZpbGVOYW1lOiBvcHRpb25zPy5tYW51YWxGaWxlTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgcmVwbGFjZVRhcmdldFVybDogb3B0aW9ucz8ucmVwbGFjZVRhcmdldFVybCxcbiAgICAgICAgICAgICAgICAgICAgdGVtcG9yYXJ5OiBvcHRpb25zPy50ZW1wb3JhcnlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoIXJlcy5vaykge1xuICAgICAgICAgICAgYXdhaXQgaGFuZGxlRXJyb3IocmVzKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBqc29uID0gYXdhaXQgcmVzLmpzb24oKTtcbiAgICAgICAgaWYgKCdtdWx0aXBhcnQnIGluIGpzb24pIHtcbiAgICAgICAgICAgIGF3YWl0IG11bHRpcGFydFVwbG9hZCh7XG4gICAgICAgICAgICAgICAgYnVja2V0TmFtZSxcbiAgICAgICAgICAgICAgICBtdWx0aXBhcnRJbmZvOiBqc29uLm11bHRpcGFydCxcbiAgICAgICAgICAgICAgICBvblByb2dyZXNzQ2hhbmdlLFxuICAgICAgICAgICAgICAgIGZpbGUsXG4gICAgICAgICAgICAgICAgYXBpUGF0aFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSBpZiAoJ3VwbG9hZFVybCcgaW4ganNvbikge1xuICAgICAgICAgICAgLy8gU2luZ2xlIHBhcnQgdXBsb2FkXG4gICAgICAgICAgICAvLyBVcGxvYWQgdGhlIGZpbGUgdG8gdGhlIHNpZ25lZCBVUkwgYW5kIGdldCB0aGUgcHJvZ3Jlc3NcbiAgICAgICAgICAgIGF3YWl0IHVwbG9hZEZpbGVJbm5lcihmaWxlLCBqc29uLnVwbG9hZFVybCwgb25Qcm9ncmVzc0NoYW5nZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRWRnZVN0b3JlQ2xpZW50RXJyb3IoJ0FuIGVycm9yIG9jY3VycmVkJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHVybDogZ2V0VXJsKGpzb24uYWNjZXNzVXJsLCBhcGlQYXRoKSxcbiAgICAgICAgICAgIHRodW1ibmFpbFVybDoganNvbi50aHVtYm5haWxVcmwgPyBnZXRVcmwoanNvbi50aHVtYm5haWxVcmwsIGFwaVBhdGgpIDogbnVsbCxcbiAgICAgICAgICAgIHNpemU6IGpzb24uc2l6ZSxcbiAgICAgICAgICAgIHVwbG9hZGVkQXQ6IG5ldyBEYXRlKGpzb24udXBsb2FkZWRBdCksXG4gICAgICAgICAgICBwYXRoOiBqc29uLnBhdGgsXG4gICAgICAgICAgICBwYXRoT3JkZXI6IGpzb24ucGF0aE9yZGVyLFxuICAgICAgICAgICAgbWV0YWRhdGE6IGpzb24ubWV0YWRhdGFcbiAgICAgICAgfTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIG9uUHJvZ3Jlc3NDaGFuZ2U/LigwKTtcbiAgICAgICAgdGhyb3cgZTtcbiAgICB9XG59XG4vKipcbiAqIFByb3RlY3RlZCBmaWxlcyBuZWVkIHRoaXJkLXBhcnR5IGNvb2tpZXMgdG8gd29yay5cbiAqIFNpbmNlIHRoaXJkIHBhcnR5IGNvb2tpZXMgZG9lc24ndCB3b3JrIG9uIGxvY2FsaG9zdCxcbiAqIHdlIG5lZWQgdG8gcHJveHkgdGhlIGZpbGUgdGhyb3VnaCB0aGUgc2VydmVyLlxuICovIGZ1bmN0aW9uIGdldFVybCh1cmwsIGFwaVBhdGgpIHtcbiAgICBjb25zdCBtb2RlID0gdHlwZW9mIHByb2Nlc3MgIT09ICd1bmRlZmluZWQnID8gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgOiBpbXBvcnQubWV0YS5lbnY/LkRFViA/ICdkZXZlbG9wbWVudCcgOiAncHJvZHVjdGlvbic7XG4gICAgaWYgKG1vZGUgPT09ICdkZXZlbG9wbWVudCcgJiYgIXVybC5pbmNsdWRlcygnL19wdWJsaWMvJykpIHtcbiAgICAgICAgY29uc3QgcHJveHlVcmwgPSBuZXcgVVJMKHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4pO1xuICAgICAgICBwcm94eVVybC5wYXRobmFtZSA9IGAke2FwaVBhdGh9L3Byb3h5LWZpbGVgO1xuICAgICAgICBwcm94eVVybC5zZWFyY2ggPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHtcbiAgICAgICAgICAgIHVybFxuICAgICAgICB9KS50b1N0cmluZygpO1xuICAgICAgICByZXR1cm4gcHJveHlVcmwudG9TdHJpbmcoKTtcbiAgICB9XG4gICAgcmV0dXJuIHVybDtcbn1cbmNvbnN0IHVwbG9hZEZpbGVJbm5lciA9IGFzeW5jIChmaWxlLCB1cGxvYWRVcmwsIG9uUHJvZ3Jlc3NDaGFuZ2UpPT57XG4gICAgY29uc3QgcHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpPT57XG4gICAgICAgIGNvbnN0IHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgcmVxdWVzdC5vcGVuKCdQVVQnLCB1cGxvYWRVcmwpO1xuICAgICAgICAvLyBUaGlzIGlzIGZvciBBenVyZSBwcm92aWRlci4gU3BlY2lmaWVzIHRoZSBibG9iIHR5cGVcbiAgICAgICAgcmVxdWVzdC5zZXRSZXF1ZXN0SGVhZGVyKCd4LW1zLWJsb2ItdHlwZScsICdCbG9ja0Jsb2InKTtcbiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdsb2Fkc3RhcnQnLCAoKT0+e1xuICAgICAgICAgICAgb25Qcm9ncmVzc0NoYW5nZT8uKDApO1xuICAgICAgICB9KTtcbiAgICAgICAgcmVxdWVzdC51cGxvYWQuYWRkRXZlbnRMaXN0ZW5lcigncHJvZ3Jlc3MnLCAoZSk9PntcbiAgICAgICAgICAgIGlmIChlLmxlbmd0aENvbXB1dGFibGUpIHtcbiAgICAgICAgICAgICAgICAvLyAyIGRlY2ltYWwgcHJvZ3Jlc3NcbiAgICAgICAgICAgICAgICBjb25zdCBwcm9ncmVzcyA9IE1hdGgucm91bmQoZS5sb2FkZWQgLyBlLnRvdGFsICogMTAwMDApIC8gMTAwO1xuICAgICAgICAgICAgICAgIG9uUHJvZ3Jlc3NDaGFuZ2U/Lihwcm9ncmVzcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgKCk9PntcbiAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoJ0Vycm9yIHVwbG9hZGluZyBmaWxlJykpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdhYm9ydCcsICgpPT57XG4gICAgICAgICAgICByZWplY3QobmV3IEVycm9yKCdGaWxlIHVwbG9hZCBhYm9ydGVkJykpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdsb2FkZW5kJywgKCk9PntcbiAgICAgICAgICAgIC8vIFJldHVybiB0aGUgRVRhZyBoZWFkZXIgKG5lZWRlZCB0byBjb21wbGV0ZSBtdWx0aXBhcnQgdXBsb2FkKVxuICAgICAgICAgICAgcmVzb2x2ZShyZXF1ZXN0LmdldFJlc3BvbnNlSGVhZGVyKCdFVGFnJykpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmVxdWVzdC5zZW5kKGZpbGUpO1xuICAgIH0pO1xuICAgIHJldHVybiBwcm9taXNlO1xufTtcbmFzeW5jIGZ1bmN0aW9uIG11bHRpcGFydFVwbG9hZChwYXJhbXMpIHtcbiAgICBjb25zdCB7IGJ1Y2tldE5hbWUsIG11bHRpcGFydEluZm8sIG9uUHJvZ3Jlc3NDaGFuZ2UsIGZpbGUsIGFwaVBhdGggfSA9IHBhcmFtcztcbiAgICBjb25zdCB7IHBhcnRTaXplLCBwYXJ0cywgdG90YWxQYXJ0cywgdXBsb2FkSWQsIGtleSB9ID0gbXVsdGlwYXJ0SW5mbztcbiAgICBjb25zdCB1cGxvYWRpbmdQYXJ0cyA9IFtdO1xuICAgIGNvbnN0IHVwbG9hZFBhcnQgPSBhc3luYyAocGFyYW1zKT0+e1xuICAgICAgICBjb25zdCB7IHBhcnQsIGNodW5rIH0gPSBwYXJhbXM7XG4gICAgICAgIGNvbnN0IHsgdXBsb2FkVXJsIH0gPSBwYXJ0O1xuICAgICAgICBjb25zdCBlVGFnID0gYXdhaXQgdXBsb2FkRmlsZUlubmVyKGNodW5rLCB1cGxvYWRVcmwsIChwcm9ncmVzcyk9PntcbiAgICAgICAgICAgIGNvbnN0IHVwbG9hZGluZ1BhcnQgPSB1cGxvYWRpbmdQYXJ0cy5maW5kKChwKT0+cC5wYXJ0TnVtYmVyID09PSBwYXJ0LnBhcnROdW1iZXIpO1xuICAgICAgICAgICAgaWYgKHVwbG9hZGluZ1BhcnQpIHtcbiAgICAgICAgICAgICAgICB1cGxvYWRpbmdQYXJ0LnByb2dyZXNzID0gcHJvZ3Jlc3M7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHVwbG9hZGluZ1BhcnRzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBwYXJ0TnVtYmVyOiBwYXJ0LnBhcnROdW1iZXIsXG4gICAgICAgICAgICAgICAgICAgIHByb2dyZXNzXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB0b3RhbFByb2dyZXNzID0gTWF0aC5yb3VuZCh1cGxvYWRpbmdQYXJ0cy5yZWR1Y2UoKGFjYywgcCk9PmFjYyArIHAucHJvZ3Jlc3MgKiAxMDAsIDApIC8gdG90YWxQYXJ0cykgLyAxMDA7XG4gICAgICAgICAgICBvblByb2dyZXNzQ2hhbmdlPy4odG90YWxQcm9ncmVzcyk7XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoIWVUYWcpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFZGdlU3RvcmVDbGllbnRFcnJvcignQ291bGQgbm90IGdldCBFVGFnIGZyb20gbXVsdGlwYXJ0IHJlc3BvbnNlJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHBhcnROdW1iZXI6IHBhcnQucGFydE51bWJlcixcbiAgICAgICAgICAgIGVUYWdcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIC8vIFVwbG9hZCB0aGUgcGFydHMgaW4gcGFyYWxsZWxcbiAgICBjb25zdCBjb21wbGV0ZWRQYXJ0cyA9IGF3YWl0IHF1ZXVlZFByb21pc2VzKHtcbiAgICAgICAgaXRlbXM6IHBhcnRzLm1hcCgocGFydCk9Pih7XG4gICAgICAgICAgICAgICAgcGFydCxcbiAgICAgICAgICAgICAgICBjaHVuazogZmlsZS5zbGljZSgocGFydC5wYXJ0TnVtYmVyIC0gMSkgKiBwYXJ0U2l6ZSwgcGFydC5wYXJ0TnVtYmVyICogcGFydFNpemUpXG4gICAgICAgICAgICB9KSksXG4gICAgICAgIGZuOiB1cGxvYWRQYXJ0LFxuICAgICAgICBtYXhQYXJhbGxlbDogNSxcbiAgICAgICAgbWF4UmV0cmllczogMTBcbiAgICB9KTtcbiAgICAvLyBDb21wbGV0ZSBtdWx0aXBhcnQgdXBsb2FkXG4gICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goYCR7YXBpUGF0aH0vY29tcGxldGUtbXVsdGlwYXJ0LXVwbG9hZGAsIHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIGNyZWRlbnRpYWxzOiAnaW5jbHVkZScsXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgIGJ1Y2tldE5hbWUsXG4gICAgICAgICAgICB1cGxvYWRJZCxcbiAgICAgICAgICAgIGtleSxcbiAgICAgICAgICAgIHBhcnRzOiBjb21wbGV0ZWRQYXJ0c1xuICAgICAgICB9KSxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgaWYgKCFyZXMub2spIHtcbiAgICAgICAgYXdhaXQgaGFuZGxlRXJyb3IocmVzKTtcbiAgICB9XG59XG5hc3luYyBmdW5jdGlvbiBjb25maXJtVXBsb2FkKHsgdXJsIH0sIHsgYXBpUGF0aCwgYnVja2V0TmFtZSB9KSB7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goYCR7YXBpUGF0aH0vY29uZmlybS11cGxvYWRgLCB7XG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICBjcmVkZW50aWFsczogJ2luY2x1ZGUnLFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICB1cmwsXG4gICAgICAgICAgICBidWNrZXROYW1lXG4gICAgICAgIH0pLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBpZiAoIXJlcy5vaykge1xuICAgICAgICBhd2FpdCBoYW5kbGVFcnJvcihyZXMpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzLmpzb24oKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGRlbGV0ZUZpbGUoeyB1cmwgfSwgeyBhcGlQYXRoLCBidWNrZXROYW1lIH0pIHtcbiAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaChgJHthcGlQYXRofS9kZWxldGUtZmlsZWAsIHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIGNyZWRlbnRpYWxzOiAnaW5jbHVkZScsXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgIHVybCxcbiAgICAgICAgICAgIGJ1Y2tldE5hbWVcbiAgICAgICAgfSksXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICAgIGF3YWl0IGhhbmRsZUVycm9yKHJlcyk7XG4gICAgfVxuICAgIHJldHVybiByZXMuanNvbigpO1xufVxuYXN5bmMgZnVuY3Rpb24gcXVldWVkUHJvbWlzZXMoeyBpdGVtcywgZm4sIG1heFBhcmFsbGVsLCBtYXhSZXRyaWVzID0gMCB9KSB7XG4gICAgY29uc3QgcmVzdWx0cyA9IG5ldyBBcnJheShpdGVtcy5sZW5ndGgpO1xuICAgIGNvbnN0IGV4ZWN1dGVXaXRoUmV0cnkgPSBhc3luYyAoZnVuYywgcmV0cmllcyk9PntcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCBmdW5jKCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBpZiAocmV0cmllcyA+IDApIHtcbiAgICAgICAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSk9PnNldFRpbWVvdXQocmVzb2x2ZSwgNTAwMCkpO1xuICAgICAgICAgICAgICAgIHJldHVybiBleGVjdXRlV2l0aFJldHJ5KGZ1bmMsIHJldHJpZXMgLSAxKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IHNlbWFwaG9yZSA9IHtcbiAgICAgICAgY291bnQ6IG1heFBhcmFsbGVsLFxuICAgICAgICBhc3luYyB3YWl0ICgpIHtcbiAgICAgICAgICAgIC8vIElmIHdlJ3ZlIHJlYWNoZWQgb3VyIG1heGltdW0gY29uY3VycmVuY3kgb3IgaXQncyB0aGUgbGFzdCBpdGVtLCB3YWl0XG4gICAgICAgICAgICB3aGlsZSh0aGlzLmNvdW50IDw9IDApYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUpPT5zZXRUaW1lb3V0KHJlc29sdmUsIDUwMCkpO1xuICAgICAgICAgICAgdGhpcy5jb3VudC0tO1xuICAgICAgICB9LFxuICAgICAgICBzaWduYWwgKCkge1xuICAgICAgICAgICAgdGhpcy5jb3VudCsrO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBjb25zdCB0YXNrcyA9IGl0ZW1zLm1hcCgoaXRlbSwgaSk9Pihhc3luYyAoKT0+e1xuICAgICAgICAgICAgYXdhaXQgc2VtYXBob3JlLndhaXQoKTtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZXhlY3V0ZVdpdGhSZXRyeSgoKT0+Zm4oaXRlbSksIG1heFJldHJpZXMpO1xuICAgICAgICAgICAgICAgIHJlc3VsdHNbaV0gPSByZXN1bHQ7XG4gICAgICAgICAgICB9IGZpbmFsbHl7XG4gICAgICAgICAgICAgICAgc2VtYXBob3JlLnNpZ25hbCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSgpKTtcbiAgICBhd2FpdCBQcm9taXNlLmFsbCh0YXNrcyk7XG4gICAgcmV0dXJuIHJlc3VsdHM7XG59XG5cbmNvbnN0IERFRkFVTFRfQkFTRV9VUkwgPSAodHlwZW9mIHByb2Nlc3MgIT09ICd1bmRlZmluZWQnID8gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfRURHRV9TVE9SRV9CQVNFX1VSTCA6IGltcG9ydC5tZXRhLmVudj8uRURHRV9TVE9SRV9CQVNFX1VSTCkgPz8gJ2h0dHBzOi8vZmlsZXMuZWRnZXN0b3JlLmRldic7XG5mdW5jdGlvbiBjcmVhdGVFZGdlU3RvcmVQcm92aWRlcihvcHRzKSB7XG4gICAgY29uc3QgRWRnZVN0b3JlQ29udGV4dCA9IC8qI19fUFVSRV9fKi8gUmVhY3QuY3JlYXRlQ29udGV4dCh1bmRlZmluZWQpO1xuICAgIGNvbnN0IEVkZ2VTdG9yZVByb3ZpZGVyID0gKHsgY2hpbGRyZW4sIGJhc2VQYXRoIH0pPT57XG4gICAgICAgIHJldHVybiBFZGdlU3RvcmVQcm92aWRlcklubmVyKHtcbiAgICAgICAgICAgIGNoaWxkcmVuLFxuICAgICAgICAgICAgY29udGV4dDogRWRnZVN0b3JlQ29udGV4dCxcbiAgICAgICAgICAgIGJhc2VQYXRoLFxuICAgICAgICAgICAgbWF4Q29uY3VycmVudFVwbG9hZHM6IG9wdHM/Lm1heENvbmN1cnJlbnRVcGxvYWRzXG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgZnVuY3Rpb24gdXNlRWRnZVN0b3JlKCkge1xuICAgICAgICBpZiAoIUVkZ2VTdG9yZUNvbnRleHQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmVhY3QgQ29udGV4dCBpcyB1bmF2YWlsYWJsZSBpbiBTZXJ2ZXIgQ29tcG9uZW50cycpO1xuICAgICAgICB9XG4gICAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgLSBXZSBrbm93IHRoYXQgdGhlIGNvbnRleHQgdmFsdWUgc2hvdWxkIG5vdCBiZSB1bmRlZmluZWRcbiAgICAgICAgY29uc3QgdmFsdWUgPSBSZWFjdC51c2VDb250ZXh0KEVkZ2VTdG9yZUNvbnRleHQpO1xuICAgICAgICBpZiAoIXZhbHVlICYmIHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignW2VkZ2VzdG9yZV06IGB1c2VFZGdlU3RvcmVgIG11c3QgYmUgd3JhcHBlZCBpbiBhIDxFZGdlU3RvcmVQcm92aWRlciAvPicpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgICAgRWRnZVN0b3JlUHJvdmlkZXIsXG4gICAgICAgIHVzZUVkZ2VTdG9yZVxuICAgIH07XG59XG5mdW5jdGlvbiBFZGdlU3RvcmVQcm92aWRlcklubmVyKHsgY2hpbGRyZW4sIGNvbnRleHQsIGJhc2VQYXRoLCBtYXhDb25jdXJyZW50VXBsb2FkcyB9KSB7XG4gICAgY29uc3QgYXBpUGF0aCA9IGJhc2VQYXRoID8gYCR7YmFzZVBhdGh9YCA6ICcvYXBpL2VkZ2VzdG9yZSc7XG4gICAgY29uc3QgW3N0YXRlLCBzZXRTdGF0ZV0gPSBSZWFjdC51c2VTdGF0ZSh7XG4gICAgICAgIGxvYWRpbmc6IHRydWUsXG4gICAgICAgIGluaXRpYWxpemVkOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IGZhbHNlXG4gICAgfSk7XG4gICAgY29uc3QgdXBsb2FkaW5nQ291bnRSZWYgPSBSZWFjdC51c2VSZWYoMCk7XG4gICAgY29uc3QgaW5pdEV4ZWN1dGVkID0gUmVhY3QudXNlUmVmKGZhbHNlKTsgLy8gdG8gbWFrZSBzdXJlIHdlIGRvbid0IHJ1biBpbml0IHR3aWNlXG4gICAgUmVhY3QudXNlRWZmZWN0KCgpPT57XG4gICAgICAgIGlmICghaW5pdEV4ZWN1dGVkLmN1cnJlbnQpIHtcbiAgICAgICAgICAgIHZvaWQgaW5pdCgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoKT0+e1xuICAgICAgICAgICAgaW5pdEV4ZWN1dGVkLmN1cnJlbnQgPSB0cnVlO1xuICAgICAgICB9O1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC1ob29rcy9leGhhdXN0aXZlLWRlcHNcbiAgICB9LCBbXSk7XG4gICAgYXN5bmMgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICBsb2FkaW5nOiB0cnVlLFxuICAgICAgICAgICAgICAgIGluaXRpYWxpemVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBlcnJvcjogZmFsc2VcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goYCR7YXBpUGF0aH0vaW5pdGAsIHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICBjcmVkZW50aWFsczogJ2luY2x1ZGUnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgICAgICAgICBjb25zdCBqc29uID0gYXdhaXQgcmVzLmpzb24oKTtcbiAgICAgICAgICAgICAgICBjb25zdCBpbm5lclJlcyA9IGF3YWl0IGZldGNoKGAke0RFRkFVTFRfQkFTRV9VUkx9L19pbml0YCwge1xuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgICAgICAgICBjcmVkZW50aWFsczogJ2luY2x1ZGUnLFxuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAneC1lZGdlc3RvcmUtdG9rZW4nOiBqc29uLnRva2VuXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAoaW5uZXJSZXMub2spIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gdXBkYXRlIHN0YXRlXG4gICAgICAgICAgICAgICAgICAgIHNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW5pdGlhbGl6ZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBpbml0aWFsaXplZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVkZ2VTdG9yZUNsaWVudEVycm9yKFwiQ291bGRuJ3QgaW5pdGlhbGl6ZSBFZGdlIFN0b3JlLlwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgbG9hZGluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIGluaXRpYWxpemVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IHRydWVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBhd2FpdCBoYW5kbGVFcnJvcihyZXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIHNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICBsb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBpbml0aWFsaXplZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgZXJyb3I6IHRydWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICB9XG4gICAgfVxuICAgIGFzeW5jIGZ1bmN0aW9uIHJlc2V0KCkge1xuICAgICAgICBhd2FpdCBpbml0KCk7XG4gICAgfVxuICAgIHJldHVybiAvKiNfX1BVUkVfXyovIFJlYWN0LmNyZWF0ZUVsZW1lbnQoUmVhY3QuRnJhZ21lbnQsIG51bGwsIC8qI19fUFVSRV9fKi8gUmVhY3QuY3JlYXRlRWxlbWVudChjb250ZXh0LlByb3ZpZGVyLCB7XG4gICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgICBlZGdlc3RvcmU6IGNyZWF0ZU5leHRQcm94eSh7XG4gICAgICAgICAgICAgICAgYXBpUGF0aCxcbiAgICAgICAgICAgICAgICB1cGxvYWRpbmdDb3VudFJlZixcbiAgICAgICAgICAgICAgICBtYXhDb25jdXJyZW50VXBsb2Fkc1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICByZXNldCxcbiAgICAgICAgICAgIHN0YXRlXG4gICAgICAgIH1cbiAgICB9LCBjaGlsZHJlbikpO1xufVxuXG5leHBvcnQgeyBjcmVhdGVFZGdlU3RvcmVQcm92aWRlciB9O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@edgestore/react/dist/index.mjs\n");

/***/ }),

/***/ "(ssr)/./node_modules/@edgestore/shared/dist/index.mjs":
/*!*******************************************************!*\
  !*** ./node_modules/@edgestore/shared/dist/index.mjs ***!
  \*******************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   EDGE_STORE_ERROR_CODES: () => (/* binding */ EDGE_STORE_ERROR_CODES),\n/* harmony export */   EdgeStoreApiClientError: () => (/* binding */ EdgeStoreApiClientError),\n/* harmony export */   EdgeStoreError: () => (/* binding */ EdgeStoreError),\n/* harmony export */   initEdgeStore: () => (/* binding */ initEdgeStore)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! zod */ \"(ssr)/./node_modules/zod/lib/index.mjs\");\n\n\nfunction _define_property$1(obj, key, value) {\n    if (key in obj) {\n        Object.defineProperty(obj, key, {\n            value: value,\n            enumerable: true,\n            configurable: true,\n            writable: true\n        });\n    } else {\n        obj[key] = value;\n    }\n    return obj;\n}\n/* eslint-disable @typescript-eslint/no-non-null-assertion */ const EDGE_STORE_ERROR_CODES = {\n    BAD_REQUEST: 400,\n    FILE_TOO_LARGE: 400,\n    MIME_TYPE_NOT_ALLOWED: 400,\n    UNAUTHORIZED: 401,\n    UPLOAD_NOT_ALLOWED: 403,\n    DELETE_NOT_ALLOWED: 403,\n    CREATE_CONTEXT_ERROR: 500,\n    SERVER_ERROR: 500\n};\nclass EdgeStoreError extends Error {\n    formattedMessage() {\n        return `${this.message}${this.details ? `\\n    Details: ${JSON.stringify(this.details)}` : ''}${this.cause ? `\\n    Caused by: ${this.cause.message}` : ''}`;\n    }\n    formattedJson() {\n        return {\n            message: this.code === 'SERVER_ERROR' ? 'Internal server error' : this.message,\n            code: this.code,\n            details: this.details\n        };\n    }\n    constructor(opts){\n        super(opts.message);\n        _define_property$1(this, \"cause\", void 0);\n        _define_property$1(this, \"code\", void 0);\n        _define_property$1(this, \"level\", void 0);\n        _define_property$1(this, \"details\", void 0);\n        this.name = 'EdgeStoreError';\n        this.code = opts.code;\n        this.cause = opts.cause;\n        this.level = EDGE_STORE_ERROR_CODES[opts.code] >= 500 ? 'error' : 'warn';\n        this.details = 'details' in opts ? opts.details : undefined;\n    }\n}\n\nfunction _define_property(obj, key, value) {\n    if (key in obj) {\n        Object.defineProperty(obj, key, {\n            value: value,\n            enumerable: true,\n            configurable: true,\n            writable: true\n        });\n    } else {\n        obj[key] = value;\n    }\n    return obj;\n}\nclass EdgeStoreApiClientError extends Error {\n    constructor(opts){\n        super(opts.response.message);\n        _define_property(this, \"data\", void 0);\n        this.name = 'EdgeStoreApiClientError';\n        this.data = opts.response;\n    }\n}\n\n/**\n * Creates a Proxy that prints the path to the property when called.\n *\n * Example:\n *\n * ```ts\n * const pathParamProxy = createPathParamProxy();\n * console.log(pathParamProxy.ctx.user.id());\n * // Logs: \"ctx.user.id\"\n * console.log(pathParamProxy.input.type());\n * // Logs: \"input.type\"\n * ```\n */ function createPathParamProxy() {\n    const getPath = (target, _prop)=>{\n        const proxyFunction = ()=>target;\n        return new Proxy(proxyFunction, {\n            get: (_target, propChild)=>{\n                return getPath(`${target}.${String(propChild)}`);\n            }\n        });\n    };\n    return new Proxy(()=>'', {\n        get: (_target, prop)=>{\n            return getPath(String(prop));\n        }\n    });\n}\n\nconst createNewBuilder = (initDef, newDef)=>{\n    const mergedDef = {\n        ...initDef,\n        ...newDef\n    };\n    return createBuilder({\n        type: mergedDef.type\n    }, mergedDef);\n};\nfunction createBuilder(opts, initDef) {\n    const _def = {\n        type: opts.type,\n        input: zod__WEBPACK_IMPORTED_MODULE_0__.z.never(),\n        path: [],\n        metadata: ()=>({}),\n        ...initDef\n    };\n    return {\n        $config: {\n            ctx: undefined\n        },\n        // @ts-expect-error - I think it would be too much work to make this type correct.\n        _def,\n        input (input) {\n            return createNewBuilder(_def, {\n                input\n            });\n        },\n        path (pathResolver) {\n            // TODO: Should throw a runtime error in the following cases:\n            // 1. in case of multiple keys in one object\n            // 2. in case of duplicate keys\n            const pathParamProxy = createPathParamProxy();\n            const params = pathResolver(pathParamProxy);\n            return createNewBuilder(_def, {\n                path: params\n            });\n        },\n        metadata (metadata) {\n            return createNewBuilder(_def, {\n                metadata\n            });\n        },\n        accessControl (accessControl) {\n            return createNewBuilder(_def, {\n                accessControl: accessControl\n            });\n        },\n        beforeUpload (beforeUpload) {\n            return createNewBuilder(_def, {\n                beforeUpload\n            });\n        },\n        beforeDelete (beforeDelete) {\n            return createNewBuilder(_def, {\n                beforeDelete\n            });\n        }\n    };\n}\nclass EdgeStoreBuilder {\n    context() {\n        return new EdgeStoreBuilder();\n    }\n    create() {\n        return createEdgeStoreInner()();\n    }\n}\nfunction createRouterFactory() {\n    return function createRouterInner(buckets) {\n        return {\n            $config: {\n                ctx: undefined\n            },\n            buckets\n        };\n    };\n}\nfunction initBucket(type, config) {\n    return createBuilder({\n        type\n    }, {\n        bucketConfig: config\n    });\n}\nfunction createEdgeStoreInner() {\n    return function initEdgeStoreInner() {\n        return {\n            /**\n       * Builder object for creating an image bucket\n       */ imageBucket (config) {\n                return initBucket('IMAGE', config);\n            },\n            /**\n       * Builder object for creating a file bucket\n       */ fileBucket (config) {\n                return initBucket('FILE', config);\n            },\n            /**\n       * Create a router\n       */ router: createRouterFactory()\n        };\n    };\n}\n/**\n * Initialize EdgeStore - be done exactly once per backend\n */ const initEdgeStore = new EdgeStoreBuilder(); // ↓↓↓ TYPE TESTS ↓↓↓\n // type Context = {\n //   userId: string;\n //   userRole: 'admin' | 'visitor';\n // };\n // const es = initEdgeStore.context<Context>().create();\n // const imagesBucket = es.imageBucket()\n //   .input(\n //     z.object({\n //       type: z.enum(['profile', 'post']),\n //       extension: z.string().optional(),\n //     }),\n //   )\n //   .path(({ ctx, input }) => [{ author: ctx.userId }, { type: input.type }])\n //   .metadata(({ ctx, input }) => ({\n //     extension: input.extension,\n //     role: ctx.userRole,\n //   }))\n //   .beforeUpload(() => {\n //     return true;\n //   });\n // const a = es.imageBucket()\n //   .input(z.object({ type: z.string(), someMeta: z.string().optional() }))\n //   .path(({ ctx, input }) => [{ author: ctx.userId }, { type: input.type }])\n //   .metadata(({ ctx, input }) => ({\n //     role: ctx.userRole,\n //     someMeta: input.someMeta,\n //   }))\n //   .accessControl({\n //     OR: [\n //       {\n //         userId: { path: 'author' }, // this will check if the userId is the same as the author in the path parameter\n //       },\n //       {\n //         userRole: 'admin', // this is the same as { userRole: { eq: \"admin\" } }\n //       },\n //     ],\n //   })\n //   .beforeUpload(({ ctx, input }) => {\n //     return true;\n //   })\n //   .beforeDelete(({ ctx, file }) => {\n //     return true;\n //   });\n // const b = es.imageBucket().path(({ ctx }) => [{ author: ctx.userId }]);\n // const router = es.router({\n //   original: imagesBucket,\n //   imageBucket: a,\n //   imageBucket2: b,\n // });\n // export { router };\n // type ListFilesResponse<TBucket extends AnyRouter['buckets'][string]> = {\n //   data: {\n //     // url: string;\n //     // size: number;\n //     // uploadedAt: Date;\n //     // metadata: InferMetadataObject<TBucket>;\n //     path: InferBucketPathKeys<TBucket> extends string ? {\n //       [key: string]: string;\n //     } :{\n //       [TKey in InferBucketPathKeys<TBucket>]: string;\n //     };\n //   }[];\n //   pagination: {\n //     currentPage: number;\n //     totalPages: number;\n //     totalCount: number;\n //   };\n // };\n // type TPathKeys = 'author' | 'type';\n // type TPathKeys2 = InferBucketPathKeys<AnyBuilder>;\n // type ObjectWithKeys<TKeys extends string> = {\n //   [TKey in TKeys]: string;\n // };\n // type Test1 = ObjectWithKeys<TPathKeys>;\n // type Test2 = ObjectWithKeys<TPathKeys2>;\n // type PathKeys = InferBucketPathKeys<typeof router.buckets.imageBucket>;\n // type MetadataKeys = InferMetadataObject<typeof router.buckets.imageBucket>;\n // type MyEdgeStoreRouter = typeof router;\n // type MyAccessControl = AccessControlSchema<Context, AnyDef>;\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGVkZ2VzdG9yZS9zaGFyZWQvZGlzdC9pbmRleC5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBd0I7O0FBRXhCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixhQUFhLEVBQUUsaUNBQWlDLDZCQUE2QixPQUFPLEVBQUUsaUNBQWlDLG1CQUFtQixPQUFPO0FBQ25LO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsT0FBTyxHQUFHLGtCQUFrQjtBQUM5RDtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSxrQ0FBQztBQUNoQjtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrREFBa0Q7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxlQUFlLFlBQVksUUFBUSxvQkFBb0IsSUFBSSxrQkFBa0I7QUFDN0UsbUJBQW1CLFlBQVk7QUFDL0I7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0Esd0JBQXdCLG1EQUFtRDtBQUMzRSxlQUFlLFlBQVksUUFBUSxvQkFBb0IsSUFBSSxrQkFBa0I7QUFDN0UsbUJBQW1CLFlBQVk7QUFDL0I7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQSxzQkFBc0IsZ0JBQWdCO0FBQ3RDLFdBQVc7QUFDWDtBQUNBLHdEQUF3RCxZQUFZO0FBQ3BFLFdBQVc7QUFDWDtBQUNBLE9BQU87QUFDUCx1QkFBdUIsWUFBWTtBQUNuQztBQUNBLE9BQU87QUFDUCx1QkFBdUIsV0FBVztBQUNsQztBQUNBLE9BQU87QUFDUCx1Q0FBdUMsS0FBSyxRQUFRLG9CQUFvQjtBQUN4RTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRTBGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc3RvcmUvLi9ub2RlX21vZHVsZXMvQGVkZ2VzdG9yZS9zaGFyZWQvZGlzdC9pbmRleC5tanM/NzFkMyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB6IH0gZnJvbSAnem9kJztcblxuZnVuY3Rpb24gX2RlZmluZV9wcm9wZXJ0eSQxKG9iaiwga2V5LCB2YWx1ZSkge1xuICAgIGlmIChrZXkgaW4gb2JqKSB7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwge1xuICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlXG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIG9ialtrZXldID0gdmFsdWU7XG4gICAgfVxuICAgIHJldHVybiBvYmo7XG59XG4vKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tbm9uLW51bGwtYXNzZXJ0aW9uICovIGNvbnN0IEVER0VfU1RPUkVfRVJST1JfQ09ERVMgPSB7XG4gICAgQkFEX1JFUVVFU1Q6IDQwMCxcbiAgICBGSUxFX1RPT19MQVJHRTogNDAwLFxuICAgIE1JTUVfVFlQRV9OT1RfQUxMT1dFRDogNDAwLFxuICAgIFVOQVVUSE9SSVpFRDogNDAxLFxuICAgIFVQTE9BRF9OT1RfQUxMT1dFRDogNDAzLFxuICAgIERFTEVURV9OT1RfQUxMT1dFRDogNDAzLFxuICAgIENSRUFURV9DT05URVhUX0VSUk9SOiA1MDAsXG4gICAgU0VSVkVSX0VSUk9SOiA1MDBcbn07XG5jbGFzcyBFZGdlU3RvcmVFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgICBmb3JtYXR0ZWRNZXNzYWdlKCkge1xuICAgICAgICByZXR1cm4gYCR7dGhpcy5tZXNzYWdlfSR7dGhpcy5kZXRhaWxzID8gYFxcbiAgICBEZXRhaWxzOiAke0pTT04uc3RyaW5naWZ5KHRoaXMuZGV0YWlscyl9YCA6ICcnfSR7dGhpcy5jYXVzZSA/IGBcXG4gICAgQ2F1c2VkIGJ5OiAke3RoaXMuY2F1c2UubWVzc2FnZX1gIDogJyd9YDtcbiAgICB9XG4gICAgZm9ybWF0dGVkSnNvbigpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG1lc3NhZ2U6IHRoaXMuY29kZSA9PT0gJ1NFUlZFUl9FUlJPUicgPyAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyA6IHRoaXMubWVzc2FnZSxcbiAgICAgICAgICAgIGNvZGU6IHRoaXMuY29kZSxcbiAgICAgICAgICAgIGRldGFpbHM6IHRoaXMuZGV0YWlsc1xuICAgICAgICB9O1xuICAgIH1cbiAgICBjb25zdHJ1Y3RvcihvcHRzKXtcbiAgICAgICAgc3VwZXIob3B0cy5tZXNzYWdlKTtcbiAgICAgICAgX2RlZmluZV9wcm9wZXJ0eSQxKHRoaXMsIFwiY2F1c2VcIiwgdm9pZCAwKTtcbiAgICAgICAgX2RlZmluZV9wcm9wZXJ0eSQxKHRoaXMsIFwiY29kZVwiLCB2b2lkIDApO1xuICAgICAgICBfZGVmaW5lX3Byb3BlcnR5JDEodGhpcywgXCJsZXZlbFwiLCB2b2lkIDApO1xuICAgICAgICBfZGVmaW5lX3Byb3BlcnR5JDEodGhpcywgXCJkZXRhaWxzXCIsIHZvaWQgMCk7XG4gICAgICAgIHRoaXMubmFtZSA9ICdFZGdlU3RvcmVFcnJvcic7XG4gICAgICAgIHRoaXMuY29kZSA9IG9wdHMuY29kZTtcbiAgICAgICAgdGhpcy5jYXVzZSA9IG9wdHMuY2F1c2U7XG4gICAgICAgIHRoaXMubGV2ZWwgPSBFREdFX1NUT1JFX0VSUk9SX0NPREVTW29wdHMuY29kZV0gPj0gNTAwID8gJ2Vycm9yJyA6ICd3YXJuJztcbiAgICAgICAgdGhpcy5kZXRhaWxzID0gJ2RldGFpbHMnIGluIG9wdHMgPyBvcHRzLmRldGFpbHMgOiB1bmRlZmluZWQ7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfZGVmaW5lX3Byb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkge1xuICAgIGlmIChrZXkgaW4gb2JqKSB7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwge1xuICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlXG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIG9ialtrZXldID0gdmFsdWU7XG4gICAgfVxuICAgIHJldHVybiBvYmo7XG59XG5jbGFzcyBFZGdlU3RvcmVBcGlDbGllbnRFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgICBjb25zdHJ1Y3RvcihvcHRzKXtcbiAgICAgICAgc3VwZXIob3B0cy5yZXNwb25zZS5tZXNzYWdlKTtcbiAgICAgICAgX2RlZmluZV9wcm9wZXJ0eSh0aGlzLCBcImRhdGFcIiwgdm9pZCAwKTtcbiAgICAgICAgdGhpcy5uYW1lID0gJ0VkZ2VTdG9yZUFwaUNsaWVudEVycm9yJztcbiAgICAgICAgdGhpcy5kYXRhID0gb3B0cy5yZXNwb25zZTtcbiAgICB9XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIFByb3h5IHRoYXQgcHJpbnRzIHRoZSBwYXRoIHRvIHRoZSBwcm9wZXJ0eSB3aGVuIGNhbGxlZC5cbiAqXG4gKiBFeGFtcGxlOlxuICpcbiAqIGBgYHRzXG4gKiBjb25zdCBwYXRoUGFyYW1Qcm94eSA9IGNyZWF0ZVBhdGhQYXJhbVByb3h5KCk7XG4gKiBjb25zb2xlLmxvZyhwYXRoUGFyYW1Qcm94eS5jdHgudXNlci5pZCgpKTtcbiAqIC8vIExvZ3M6IFwiY3R4LnVzZXIuaWRcIlxuICogY29uc29sZS5sb2cocGF0aFBhcmFtUHJveHkuaW5wdXQudHlwZSgpKTtcbiAqIC8vIExvZ3M6IFwiaW5wdXQudHlwZVwiXG4gKiBgYGBcbiAqLyBmdW5jdGlvbiBjcmVhdGVQYXRoUGFyYW1Qcm94eSgpIHtcbiAgICBjb25zdCBnZXRQYXRoID0gKHRhcmdldCwgX3Byb3ApPT57XG4gICAgICAgIGNvbnN0IHByb3h5RnVuY3Rpb24gPSAoKT0+dGFyZ2V0O1xuICAgICAgICByZXR1cm4gbmV3IFByb3h5KHByb3h5RnVuY3Rpb24sIHtcbiAgICAgICAgICAgIGdldDogKF90YXJnZXQsIHByb3BDaGlsZCk9PntcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UGF0aChgJHt0YXJnZXR9LiR7U3RyaW5nKHByb3BDaGlsZCl9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgcmV0dXJuIG5ldyBQcm94eSgoKT0+JycsIHtcbiAgICAgICAgZ2V0OiAoX3RhcmdldCwgcHJvcCk9PntcbiAgICAgICAgICAgIHJldHVybiBnZXRQYXRoKFN0cmluZyhwcm9wKSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cblxuY29uc3QgY3JlYXRlTmV3QnVpbGRlciA9IChpbml0RGVmLCBuZXdEZWYpPT57XG4gICAgY29uc3QgbWVyZ2VkRGVmID0ge1xuICAgICAgICAuLi5pbml0RGVmLFxuICAgICAgICAuLi5uZXdEZWZcbiAgICB9O1xuICAgIHJldHVybiBjcmVhdGVCdWlsZGVyKHtcbiAgICAgICAgdHlwZTogbWVyZ2VkRGVmLnR5cGVcbiAgICB9LCBtZXJnZWREZWYpO1xufTtcbmZ1bmN0aW9uIGNyZWF0ZUJ1aWxkZXIob3B0cywgaW5pdERlZikge1xuICAgIGNvbnN0IF9kZWYgPSB7XG4gICAgICAgIHR5cGU6IG9wdHMudHlwZSxcbiAgICAgICAgaW5wdXQ6IHoubmV2ZXIoKSxcbiAgICAgICAgcGF0aDogW10sXG4gICAgICAgIG1ldGFkYXRhOiAoKT0+KHt9KSxcbiAgICAgICAgLi4uaW5pdERlZlxuICAgIH07XG4gICAgcmV0dXJuIHtcbiAgICAgICAgJGNvbmZpZzoge1xuICAgICAgICAgICAgY3R4OiB1bmRlZmluZWRcbiAgICAgICAgfSxcbiAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciAtIEkgdGhpbmsgaXQgd291bGQgYmUgdG9vIG11Y2ggd29yayB0byBtYWtlIHRoaXMgdHlwZSBjb3JyZWN0LlxuICAgICAgICBfZGVmLFxuICAgICAgICBpbnB1dCAoaW5wdXQpIHtcbiAgICAgICAgICAgIHJldHVybiBjcmVhdGVOZXdCdWlsZGVyKF9kZWYsIHtcbiAgICAgICAgICAgICAgICBpbnB1dFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHBhdGggKHBhdGhSZXNvbHZlcikge1xuICAgICAgICAgICAgLy8gVE9ETzogU2hvdWxkIHRocm93IGEgcnVudGltZSBlcnJvciBpbiB0aGUgZm9sbG93aW5nIGNhc2VzOlxuICAgICAgICAgICAgLy8gMS4gaW4gY2FzZSBvZiBtdWx0aXBsZSBrZXlzIGluIG9uZSBvYmplY3RcbiAgICAgICAgICAgIC8vIDIuIGluIGNhc2Ugb2YgZHVwbGljYXRlIGtleXNcbiAgICAgICAgICAgIGNvbnN0IHBhdGhQYXJhbVByb3h5ID0gY3JlYXRlUGF0aFBhcmFtUHJveHkoKTtcbiAgICAgICAgICAgIGNvbnN0IHBhcmFtcyA9IHBhdGhSZXNvbHZlcihwYXRoUGFyYW1Qcm94eSk7XG4gICAgICAgICAgICByZXR1cm4gY3JlYXRlTmV3QnVpbGRlcihfZGVmLCB7XG4gICAgICAgICAgICAgICAgcGF0aDogcGFyYW1zXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgbWV0YWRhdGEgKG1ldGFkYXRhKSB7XG4gICAgICAgICAgICByZXR1cm4gY3JlYXRlTmV3QnVpbGRlcihfZGVmLCB7XG4gICAgICAgICAgICAgICAgbWV0YWRhdGFcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICBhY2Nlc3NDb250cm9sIChhY2Nlc3NDb250cm9sKSB7XG4gICAgICAgICAgICByZXR1cm4gY3JlYXRlTmV3QnVpbGRlcihfZGVmLCB7XG4gICAgICAgICAgICAgICAgYWNjZXNzQ29udHJvbDogYWNjZXNzQ29udHJvbFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIGJlZm9yZVVwbG9hZCAoYmVmb3JlVXBsb2FkKSB7XG4gICAgICAgICAgICByZXR1cm4gY3JlYXRlTmV3QnVpbGRlcihfZGVmLCB7XG4gICAgICAgICAgICAgICAgYmVmb3JlVXBsb2FkXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgYmVmb3JlRGVsZXRlIChiZWZvcmVEZWxldGUpIHtcbiAgICAgICAgICAgIHJldHVybiBjcmVhdGVOZXdCdWlsZGVyKF9kZWYsIHtcbiAgICAgICAgICAgICAgICBiZWZvcmVEZWxldGVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbn1cbmNsYXNzIEVkZ2VTdG9yZUJ1aWxkZXIge1xuICAgIGNvbnRleHQoKSB7XG4gICAgICAgIHJldHVybiBuZXcgRWRnZVN0b3JlQnVpbGRlcigpO1xuICAgIH1cbiAgICBjcmVhdGUoKSB7XG4gICAgICAgIHJldHVybiBjcmVhdGVFZGdlU3RvcmVJbm5lcigpKCk7XG4gICAgfVxufVxuZnVuY3Rpb24gY3JlYXRlUm91dGVyRmFjdG9yeSgpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gY3JlYXRlUm91dGVySW5uZXIoYnVja2V0cykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgJGNvbmZpZzoge1xuICAgICAgICAgICAgICAgIGN0eDogdW5kZWZpbmVkXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYnVja2V0c1xuICAgICAgICB9O1xuICAgIH07XG59XG5mdW5jdGlvbiBpbml0QnVja2V0KHR5cGUsIGNvbmZpZykge1xuICAgIHJldHVybiBjcmVhdGVCdWlsZGVyKHtcbiAgICAgICAgdHlwZVxuICAgIH0sIHtcbiAgICAgICAgYnVja2V0Q29uZmlnOiBjb25maWdcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZUVkZ2VTdG9yZUlubmVyKCkge1xuICAgIHJldHVybiBmdW5jdGlvbiBpbml0RWRnZVN0b3JlSW5uZXIoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAvKipcbiAgICAgICAqIEJ1aWxkZXIgb2JqZWN0IGZvciBjcmVhdGluZyBhbiBpbWFnZSBidWNrZXRcbiAgICAgICAqLyBpbWFnZUJ1Y2tldCAoY29uZmlnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGluaXRCdWNrZXQoJ0lNQUdFJywgY29uZmlnKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvKipcbiAgICAgICAqIEJ1aWxkZXIgb2JqZWN0IGZvciBjcmVhdGluZyBhIGZpbGUgYnVja2V0XG4gICAgICAgKi8gZmlsZUJ1Y2tldCAoY29uZmlnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGluaXRCdWNrZXQoJ0ZJTEUnLCBjb25maWcpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8qKlxuICAgICAgICogQ3JlYXRlIGEgcm91dGVyXG4gICAgICAgKi8gcm91dGVyOiBjcmVhdGVSb3V0ZXJGYWN0b3J5KClcbiAgICAgICAgfTtcbiAgICB9O1xufVxuLyoqXG4gKiBJbml0aWFsaXplIEVkZ2VTdG9yZSAtIGJlIGRvbmUgZXhhY3RseSBvbmNlIHBlciBiYWNrZW5kXG4gKi8gY29uc3QgaW5pdEVkZ2VTdG9yZSA9IG5ldyBFZGdlU3RvcmVCdWlsZGVyKCk7IC8vIOKGk+KGk+KGkyBUWVBFIFRFU1RTIOKGk+KGk+KGk1xuIC8vIHR5cGUgQ29udGV4dCA9IHtcbiAvLyAgIHVzZXJJZDogc3RyaW5nO1xuIC8vICAgdXNlclJvbGU6ICdhZG1pbicgfCAndmlzaXRvcic7XG4gLy8gfTtcbiAvLyBjb25zdCBlcyA9IGluaXRFZGdlU3RvcmUuY29udGV4dDxDb250ZXh0PigpLmNyZWF0ZSgpO1xuIC8vIGNvbnN0IGltYWdlc0J1Y2tldCA9IGVzLmltYWdlQnVja2V0KClcbiAvLyAgIC5pbnB1dChcbiAvLyAgICAgei5vYmplY3Qoe1xuIC8vICAgICAgIHR5cGU6IHouZW51bShbJ3Byb2ZpbGUnLCAncG9zdCddKSxcbiAvLyAgICAgICBleHRlbnNpb246IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAvLyAgICAgfSksXG4gLy8gICApXG4gLy8gICAucGF0aCgoeyBjdHgsIGlucHV0IH0pID0+IFt7IGF1dGhvcjogY3R4LnVzZXJJZCB9LCB7IHR5cGU6IGlucHV0LnR5cGUgfV0pXG4gLy8gICAubWV0YWRhdGEoKHsgY3R4LCBpbnB1dCB9KSA9PiAoe1xuIC8vICAgICBleHRlbnNpb246IGlucHV0LmV4dGVuc2lvbixcbiAvLyAgICAgcm9sZTogY3R4LnVzZXJSb2xlLFxuIC8vICAgfSkpXG4gLy8gICAuYmVmb3JlVXBsb2FkKCgpID0+IHtcbiAvLyAgICAgcmV0dXJuIHRydWU7XG4gLy8gICB9KTtcbiAvLyBjb25zdCBhID0gZXMuaW1hZ2VCdWNrZXQoKVxuIC8vICAgLmlucHV0KHoub2JqZWN0KHsgdHlwZTogei5zdHJpbmcoKSwgc29tZU1ldGE6IHouc3RyaW5nKCkub3B0aW9uYWwoKSB9KSlcbiAvLyAgIC5wYXRoKCh7IGN0eCwgaW5wdXQgfSkgPT4gW3sgYXV0aG9yOiBjdHgudXNlcklkIH0sIHsgdHlwZTogaW5wdXQudHlwZSB9XSlcbiAvLyAgIC5tZXRhZGF0YSgoeyBjdHgsIGlucHV0IH0pID0+ICh7XG4gLy8gICAgIHJvbGU6IGN0eC51c2VyUm9sZSxcbiAvLyAgICAgc29tZU1ldGE6IGlucHV0LnNvbWVNZXRhLFxuIC8vICAgfSkpXG4gLy8gICAuYWNjZXNzQ29udHJvbCh7XG4gLy8gICAgIE9SOiBbXG4gLy8gICAgICAge1xuIC8vICAgICAgICAgdXNlcklkOiB7IHBhdGg6ICdhdXRob3InIH0sIC8vIHRoaXMgd2lsbCBjaGVjayBpZiB0aGUgdXNlcklkIGlzIHRoZSBzYW1lIGFzIHRoZSBhdXRob3IgaW4gdGhlIHBhdGggcGFyYW1ldGVyXG4gLy8gICAgICAgfSxcbiAvLyAgICAgICB7XG4gLy8gICAgICAgICB1c2VyUm9sZTogJ2FkbWluJywgLy8gdGhpcyBpcyB0aGUgc2FtZSBhcyB7IHVzZXJSb2xlOiB7IGVxOiBcImFkbWluXCIgfSB9XG4gLy8gICAgICAgfSxcbiAvLyAgICAgXSxcbiAvLyAgIH0pXG4gLy8gICAuYmVmb3JlVXBsb2FkKCh7IGN0eCwgaW5wdXQgfSkgPT4ge1xuIC8vICAgICByZXR1cm4gdHJ1ZTtcbiAvLyAgIH0pXG4gLy8gICAuYmVmb3JlRGVsZXRlKCh7IGN0eCwgZmlsZSB9KSA9PiB7XG4gLy8gICAgIHJldHVybiB0cnVlO1xuIC8vICAgfSk7XG4gLy8gY29uc3QgYiA9IGVzLmltYWdlQnVja2V0KCkucGF0aCgoeyBjdHggfSkgPT4gW3sgYXV0aG9yOiBjdHgudXNlcklkIH1dKTtcbiAvLyBjb25zdCByb3V0ZXIgPSBlcy5yb3V0ZXIoe1xuIC8vICAgb3JpZ2luYWw6IGltYWdlc0J1Y2tldCxcbiAvLyAgIGltYWdlQnVja2V0OiBhLFxuIC8vICAgaW1hZ2VCdWNrZXQyOiBiLFxuIC8vIH0pO1xuIC8vIGV4cG9ydCB7IHJvdXRlciB9O1xuIC8vIHR5cGUgTGlzdEZpbGVzUmVzcG9uc2U8VEJ1Y2tldCBleHRlbmRzIEFueVJvdXRlclsnYnVja2V0cyddW3N0cmluZ10+ID0ge1xuIC8vICAgZGF0YToge1xuIC8vICAgICAvLyB1cmw6IHN0cmluZztcbiAvLyAgICAgLy8gc2l6ZTogbnVtYmVyO1xuIC8vICAgICAvLyB1cGxvYWRlZEF0OiBEYXRlO1xuIC8vICAgICAvLyBtZXRhZGF0YTogSW5mZXJNZXRhZGF0YU9iamVjdDxUQnVja2V0PjtcbiAvLyAgICAgcGF0aDogSW5mZXJCdWNrZXRQYXRoS2V5czxUQnVja2V0PiBleHRlbmRzIHN0cmluZyA/IHtcbiAvLyAgICAgICBba2V5OiBzdHJpbmddOiBzdHJpbmc7XG4gLy8gICAgIH0gOntcbiAvLyAgICAgICBbVEtleSBpbiBJbmZlckJ1Y2tldFBhdGhLZXlzPFRCdWNrZXQ+XTogc3RyaW5nO1xuIC8vICAgICB9O1xuIC8vICAgfVtdO1xuIC8vICAgcGFnaW5hdGlvbjoge1xuIC8vICAgICBjdXJyZW50UGFnZTogbnVtYmVyO1xuIC8vICAgICB0b3RhbFBhZ2VzOiBudW1iZXI7XG4gLy8gICAgIHRvdGFsQ291bnQ6IG51bWJlcjtcbiAvLyAgIH07XG4gLy8gfTtcbiAvLyB0eXBlIFRQYXRoS2V5cyA9ICdhdXRob3InIHwgJ3R5cGUnO1xuIC8vIHR5cGUgVFBhdGhLZXlzMiA9IEluZmVyQnVja2V0UGF0aEtleXM8QW55QnVpbGRlcj47XG4gLy8gdHlwZSBPYmplY3RXaXRoS2V5czxUS2V5cyBleHRlbmRzIHN0cmluZz4gPSB7XG4gLy8gICBbVEtleSBpbiBUS2V5c106IHN0cmluZztcbiAvLyB9O1xuIC8vIHR5cGUgVGVzdDEgPSBPYmplY3RXaXRoS2V5czxUUGF0aEtleXM+O1xuIC8vIHR5cGUgVGVzdDIgPSBPYmplY3RXaXRoS2V5czxUUGF0aEtleXMyPjtcbiAvLyB0eXBlIFBhdGhLZXlzID0gSW5mZXJCdWNrZXRQYXRoS2V5czx0eXBlb2Ygcm91dGVyLmJ1Y2tldHMuaW1hZ2VCdWNrZXQ+O1xuIC8vIHR5cGUgTWV0YWRhdGFLZXlzID0gSW5mZXJNZXRhZGF0YU9iamVjdDx0eXBlb2Ygcm91dGVyLmJ1Y2tldHMuaW1hZ2VCdWNrZXQ+O1xuIC8vIHR5cGUgTXlFZGdlU3RvcmVSb3V0ZXIgPSB0eXBlb2Ygcm91dGVyO1xuIC8vIHR5cGUgTXlBY2Nlc3NDb250cm9sID0gQWNjZXNzQ29udHJvbFNjaGVtYTxDb250ZXh0LCBBbnlEZWY+O1xuXG5leHBvcnQgeyBFREdFX1NUT1JFX0VSUk9SX0NPREVTLCBFZGdlU3RvcmVBcGlDbGllbnRFcnJvciwgRWRnZVN0b3JlRXJyb3IsIGluaXRFZGdlU3RvcmUgfTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@edgestore/shared/dist/index.mjs\n");

/***/ }),

/***/ "(rsc)/./node_modules/@edgestore/server/dist/adapters/next/app/index.mjs":
/*!*************************************************************************!*\
  !*** ./node_modules/@edgestore/server/dist/adapters/next/app/index.mjs ***!
  \*************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createEdgeStoreNextHandler: () => (/* binding */ createEdgeStoreNextHandler)\n/* harmony export */ });\n/* harmony import */ var _edgestore_shared__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @edgestore/shared */ \"(rsc)/./node_modules/@edgestore/shared/dist/index.mjs\");\n/* harmony import */ var _logger_09f43a75_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../logger-09f43a75.mjs */ \"(rsc)/./node_modules/@edgestore/server/dist/logger-09f43a75.mjs\");\n/* harmony import */ var _providers_edgestore_index_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../providers/edgestore/index.mjs */ \"(rsc)/./node_modules/@edgestore/server/dist/providers/edgestore/index.mjs\");\n/* harmony import */ var _shared_039276af_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../shared-039276af.mjs */ \"(rsc)/./node_modules/@edgestore/server/dist/shared-039276af.mjs\");\n/* harmony import */ var _index_28efdacf_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../index-28efdacf.mjs */ \"(rsc)/./node_modules/@edgestore/server/dist/index-28efdacf.mjs\");\n/* harmony import */ var _panva_hkdf__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @panva/hkdf */ \"(rsc)/./node_modules/@panva/hkdf/dist/node/esm/index.js\");\n/* harmony import */ var cookie__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! cookie */ \"(rsc)/./node_modules/cookie/index.js\");\n/* harmony import */ var jose__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! jose */ \"(rsc)/./node_modules/jose/dist/node/esm/index.js\");\n\n\n\n\n\n\n\n\n\n\nfunction createEdgeStoreNextHandler(config) {\n    const { provider = (0,_providers_edgestore_index_mjs__WEBPACK_IMPORTED_MODULE_2__.EdgeStoreProvider)() } = config;\n    const log = new _logger_09f43a75_mjs__WEBPACK_IMPORTED_MODULE_1__.L(config.logLevel);\n    globalThis._EDGE_STORE_LOGGER = log;\n    log.debug('Creating Edge Store Next handler (app adapter)');\n    return async (req)=>{\n        try {\n            if (!('nextUrl' in req)) throw new _edgestore_shared__WEBPACK_IMPORTED_MODULE_0__.EdgeStoreError({\n                message: 'Error running the app adapter. Make sure you are importing the correct adapter in your router configuration',\n                code: 'SERVER_ERROR'\n            });\n            if (req.nextUrl.pathname.endsWith('/health')) {\n                return new Response('OK', {\n                    status: 200\n                });\n            } else if (req.nextUrl.pathname.endsWith('/init')) {\n                let ctx = {};\n                try {\n                    ctx = 'createContext' in config ? await config.createContext({\n                        req\n                    }) : {};\n                } catch (err) {\n                    throw new _edgestore_shared__WEBPACK_IMPORTED_MODULE_0__.EdgeStoreError({\n                        message: 'Error creating context',\n                        code: 'CREATE_CONTEXT_ERROR',\n                        cause: err instanceof Error ? err : undefined\n                    });\n                }\n                const { newCookies, token, baseUrl } = await (0,_shared_039276af_mjs__WEBPACK_IMPORTED_MODULE_3__.i)({\n                    ctx,\n                    provider,\n                    router: config.router\n                });\n                const res = new Response(JSON.stringify({\n                    token,\n                    baseUrl\n                }), {\n                    status: 200,\n                    headers: {\n                        'Content-Type': 'application/json'\n                    }\n                });\n                for (const cookie of newCookies){\n                    res.headers.append('Set-Cookie', cookie);\n                }\n                return res;\n            } else if (req.nextUrl.pathname.endsWith('/request-upload')) {\n                const res = await (0,_shared_039276af_mjs__WEBPACK_IMPORTED_MODULE_3__.r)({\n                    provider,\n                    router: config.router,\n                    body: await req.json(),\n                    ctxToken: req.cookies.get('edgestore-ctx')?.value\n                });\n                return new Response(JSON.stringify(res), {\n                    status: 200,\n                    headers: {\n                        'Content-Type': 'application/json'\n                    }\n                });\n            } else if (req.nextUrl.pathname.endsWith('/request-upload-parts')) {\n                const res = await (0,_shared_039276af_mjs__WEBPACK_IMPORTED_MODULE_3__.a)({\n                    provider,\n                    router: config.router,\n                    body: await req.json(),\n                    ctxToken: req.cookies.get('edgestore-ctx')?.value\n                });\n                return new Response(JSON.stringify(res), {\n                    status: 200,\n                    headers: {\n                        'Content-Type': 'application/json'\n                    }\n                });\n            } else if (req.nextUrl.pathname.endsWith('/complete-multipart-upload')) {\n                await (0,_shared_039276af_mjs__WEBPACK_IMPORTED_MODULE_3__.c)({\n                    provider,\n                    router: config.router,\n                    body: await req.json(),\n                    ctxToken: req.cookies.get('edgestore-ctx')?.value\n                });\n                return new Response(null, {\n                    status: 200\n                });\n            } else if (req.nextUrl.pathname.endsWith('/confirm-upload')) {\n                const res = await (0,_shared_039276af_mjs__WEBPACK_IMPORTED_MODULE_3__.d)({\n                    provider,\n                    router: config.router,\n                    body: await req.json(),\n                    ctxToken: req.cookies.get('edgestore-ctx')?.value\n                });\n                return new Response(JSON.stringify(res), {\n                    status: 200,\n                    headers: {\n                        'Content-Type': 'application/json'\n                    }\n                });\n            } else if (req.nextUrl.pathname.endsWith('/delete-file')) {\n                const res = await (0,_shared_039276af_mjs__WEBPACK_IMPORTED_MODULE_3__.e)({\n                    provider,\n                    router: config.router,\n                    body: await req.json(),\n                    ctxToken: req.cookies.get('edgestore-ctx')?.value\n                });\n                return new Response(JSON.stringify(res), {\n                    status: 200,\n                    headers: {\n                        'Content-Type': 'application/json'\n                    }\n                });\n            } else if (req.nextUrl.pathname.endsWith('/proxy-file')) {\n                const url = req.nextUrl.searchParams.get('url');\n                if (typeof url === 'string') {\n                    const proxyRes = await fetch(url, {\n                        headers: {\n                            cookie: req.cookies.toString() ?? ''\n                        }\n                    });\n                    const data = await proxyRes.arrayBuffer();\n                    return new Response(data, {\n                        status: proxyRes.status,\n                        headers: {\n                            'Content-Type': proxyRes.headers.get('Content-Type') ?? 'application/octet-stream'\n                        }\n                    });\n                } else {\n                    return new Response(null, {\n                        status: 400\n                    });\n                }\n            } else {\n                return new Response(null, {\n                    status: 404\n                });\n            }\n        } catch (err) {\n            if (err instanceof _edgestore_shared__WEBPACK_IMPORTED_MODULE_0__.EdgeStoreError) {\n                log[err.level](err.formattedMessage());\n                if (err.cause) log[err.level](err.cause);\n                return new Response(JSON.stringify(err.formattedJson()), {\n                    status: _edgestore_shared__WEBPACK_IMPORTED_MODULE_0__.EDGE_STORE_ERROR_CODES[err.code],\n                    headers: {\n                        'Content-Type': 'application/json'\n                    }\n                });\n            }\n            log.error(err);\n            return new Response(JSON.stringify(new _edgestore_shared__WEBPACK_IMPORTED_MODULE_0__.EdgeStoreError({\n                message: 'Internal server error',\n                code: 'SERVER_ERROR'\n            }).formattedJson()), {\n                status: 500,\n                headers: {\n                    'Content-Type': 'application/json'\n                }\n            });\n        }\n    };\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvQGVkZ2VzdG9yZS9zZXJ2ZXIvZGlzdC9hZGFwdGVycy9uZXh0L2FwcC9pbmRleC5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQTJFO0FBQ2hCO0FBQ2dCO0FBQzhGO0FBQ3BJO0FBQ2hCO0FBQ0w7QUFDRjtBQUNBOztBQUVkO0FBQ0EsWUFBWSxXQUFXLGlGQUFpQixLQUFLO0FBQzdDLG9CQUFvQixtREFBTTtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtDQUErQyw2REFBYztBQUM3RDtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckIsa0JBQWtCO0FBQ2xCLDhCQUE4Qiw2REFBYztBQUM1QztBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQSx3QkFBd0IsNkJBQTZCLFFBQVEsdURBQUk7QUFDakU7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZCxrQ0FBa0MsdURBQWE7QUFDL0M7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixjQUFjO0FBQ2Qsa0NBQWtDLHVEQUFrQjtBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGNBQWM7QUFDZCxzQkFBc0IsdURBQXVCO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsY0FBYztBQUNkLGtDQUFrQyx1REFBYTtBQUMvQztBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGNBQWM7QUFDZCxrQ0FBa0MsdURBQVU7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQixrQkFBa0I7QUFDbEI7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsVUFBVTtBQUNWLCtCQUErQiw2REFBYztBQUM3QztBQUNBO0FBQ0E7QUFDQSw0QkFBNEIscUVBQXNCO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsbURBQW1ELDZEQUFjO0FBQ2pFO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBOztBQUVzQyIsInNvdXJjZXMiOlsid2VicGFjazovL3N0b3JlLy4vbm9kZV9tb2R1bGVzL0BlZGdlc3RvcmUvc2VydmVyL2Rpc3QvYWRhcHRlcnMvbmV4dC9hcHAvaW5kZXgubWpzP2Y4MTQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRWRnZVN0b3JlRXJyb3IsIEVER0VfU1RPUkVfRVJST1JfQ09ERVMgfSBmcm9tICdAZWRnZXN0b3JlL3NoYXJlZCc7XG5pbXBvcnQgeyBMIGFzIExvZ2dlciB9IGZyb20gJy4uLy4uLy4uL2xvZ2dlci0wOWY0M2E3NS5tanMnO1xuaW1wb3J0IHsgRWRnZVN0b3JlUHJvdmlkZXIgfSBmcm9tICcuLi8uLi8uLi9wcm92aWRlcnMvZWRnZXN0b3JlL2luZGV4Lm1qcyc7XG5pbXBvcnQgeyBpIGFzIGluaXQsIHIgYXMgcmVxdWVzdFVwbG9hZCwgYSBhcyByZXF1ZXN0VXBsb2FkUGFydHMsIGMgYXMgY29tcGxldGVNdWx0aXBhcnRVcGxvYWQsIGQgYXMgY29uZmlybVVwbG9hZCwgZSBhcyBkZWxldGVGaWxlIH0gZnJvbSAnLi4vLi4vLi4vc2hhcmVkLTAzOTI3NmFmLm1qcyc7XG5pbXBvcnQgJy4uLy4uLy4uL2luZGV4LTI4ZWZkYWNmLm1qcyc7XG5pbXBvcnQgJ0BwYW52YS9oa2RmJztcbmltcG9ydCAnY29va2llJztcbmltcG9ydCAnam9zZSc7XG5pbXBvcnQgJ3V1aWQnO1xuXG5mdW5jdGlvbiBjcmVhdGVFZGdlU3RvcmVOZXh0SGFuZGxlcihjb25maWcpIHtcbiAgICBjb25zdCB7IHByb3ZpZGVyID0gRWRnZVN0b3JlUHJvdmlkZXIoKSB9ID0gY29uZmlnO1xuICAgIGNvbnN0IGxvZyA9IG5ldyBMb2dnZXIoY29uZmlnLmxvZ0xldmVsKTtcbiAgICBnbG9iYWxUaGlzLl9FREdFX1NUT1JFX0xPR0dFUiA9IGxvZztcbiAgICBsb2cuZGVidWcoJ0NyZWF0aW5nIEVkZ2UgU3RvcmUgTmV4dCBoYW5kbGVyIChhcHAgYWRhcHRlciknKTtcbiAgICByZXR1cm4gYXN5bmMgKHJlcSk9PntcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmICghKCduZXh0VXJsJyBpbiByZXEpKSB0aHJvdyBuZXcgRWRnZVN0b3JlRXJyb3Ioe1xuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdFcnJvciBydW5uaW5nIHRoZSBhcHAgYWRhcHRlci4gTWFrZSBzdXJlIHlvdSBhcmUgaW1wb3J0aW5nIHRoZSBjb3JyZWN0IGFkYXB0ZXIgaW4geW91ciByb3V0ZXIgY29uZmlndXJhdGlvbicsXG4gICAgICAgICAgICAgICAgY29kZTogJ1NFUlZFUl9FUlJPUidcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKHJlcS5uZXh0VXJsLnBhdGhuYW1lLmVuZHNXaXRoKCcvaGVhbHRoJykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKCdPSycsIHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAyMDBcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVxLm5leHRVcmwucGF0aG5hbWUuZW5kc1dpdGgoJy9pbml0JykpIHtcbiAgICAgICAgICAgICAgICBsZXQgY3R4ID0ge307XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgY3R4ID0gJ2NyZWF0ZUNvbnRleHQnIGluIGNvbmZpZyA/IGF3YWl0IGNvbmZpZy5jcmVhdGVDb250ZXh0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcVxuICAgICAgICAgICAgICAgICAgICB9KSA6IHt9O1xuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRWRnZVN0b3JlRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ0Vycm9yIGNyZWF0aW5nIGNvbnRleHQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29kZTogJ0NSRUFURV9DT05URVhUX0VSUk9SJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhdXNlOiBlcnIgaW5zdGFuY2VvZiBFcnJvciA/IGVyciA6IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgeyBuZXdDb29raWVzLCB0b2tlbiwgYmFzZVVybCB9ID0gYXdhaXQgaW5pdCh7XG4gICAgICAgICAgICAgICAgICAgIGN0eCxcbiAgICAgICAgICAgICAgICAgICAgcHJvdmlkZXIsXG4gICAgICAgICAgICAgICAgICAgIHJvdXRlcjogY29uZmlnLnJvdXRlclxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlcyA9IG5ldyBSZXNwb25zZShKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgICAgIHRva2VuLFxuICAgICAgICAgICAgICAgICAgICBiYXNlVXJsXG4gICAgICAgICAgICAgICAgfSksIHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAyMDAsXG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgY29va2llIG9mIG5ld0Nvb2tpZXMpe1xuICAgICAgICAgICAgICAgICAgICByZXMuaGVhZGVycy5hcHBlbmQoJ1NldC1Db29raWUnLCBjb29raWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChyZXEubmV4dFVybC5wYXRobmFtZS5lbmRzV2l0aCgnL3JlcXVlc3QtdXBsb2FkJykpIHtcbiAgICAgICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0VXBsb2FkKHtcbiAgICAgICAgICAgICAgICAgICAgcHJvdmlkZXIsXG4gICAgICAgICAgICAgICAgICAgIHJvdXRlcjogY29uZmlnLnJvdXRlcixcbiAgICAgICAgICAgICAgICAgICAgYm9keTogYXdhaXQgcmVxLmpzb24oKSxcbiAgICAgICAgICAgICAgICAgICAgY3R4VG9rZW46IHJlcS5jb29raWVzLmdldCgnZWRnZXN0b3JlLWN0eCcpPy52YWx1ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UoSlNPTi5zdHJpbmdpZnkocmVzKSwge1xuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IDIwMCxcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHJlcS5uZXh0VXJsLnBhdGhuYW1lLmVuZHNXaXRoKCcvcmVxdWVzdC11cGxvYWQtcGFydHMnKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3RVcGxvYWRQYXJ0cyh7XG4gICAgICAgICAgICAgICAgICAgIHByb3ZpZGVyLFxuICAgICAgICAgICAgICAgICAgICByb3V0ZXI6IGNvbmZpZy5yb3V0ZXIsXG4gICAgICAgICAgICAgICAgICAgIGJvZHk6IGF3YWl0IHJlcS5qc29uKCksXG4gICAgICAgICAgICAgICAgICAgIGN0eFRva2VuOiByZXEuY29va2llcy5nZXQoJ2VkZ2VzdG9yZS1jdHgnKT8udmFsdWVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKEpTT04uc3RyaW5naWZ5KHJlcyksIHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAyMDAsXG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChyZXEubmV4dFVybC5wYXRobmFtZS5lbmRzV2l0aCgnL2NvbXBsZXRlLW11bHRpcGFydC11cGxvYWQnKSkge1xuICAgICAgICAgICAgICAgIGF3YWl0IGNvbXBsZXRlTXVsdGlwYXJ0VXBsb2FkKHtcbiAgICAgICAgICAgICAgICAgICAgcHJvdmlkZXIsXG4gICAgICAgICAgICAgICAgICAgIHJvdXRlcjogY29uZmlnLnJvdXRlcixcbiAgICAgICAgICAgICAgICAgICAgYm9keTogYXdhaXQgcmVxLmpzb24oKSxcbiAgICAgICAgICAgICAgICAgICAgY3R4VG9rZW46IHJlcS5jb29raWVzLmdldCgnZWRnZXN0b3JlLWN0eCcpPy52YWx1ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UobnVsbCwge1xuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IDIwMFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChyZXEubmV4dFVybC5wYXRobmFtZS5lbmRzV2l0aCgnL2NvbmZpcm0tdXBsb2FkJykpIHtcbiAgICAgICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBjb25maXJtVXBsb2FkKHtcbiAgICAgICAgICAgICAgICAgICAgcHJvdmlkZXIsXG4gICAgICAgICAgICAgICAgICAgIHJvdXRlcjogY29uZmlnLnJvdXRlcixcbiAgICAgICAgICAgICAgICAgICAgYm9keTogYXdhaXQgcmVxLmpzb24oKSxcbiAgICAgICAgICAgICAgICAgICAgY3R4VG9rZW46IHJlcS5jb29raWVzLmdldCgnZWRnZXN0b3JlLWN0eCcpPy52YWx1ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UoSlNPTi5zdHJpbmdpZnkocmVzKSwge1xuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IDIwMCxcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHJlcS5uZXh0VXJsLnBhdGhuYW1lLmVuZHNXaXRoKCcvZGVsZXRlLWZpbGUnKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGRlbGV0ZUZpbGUoe1xuICAgICAgICAgICAgICAgICAgICBwcm92aWRlcixcbiAgICAgICAgICAgICAgICAgICAgcm91dGVyOiBjb25maWcucm91dGVyLFxuICAgICAgICAgICAgICAgICAgICBib2R5OiBhd2FpdCByZXEuanNvbigpLFxuICAgICAgICAgICAgICAgICAgICBjdHhUb2tlbjogcmVxLmNvb2tpZXMuZ2V0KCdlZGdlc3RvcmUtY3R4Jyk/LnZhbHVlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShKU09OLnN0cmluZ2lmeShyZXMpLCB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czogMjAwLFxuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVxLm5leHRVcmwucGF0aG5hbWUuZW5kc1dpdGgoJy9wcm94eS1maWxlJykpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB1cmwgPSByZXEubmV4dFVybC5zZWFyY2hQYXJhbXMuZ2V0KCd1cmwnKTtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHVybCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJveHlSZXMgPSBhd2FpdCBmZXRjaCh1cmwsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29raWU6IHJlcS5jb29raWVzLnRvU3RyaW5nKCkgPz8gJydcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBwcm94eVJlcy5hcnJheUJ1ZmZlcigpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKGRhdGEsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogcHJveHlSZXMuc3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiBwcm94eVJlcy5oZWFkZXJzLmdldCgnQ29udGVudC1UeXBlJykgPz8gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSdcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShudWxsLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IDQwMFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UobnVsbCwge1xuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IDQwNFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIGlmIChlcnIgaW5zdGFuY2VvZiBFZGdlU3RvcmVFcnJvcikge1xuICAgICAgICAgICAgICAgIGxvZ1tlcnIubGV2ZWxdKGVyci5mb3JtYXR0ZWRNZXNzYWdlKCkpO1xuICAgICAgICAgICAgICAgIGlmIChlcnIuY2F1c2UpIGxvZ1tlcnIubGV2ZWxdKGVyci5jYXVzZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShKU09OLnN0cmluZ2lmeShlcnIuZm9ybWF0dGVkSnNvbigpKSwge1xuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IEVER0VfU1RPUkVfRVJST1JfQ09ERVNbZXJyLmNvZGVdLFxuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxvZy5lcnJvcihlcnIpO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShKU09OLnN0cmluZ2lmeShuZXcgRWRnZVN0b3JlRXJyb3Ioe1xuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgICAgICAgICAgIGNvZGU6ICdTRVJWRVJfRVJST1InXG4gICAgICAgICAgICB9KS5mb3JtYXR0ZWRKc29uKCkpLCB7XG4gICAgICAgICAgICAgICAgc3RhdHVzOiA1MDAsXG4gICAgICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xufVxuXG5leHBvcnQgeyBjcmVhdGVFZGdlU3RvcmVOZXh0SGFuZGxlciB9O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/@edgestore/server/dist/adapters/next/app/index.mjs\n");

/***/ }),

/***/ "(rsc)/./node_modules/@edgestore/server/dist/index-28efdacf.mjs":
/*!****************************************************************!*\
  !*** ./node_modules/@edgestore/server/dist/index-28efdacf.mjs ***!
  \****************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   E: () => (/* binding */ EdgeStoreCredentialsError),\n/* harmony export */   e: () => (/* binding */ edgeStoreRawSdk),\n/* harmony export */   i: () => (/* binding */ initEdgeStoreSdk)\n/* harmony export */ });\n/* harmony import */ var _edgestore_shared__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @edgestore/shared */ \"(rsc)/./node_modules/@edgestore/shared/dist/index.mjs\");\n\n\nconst DEFAULT_MESSAGE = `Missing EDGE_STORE_ACCESS_KEY or EDGE_STORE_SECRET_KEY. \nThis can happen if you are trying to import something related to the backend of Edge Store in a client component.`;\nclass EdgeStoreCredentialsError extends Error {\n    constructor(message = DEFAULT_MESSAGE){\n        super(message);\n        this.name = 'EdgeStoreCredentialsError';\n    }\n}\n\nconst API_ENDPOINT = process.env.EDGE_STORE_API_ENDPOINT ?? 'https://api.edgestore.dev';\nasync function makeRequest(params) {\n    const { body, accessKey, secretKey, path } = params;\n    const res = await fetch(`${API_ENDPOINT}${path}`, {\n        method: 'POST',\n        body: JSON.stringify(body),\n        headers: {\n            'Content-Type': 'application/json',\n            Authorization: `Basic ${Buffer.from(`${accessKey}:${secretKey}`).toString('base64')}`\n        }\n    });\n    if (!res.ok) {\n        throw new Error(`Failed to make request to ${path}: ${await res.text()}`);\n    }\n    return await res.json();\n}\nconst edgeStoreRawSdk = {\n    async getToken (params) {\n        const reqBuckets = Object.entries(params.router.buckets).reduce((acc, [bucketName, bucket])=>{\n            acc[bucketName] = {\n                path: bucket._def.path.map((p)=>{\n                    const paramEntries = Object.entries(p);\n                    if (paramEntries[0] === undefined) {\n                        throw new _edgestore_shared__WEBPACK_IMPORTED_MODULE_0__.EdgeStoreError({\n                            message: `Empty path param found in: ${JSON.stringify(bucket._def.path)}`,\n                            code: 'SERVER_ERROR'\n                        });\n                    }\n                    const [key, value] = paramEntries[0];\n                    return {\n                        key,\n                        value: value()\n                    };\n                }),\n                accessControl: bucket._def.accessControl\n            };\n            return acc;\n        }, {});\n        const { token } = await makeRequest({\n            body: {\n                ctx: params.ctx,\n                buckets: reqBuckets\n            },\n            accessKey: params.accessKey,\n            secretKey: params.secretKey,\n            path: '/get-token'\n        });\n        return token;\n    },\n    async getFile ({ accessKey, secretKey, url }) {\n        return await makeRequest({\n            path: '/get-file',\n            accessKey,\n            secretKey,\n            body: {\n                url\n            }\n        });\n    },\n    async requestUpload ({ accessKey, secretKey, bucketName, bucketType, fileInfo, multipart }) {\n        const res = await makeRequest({\n            path: '/request-upload',\n            accessKey,\n            secretKey,\n            body: {\n                multipart,\n                bucketName,\n                bucketType,\n                isPublic: fileInfo.isPublic,\n                path: fileInfo.path,\n                extension: fileInfo.extension,\n                size: fileInfo.size,\n                mimeType: fileInfo.type,\n                metadata: fileInfo.metadata,\n                fileName: fileInfo.fileName,\n                replaceTargetUrl: fileInfo.replaceTargetUrl,\n                isTemporary: fileInfo.temporary\n            }\n        });\n        return {\n            multipart: res.multipart,\n            signedUrl: res.signedUrl,\n            accessUrl: res.url,\n            path: res.path,\n            thumbnailUrl: res.thumbnailUrl\n        };\n    },\n    async requestUploadParts ({ accessKey, secretKey, key, multipart }) {\n        const res = await makeRequest({\n            path: '/request-upload-parts',\n            accessKey,\n            secretKey,\n            body: {\n                multipart,\n                key\n            }\n        });\n        return {\n            multipart: res.multipart\n        };\n    },\n    async completeMultipartUpload ({ accessKey, secretKey, uploadId, key, parts }) {\n        return await makeRequest({\n            path: '/complete-multipart-upload',\n            accessKey,\n            secretKey,\n            body: {\n                uploadId,\n                key,\n                parts\n            }\n        });\n    },\n    async confirmUpload ({ accessKey, secretKey, url }) {\n        return await makeRequest({\n            path: '/confirm-upload',\n            accessKey,\n            secretKey,\n            body: {\n                url\n            }\n        });\n    },\n    async deleteFile ({ accessKey, secretKey, url }) {\n        return await makeRequest({\n            path: '/delete-file',\n            accessKey,\n            secretKey,\n            body: {\n                url\n            }\n        });\n    },\n    async listFiles ({ accessKey, secretKey, bucketName, filter, pagination }) {\n        return await makeRequest({\n            path: '/list-files',\n            accessKey,\n            secretKey,\n            body: {\n                bucketName,\n                filter,\n                pagination\n            }\n        });\n    }\n};\nfunction initEdgeStoreSdk(params) {\n    const { accessKey = process.env.EDGE_STORE_ACCESS_KEY, secretKey = process.env.EDGE_STORE_SECRET_KEY } = params ?? {};\n    if (!accessKey || !secretKey) {\n        throw new EdgeStoreCredentialsError();\n    }\n    return {\n        async getToken (params) {\n            return await edgeStoreRawSdk.getToken({\n                accessKey,\n                secretKey,\n                ctx: params.ctx,\n                router: params.router\n            });\n        },\n        async getFile ({ url }) {\n            return await edgeStoreRawSdk.getFile({\n                accessKey,\n                secretKey,\n                url\n            });\n        },\n        async requestUpload ({ bucketName, bucketType, fileInfo, multipart }) {\n            return await edgeStoreRawSdk.requestUpload({\n                accessKey,\n                secretKey,\n                bucketName,\n                bucketType,\n                fileInfo,\n                multipart\n            });\n        },\n        async requestUploadParts ({ key, multipart }) {\n            return await edgeStoreRawSdk.requestUploadParts({\n                accessKey,\n                secretKey,\n                key,\n                multipart\n            });\n        },\n        async completeMultipartUpload ({ uploadId, key, parts }) {\n            return await edgeStoreRawSdk.completeMultipartUpload({\n                accessKey,\n                secretKey,\n                uploadId,\n                key,\n                parts\n            });\n        },\n        async confirmUpload ({ url }) {\n            return await edgeStoreRawSdk.confirmUpload({\n                accessKey,\n                secretKey,\n                url\n            });\n        },\n        async deleteFile ({ url }) {\n            return await edgeStoreRawSdk.deleteFile({\n                accessKey,\n                secretKey,\n                url\n            });\n        },\n        async listFiles (params) {\n            return await edgeStoreRawSdk.listFiles({\n                accessKey,\n                secretKey,\n                ...params\n            });\n        }\n    };\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvQGVkZ2VzdG9yZS9zZXJ2ZXIvZGlzdC9pbmRleC0yOGVmZGFjZi5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFtRDs7QUFFbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsWUFBWSxtQ0FBbUM7QUFDL0MsK0JBQStCLGFBQWEsRUFBRSxLQUFLO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLGVBQWUsVUFBVSxHQUFHLFVBQVUsc0JBQXNCO0FBQ2hHO0FBQ0EsS0FBSztBQUNMO0FBQ0EscURBQXFELEtBQUssSUFBSSxpQkFBaUI7QUFDL0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsNkRBQWM7QUFDaEQsbUVBQW1FLGlDQUFpQztBQUNwRztBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsU0FBUyxJQUFJO0FBQ2IsZ0JBQWdCLFFBQVE7QUFDeEI7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLEtBQUs7QUFDTCxxQkFBcUIsMkJBQTJCO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTCwyQkFBMkIsbUVBQW1FO0FBQzlGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxnQ0FBZ0Msc0NBQXNDO0FBQ3RFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLHFDQUFxQyw0Q0FBNEM7QUFDakY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTCwyQkFBMkIsMkJBQTJCO0FBQ3REO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTCx3QkFBd0IsMkJBQTJCO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTCx1QkFBdUIsc0RBQXNEO0FBQzdFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxZQUFZLCtGQUErRjtBQUMzRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1QseUJBQXlCLEtBQUs7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNULCtCQUErQiw2Q0FBNkM7QUFDNUU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNULG9DQUFvQyxnQkFBZ0I7QUFDcEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1QseUNBQXlDLHNCQUFzQjtBQUMvRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNULCtCQUErQixLQUFLO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVCw0QkFBNEIsS0FBSztBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7O0FBRXVGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc3RvcmUvLi9ub2RlX21vZHVsZXMvQGVkZ2VzdG9yZS9zZXJ2ZXIvZGlzdC9pbmRleC0yOGVmZGFjZi5tanM/YjU4NiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFZGdlU3RvcmVFcnJvciB9IGZyb20gJ0BlZGdlc3RvcmUvc2hhcmVkJztcblxuY29uc3QgREVGQVVMVF9NRVNTQUdFID0gYE1pc3NpbmcgRURHRV9TVE9SRV9BQ0NFU1NfS0VZIG9yIEVER0VfU1RPUkVfU0VDUkVUX0tFWS4gXG5UaGlzIGNhbiBoYXBwZW4gaWYgeW91IGFyZSB0cnlpbmcgdG8gaW1wb3J0IHNvbWV0aGluZyByZWxhdGVkIHRvIHRoZSBiYWNrZW5kIG9mIEVkZ2UgU3RvcmUgaW4gYSBjbGllbnQgY29tcG9uZW50LmA7XG5jbGFzcyBFZGdlU3RvcmVDcmVkZW50aWFsc0Vycm9yIGV4dGVuZHMgRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UgPSBERUZBVUxUX01FU1NBR0Upe1xuICAgICAgICBzdXBlcihtZXNzYWdlKTtcbiAgICAgICAgdGhpcy5uYW1lID0gJ0VkZ2VTdG9yZUNyZWRlbnRpYWxzRXJyb3InO1xuICAgIH1cbn1cblxuY29uc3QgQVBJX0VORFBPSU5UID0gcHJvY2Vzcy5lbnYuRURHRV9TVE9SRV9BUElfRU5EUE9JTlQgPz8gJ2h0dHBzOi8vYXBpLmVkZ2VzdG9yZS5kZXYnO1xuYXN5bmMgZnVuY3Rpb24gbWFrZVJlcXVlc3QocGFyYW1zKSB7XG4gICAgY29uc3QgeyBib2R5LCBhY2Nlc3NLZXksIHNlY3JldEtleSwgcGF0aCB9ID0gcGFyYW1zO1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKGAke0FQSV9FTkRQT0lOVH0ke3BhdGh9YCwge1xuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoYm9keSksXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmFzaWMgJHtCdWZmZXIuZnJvbShgJHthY2Nlc3NLZXl9OiR7c2VjcmV0S2V5fWApLnRvU3RyaW5nKCdiYXNlNjQnKX1gXG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBpZiAoIXJlcy5vaykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBtYWtlIHJlcXVlc3QgdG8gJHtwYXRofTogJHthd2FpdCByZXMudGV4dCgpfWApO1xuICAgIH1cbiAgICByZXR1cm4gYXdhaXQgcmVzLmpzb24oKTtcbn1cbmNvbnN0IGVkZ2VTdG9yZVJhd1NkayA9IHtcbiAgICBhc3luYyBnZXRUb2tlbiAocGFyYW1zKSB7XG4gICAgICAgIGNvbnN0IHJlcUJ1Y2tldHMgPSBPYmplY3QuZW50cmllcyhwYXJhbXMucm91dGVyLmJ1Y2tldHMpLnJlZHVjZSgoYWNjLCBbYnVja2V0TmFtZSwgYnVja2V0XSk9PntcbiAgICAgICAgICAgIGFjY1tidWNrZXROYW1lXSA9IHtcbiAgICAgICAgICAgICAgICBwYXRoOiBidWNrZXQuX2RlZi5wYXRoLm1hcCgocCk9PntcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFyYW1FbnRyaWVzID0gT2JqZWN0LmVudHJpZXMocCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXJhbUVudHJpZXNbMF0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVkZ2VTdG9yZUVycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBgRW1wdHkgcGF0aCBwYXJhbSBmb3VuZCBpbjogJHtKU09OLnN0cmluZ2lmeShidWNrZXQuX2RlZi5wYXRoKX1gLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6ICdTRVJWRVJfRVJST1InXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjb25zdCBba2V5LCB2YWx1ZV0gPSBwYXJhbUVudHJpZXNbMF07XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBrZXksXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUoKVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIGFjY2Vzc0NvbnRyb2w6IGJ1Y2tldC5fZGVmLmFjY2Vzc0NvbnRyb2xcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgICB9LCB7fSk7XG4gICAgICAgIGNvbnN0IHsgdG9rZW4gfSA9IGF3YWl0IG1ha2VSZXF1ZXN0KHtcbiAgICAgICAgICAgIGJvZHk6IHtcbiAgICAgICAgICAgICAgICBjdHg6IHBhcmFtcy5jdHgsXG4gICAgICAgICAgICAgICAgYnVja2V0czogcmVxQnVja2V0c1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGFjY2Vzc0tleTogcGFyYW1zLmFjY2Vzc0tleSxcbiAgICAgICAgICAgIHNlY3JldEtleTogcGFyYW1zLnNlY3JldEtleSxcbiAgICAgICAgICAgIHBhdGg6ICcvZ2V0LXRva2VuJ1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRva2VuO1xuICAgIH0sXG4gICAgYXN5bmMgZ2V0RmlsZSAoeyBhY2Nlc3NLZXksIHNlY3JldEtleSwgdXJsIH0pIHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IG1ha2VSZXF1ZXN0KHtcbiAgICAgICAgICAgIHBhdGg6ICcvZ2V0LWZpbGUnLFxuICAgICAgICAgICAgYWNjZXNzS2V5LFxuICAgICAgICAgICAgc2VjcmV0S2V5LFxuICAgICAgICAgICAgYm9keToge1xuICAgICAgICAgICAgICAgIHVybFxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9LFxuICAgIGFzeW5jIHJlcXVlc3RVcGxvYWQgKHsgYWNjZXNzS2V5LCBzZWNyZXRLZXksIGJ1Y2tldE5hbWUsIGJ1Y2tldFR5cGUsIGZpbGVJbmZvLCBtdWx0aXBhcnQgfSkge1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBtYWtlUmVxdWVzdCh7XG4gICAgICAgICAgICBwYXRoOiAnL3JlcXVlc3QtdXBsb2FkJyxcbiAgICAgICAgICAgIGFjY2Vzc0tleSxcbiAgICAgICAgICAgIHNlY3JldEtleSxcbiAgICAgICAgICAgIGJvZHk6IHtcbiAgICAgICAgICAgICAgICBtdWx0aXBhcnQsXG4gICAgICAgICAgICAgICAgYnVja2V0TmFtZSxcbiAgICAgICAgICAgICAgICBidWNrZXRUeXBlLFxuICAgICAgICAgICAgICAgIGlzUHVibGljOiBmaWxlSW5mby5pc1B1YmxpYyxcbiAgICAgICAgICAgICAgICBwYXRoOiBmaWxlSW5mby5wYXRoLFxuICAgICAgICAgICAgICAgIGV4dGVuc2lvbjogZmlsZUluZm8uZXh0ZW5zaW9uLFxuICAgICAgICAgICAgICAgIHNpemU6IGZpbGVJbmZvLnNpemUsXG4gICAgICAgICAgICAgICAgbWltZVR5cGU6IGZpbGVJbmZvLnR5cGUsXG4gICAgICAgICAgICAgICAgbWV0YWRhdGE6IGZpbGVJbmZvLm1ldGFkYXRhLFxuICAgICAgICAgICAgICAgIGZpbGVOYW1lOiBmaWxlSW5mby5maWxlTmFtZSxcbiAgICAgICAgICAgICAgICByZXBsYWNlVGFyZ2V0VXJsOiBmaWxlSW5mby5yZXBsYWNlVGFyZ2V0VXJsLFxuICAgICAgICAgICAgICAgIGlzVGVtcG9yYXJ5OiBmaWxlSW5mby50ZW1wb3JhcnlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBtdWx0aXBhcnQ6IHJlcy5tdWx0aXBhcnQsXG4gICAgICAgICAgICBzaWduZWRVcmw6IHJlcy5zaWduZWRVcmwsXG4gICAgICAgICAgICBhY2Nlc3NVcmw6IHJlcy51cmwsXG4gICAgICAgICAgICBwYXRoOiByZXMucGF0aCxcbiAgICAgICAgICAgIHRodW1ibmFpbFVybDogcmVzLnRodW1ibmFpbFVybFxuICAgICAgICB9O1xuICAgIH0sXG4gICAgYXN5bmMgcmVxdWVzdFVwbG9hZFBhcnRzICh7IGFjY2Vzc0tleSwgc2VjcmV0S2V5LCBrZXksIG11bHRpcGFydCB9KSB7XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IG1ha2VSZXF1ZXN0KHtcbiAgICAgICAgICAgIHBhdGg6ICcvcmVxdWVzdC11cGxvYWQtcGFydHMnLFxuICAgICAgICAgICAgYWNjZXNzS2V5LFxuICAgICAgICAgICAgc2VjcmV0S2V5LFxuICAgICAgICAgICAgYm9keToge1xuICAgICAgICAgICAgICAgIG11bHRpcGFydCxcbiAgICAgICAgICAgICAgICBrZXlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBtdWx0aXBhcnQ6IHJlcy5tdWx0aXBhcnRcbiAgICAgICAgfTtcbiAgICB9LFxuICAgIGFzeW5jIGNvbXBsZXRlTXVsdGlwYXJ0VXBsb2FkICh7IGFjY2Vzc0tleSwgc2VjcmV0S2V5LCB1cGxvYWRJZCwga2V5LCBwYXJ0cyB9KSB7XG4gICAgICAgIHJldHVybiBhd2FpdCBtYWtlUmVxdWVzdCh7XG4gICAgICAgICAgICBwYXRoOiAnL2NvbXBsZXRlLW11bHRpcGFydC11cGxvYWQnLFxuICAgICAgICAgICAgYWNjZXNzS2V5LFxuICAgICAgICAgICAgc2VjcmV0S2V5LFxuICAgICAgICAgICAgYm9keToge1xuICAgICAgICAgICAgICAgIHVwbG9hZElkLFxuICAgICAgICAgICAgICAgIGtleSxcbiAgICAgICAgICAgICAgICBwYXJ0c1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9LFxuICAgIGFzeW5jIGNvbmZpcm1VcGxvYWQgKHsgYWNjZXNzS2V5LCBzZWNyZXRLZXksIHVybCB9KSB7XG4gICAgICAgIHJldHVybiBhd2FpdCBtYWtlUmVxdWVzdCh7XG4gICAgICAgICAgICBwYXRoOiAnL2NvbmZpcm0tdXBsb2FkJyxcbiAgICAgICAgICAgIGFjY2Vzc0tleSxcbiAgICAgICAgICAgIHNlY3JldEtleSxcbiAgICAgICAgICAgIGJvZHk6IHtcbiAgICAgICAgICAgICAgICB1cmxcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICBhc3luYyBkZWxldGVGaWxlICh7IGFjY2Vzc0tleSwgc2VjcmV0S2V5LCB1cmwgfSkge1xuICAgICAgICByZXR1cm4gYXdhaXQgbWFrZVJlcXVlc3Qoe1xuICAgICAgICAgICAgcGF0aDogJy9kZWxldGUtZmlsZScsXG4gICAgICAgICAgICBhY2Nlc3NLZXksXG4gICAgICAgICAgICBzZWNyZXRLZXksXG4gICAgICAgICAgICBib2R5OiB7XG4gICAgICAgICAgICAgICAgdXJsXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0sXG4gICAgYXN5bmMgbGlzdEZpbGVzICh7IGFjY2Vzc0tleSwgc2VjcmV0S2V5LCBidWNrZXROYW1lLCBmaWx0ZXIsIHBhZ2luYXRpb24gfSkge1xuICAgICAgICByZXR1cm4gYXdhaXQgbWFrZVJlcXVlc3Qoe1xuICAgICAgICAgICAgcGF0aDogJy9saXN0LWZpbGVzJyxcbiAgICAgICAgICAgIGFjY2Vzc0tleSxcbiAgICAgICAgICAgIHNlY3JldEtleSxcbiAgICAgICAgICAgIGJvZHk6IHtcbiAgICAgICAgICAgICAgICBidWNrZXROYW1lLFxuICAgICAgICAgICAgICAgIGZpbHRlcixcbiAgICAgICAgICAgICAgICBwYWdpbmF0aW9uXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbn07XG5mdW5jdGlvbiBpbml0RWRnZVN0b3JlU2RrKHBhcmFtcykge1xuICAgIGNvbnN0IHsgYWNjZXNzS2V5ID0gcHJvY2Vzcy5lbnYuRURHRV9TVE9SRV9BQ0NFU1NfS0VZLCBzZWNyZXRLZXkgPSBwcm9jZXNzLmVudi5FREdFX1NUT1JFX1NFQ1JFVF9LRVkgfSA9IHBhcmFtcyA/PyB7fTtcbiAgICBpZiAoIWFjY2Vzc0tleSB8fCAhc2VjcmV0S2V5KSB7XG4gICAgICAgIHRocm93IG5ldyBFZGdlU3RvcmVDcmVkZW50aWFsc0Vycm9yKCk7XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICAgIGFzeW5jIGdldFRva2VuIChwYXJhbXMpIHtcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCBlZGdlU3RvcmVSYXdTZGsuZ2V0VG9rZW4oe1xuICAgICAgICAgICAgICAgIGFjY2Vzc0tleSxcbiAgICAgICAgICAgICAgICBzZWNyZXRLZXksXG4gICAgICAgICAgICAgICAgY3R4OiBwYXJhbXMuY3R4LFxuICAgICAgICAgICAgICAgIHJvdXRlcjogcGFyYW1zLnJvdXRlclxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIGFzeW5jIGdldEZpbGUgKHsgdXJsIH0pIHtcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCBlZGdlU3RvcmVSYXdTZGsuZ2V0RmlsZSh7XG4gICAgICAgICAgICAgICAgYWNjZXNzS2V5LFxuICAgICAgICAgICAgICAgIHNlY3JldEtleSxcbiAgICAgICAgICAgICAgICB1cmxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICBhc3luYyByZXF1ZXN0VXBsb2FkICh7IGJ1Y2tldE5hbWUsIGJ1Y2tldFR5cGUsIGZpbGVJbmZvLCBtdWx0aXBhcnQgfSkge1xuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IGVkZ2VTdG9yZVJhd1Nkay5yZXF1ZXN0VXBsb2FkKHtcbiAgICAgICAgICAgICAgICBhY2Nlc3NLZXksXG4gICAgICAgICAgICAgICAgc2VjcmV0S2V5LFxuICAgICAgICAgICAgICAgIGJ1Y2tldE5hbWUsXG4gICAgICAgICAgICAgICAgYnVja2V0VHlwZSxcbiAgICAgICAgICAgICAgICBmaWxlSW5mbyxcbiAgICAgICAgICAgICAgICBtdWx0aXBhcnRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICBhc3luYyByZXF1ZXN0VXBsb2FkUGFydHMgKHsga2V5LCBtdWx0aXBhcnQgfSkge1xuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IGVkZ2VTdG9yZVJhd1Nkay5yZXF1ZXN0VXBsb2FkUGFydHMoe1xuICAgICAgICAgICAgICAgIGFjY2Vzc0tleSxcbiAgICAgICAgICAgICAgICBzZWNyZXRLZXksXG4gICAgICAgICAgICAgICAga2V5LFxuICAgICAgICAgICAgICAgIG11bHRpcGFydFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIGFzeW5jIGNvbXBsZXRlTXVsdGlwYXJ0VXBsb2FkICh7IHVwbG9hZElkLCBrZXksIHBhcnRzIH0pIHtcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCBlZGdlU3RvcmVSYXdTZGsuY29tcGxldGVNdWx0aXBhcnRVcGxvYWQoe1xuICAgICAgICAgICAgICAgIGFjY2Vzc0tleSxcbiAgICAgICAgICAgICAgICBzZWNyZXRLZXksXG4gICAgICAgICAgICAgICAgdXBsb2FkSWQsXG4gICAgICAgICAgICAgICAga2V5LFxuICAgICAgICAgICAgICAgIHBhcnRzXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgYXN5bmMgY29uZmlybVVwbG9hZCAoeyB1cmwgfSkge1xuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IGVkZ2VTdG9yZVJhd1Nkay5jb25maXJtVXBsb2FkKHtcbiAgICAgICAgICAgICAgICBhY2Nlc3NLZXksXG4gICAgICAgICAgICAgICAgc2VjcmV0S2V5LFxuICAgICAgICAgICAgICAgIHVybFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIGFzeW5jIGRlbGV0ZUZpbGUgKHsgdXJsIH0pIHtcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCBlZGdlU3RvcmVSYXdTZGsuZGVsZXRlRmlsZSh7XG4gICAgICAgICAgICAgICAgYWNjZXNzS2V5LFxuICAgICAgICAgICAgICAgIHNlY3JldEtleSxcbiAgICAgICAgICAgICAgICB1cmxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICBhc3luYyBsaXN0RmlsZXMgKHBhcmFtcykge1xuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IGVkZ2VTdG9yZVJhd1Nkay5saXN0RmlsZXMoe1xuICAgICAgICAgICAgICAgIGFjY2Vzc0tleSxcbiAgICAgICAgICAgICAgICBzZWNyZXRLZXksXG4gICAgICAgICAgICAgICAgLi4ucGFyYW1zXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG59XG5cbmV4cG9ydCB7IEVkZ2VTdG9yZUNyZWRlbnRpYWxzRXJyb3IgYXMgRSwgZWRnZVN0b3JlUmF3U2RrIGFzIGUsIGluaXRFZGdlU3RvcmVTZGsgYXMgaSB9O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/@edgestore/server/dist/index-28efdacf.mjs\n");

/***/ }),

/***/ "(rsc)/./node_modules/@edgestore/server/dist/index.mjs":
/*!*******************************************************!*\
  !*** ./node_modules/@edgestore/server/dist/index.mjs ***!
  \*******************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   initEdgeStore: () => (/* reexport safe */ _edgestore_shared__WEBPACK_IMPORTED_MODULE_0__.initEdgeStore)\n/* harmony export */ });\n/* harmony import */ var _edgestore_shared__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @edgestore/shared */ \"(rsc)/./node_modules/@edgestore/shared/dist/index.mjs\");\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvQGVkZ2VzdG9yZS9zZXJ2ZXIvZGlzdC9pbmRleC5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBa0QiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zdG9yZS8uL25vZGVfbW9kdWxlcy9AZWRnZXN0b3JlL3NlcnZlci9kaXN0L2luZGV4Lm1qcz8xZTkxIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCB7IGluaXRFZGdlU3RvcmUgfSBmcm9tICdAZWRnZXN0b3JlL3NoYXJlZCc7XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/@edgestore/server/dist/index.mjs\n");

/***/ }),

/***/ "(rsc)/./node_modules/@edgestore/server/dist/logger-09f43a75.mjs":
/*!*****************************************************************!*\
  !*** ./node_modules/@edgestore/server/dist/logger-09f43a75.mjs ***!
  \*****************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   L: () => (/* binding */ Logger)\n/* harmony export */ });\n/* eslint-disable no-console */ function _define_property(obj, key, value) {\n    if (key in obj) {\n        Object.defineProperty(obj, key, {\n            value: value,\n            enumerable: true,\n            configurable: true,\n            writable: true\n        });\n    } else {\n        obj[key] = value;\n    }\n    return obj;\n}\nconst logLevel = [\n    'debug',\n    'info',\n    'warn',\n    'error',\n    'none'\n];\nclass Logger {\n    shouldLog(level) {\n        return logLevel.indexOf(level) >= logLevel.indexOf(this.logLevel);\n    }\n    debug(message, ...optionalParams) {\n        if (this.shouldLog('debug')) {\n            console.debug('[EdgeStoreDebug]', message, ...optionalParams);\n        }\n    }\n    info(message, ...optionalParams) {\n        if (this.shouldLog('info')) {\n            console.info('[EdgeStoreInfo]', message, ...optionalParams);\n        }\n    }\n    warn(message, ...optionalParams) {\n        if (this.shouldLog('warn')) {\n            console.warn('[EdgeStoreWarn]', message, ...optionalParams);\n        }\n    }\n    error(message, ...optionalParams) {\n        if (this.shouldLog('error')) {\n            console.error('[EdgeStoreError]', message, ...optionalParams);\n        }\n    }\n    constructor(logLevel){\n        _define_property(this, \"logLevel\", void 0);\n        this.logLevel = logLevel ?? ( false ? 0 : 'info');\n    }\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvQGVkZ2VzdG9yZS9zZXJ2ZXIvZGlzdC9sb2dnZXItMDlmNDNhNzUubWpzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUMsTUFBcUMsR0FBRyxDQUFPO0FBQ3BGO0FBQ0E7O0FBRXVCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc3RvcmUvLi9ub2RlX21vZHVsZXMvQGVkZ2VzdG9yZS9zZXJ2ZXIvZGlzdC9sb2dnZXItMDlmNDNhNzUubWpzPzJjODUiXSwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgbm8tY29uc29sZSAqLyBmdW5jdGlvbiBfZGVmaW5lX3Byb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkge1xuICAgIGlmIChrZXkgaW4gb2JqKSB7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwge1xuICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlXG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIG9ialtrZXldID0gdmFsdWU7XG4gICAgfVxuICAgIHJldHVybiBvYmo7XG59XG5jb25zdCBsb2dMZXZlbCA9IFtcbiAgICAnZGVidWcnLFxuICAgICdpbmZvJyxcbiAgICAnd2FybicsXG4gICAgJ2Vycm9yJyxcbiAgICAnbm9uZSdcbl07XG5jbGFzcyBMb2dnZXIge1xuICAgIHNob3VsZExvZyhsZXZlbCkge1xuICAgICAgICByZXR1cm4gbG9nTGV2ZWwuaW5kZXhPZihsZXZlbCkgPj0gbG9nTGV2ZWwuaW5kZXhPZih0aGlzLmxvZ0xldmVsKTtcbiAgICB9XG4gICAgZGVidWcobWVzc2FnZSwgLi4ub3B0aW9uYWxQYXJhbXMpIHtcbiAgICAgICAgaWYgKHRoaXMuc2hvdWxkTG9nKCdkZWJ1ZycpKSB7XG4gICAgICAgICAgICBjb25zb2xlLmRlYnVnKCdbRWRnZVN0b3JlRGVidWddJywgbWVzc2FnZSwgLi4ub3B0aW9uYWxQYXJhbXMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGluZm8obWVzc2FnZSwgLi4ub3B0aW9uYWxQYXJhbXMpIHtcbiAgICAgICAgaWYgKHRoaXMuc2hvdWxkTG9nKCdpbmZvJykpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuaW5mbygnW0VkZ2VTdG9yZUluZm9dJywgbWVzc2FnZSwgLi4ub3B0aW9uYWxQYXJhbXMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHdhcm4obWVzc2FnZSwgLi4ub3B0aW9uYWxQYXJhbXMpIHtcbiAgICAgICAgaWYgKHRoaXMuc2hvdWxkTG9nKCd3YXJuJykpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignW0VkZ2VTdG9yZVdhcm5dJywgbWVzc2FnZSwgLi4ub3B0aW9uYWxQYXJhbXMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVycm9yKG1lc3NhZ2UsIC4uLm9wdGlvbmFsUGFyYW1zKSB7XG4gICAgICAgIGlmICh0aGlzLnNob3VsZExvZygnZXJyb3InKSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignW0VkZ2VTdG9yZUVycm9yXScsIG1lc3NhZ2UsIC4uLm9wdGlvbmFsUGFyYW1zKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb25zdHJ1Y3Rvcihsb2dMZXZlbCl7XG4gICAgICAgIF9kZWZpbmVfcHJvcGVydHkodGhpcywgXCJsb2dMZXZlbFwiLCB2b2lkIDApO1xuICAgICAgICB0aGlzLmxvZ0xldmVsID0gbG9nTGV2ZWwgPz8gKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicgPyAnZXJyb3InIDogJ2luZm8nKTtcbiAgICB9XG59XG5cbmV4cG9ydCB7IExvZ2dlciBhcyBMIH07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/@edgestore/server/dist/logger-09f43a75.mjs\n");

/***/ }),

/***/ "(rsc)/./node_modules/@edgestore/server/dist/providers/edgestore/index.mjs":
/*!***************************************************************************!*\
  !*** ./node_modules/@edgestore/server/dist/providers/edgestore/index.mjs ***!
  \***************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   EdgeStoreProvider: () => (/* binding */ EdgeStoreProvider)\n/* harmony export */ });\n/* harmony import */ var _edgestore_shared__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @edgestore/shared */ \"(rsc)/./node_modules/@edgestore/shared/dist/index.mjs\");\n/* harmony import */ var _index_28efdacf_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../index-28efdacf.mjs */ \"(rsc)/./node_modules/@edgestore/server/dist/index-28efdacf.mjs\");\n\n\n\nconst DEFAULT_BASE_URL = 'https://files.edgestore.dev';\nfunction EdgeStoreProvider(options) {\n    const { accessKey = process.env.EDGE_STORE_ACCESS_KEY, secretKey = process.env.EDGE_STORE_SECRET_KEY } = options ?? {};\n    const baseUrl = process.env.EDGE_STORE_BASE_URL ?? DEFAULT_BASE_URL;\n    if (!accessKey || !secretKey) {\n        throw new _index_28efdacf_mjs__WEBPACK_IMPORTED_MODULE_1__.E();\n    }\n    const edgeStoreSdk = (0,_index_28efdacf_mjs__WEBPACK_IMPORTED_MODULE_1__.i)({\n        accessKey,\n        secretKey\n    });\n    return {\n        init: async ({ ctx, router })=>{\n            const token = await edgeStoreSdk.getToken({\n                ctx,\n                router\n            });\n            return {\n                token\n            };\n        },\n        getBaseUrl () {\n            return baseUrl;\n        },\n        getFile: async ({ url })=>{\n            const { uploadedAt, ...rest } = await edgeStoreSdk.getFile({\n                url\n            });\n            return {\n                uploadedAt: new Date(uploadedAt),\n                ...rest\n            };\n        },\n        async requestUpload ({ bucketName, bucketType, fileInfo }) {\n            // multipart upload if file is bigger than a certain size\n            const MULTIPART_THRESHOLD = 10 * 1024 * 1024; // 10MB\n            let partSize = 5 * 1024 * 1024; // 5MB\n            if (fileInfo.size > MULTIPART_THRESHOLD) {\n                let totalParts = Math.ceil(fileInfo.size / partSize);\n                if (totalParts > 1000) {\n                    // the maximum number of parts is 1000\n                    totalParts = 1000;\n                    partSize = Math.ceil(fileInfo.size / totalParts);\n                }\n                const res = await edgeStoreSdk.requestUpload({\n                    bucketName,\n                    bucketType,\n                    fileInfo,\n                    multipart: {\n                        parts: Array.from({\n                            length: totalParts\n                        }).map((_, index)=>index + 1)\n                    }\n                });\n                const multipart = res.multipart ? {\n                    key: res.multipart.key,\n                    uploadId: res.multipart.uploadId,\n                    parts: res.multipart.parts.map((part)=>({\n                            partNumber: part.partNumber,\n                            uploadUrl: part.signedUrl\n                        })),\n                    partSize,\n                    totalParts\n                } : undefined;\n                if (multipart) {\n                    return {\n                        accessUrl: res.accessUrl,\n                        thumbnailUrl: res.thumbnailUrl,\n                        multipart\n                    };\n                } else if (res.signedUrl) {\n                    return {\n                        accessUrl: res.accessUrl,\n                        uploadUrl: res.signedUrl,\n                        thumbnailUrl: res.thumbnailUrl\n                    };\n                } else {\n                    throw new _edgestore_shared__WEBPACK_IMPORTED_MODULE_0__.EdgeStoreError({\n                        message: 'Could not get upload url',\n                        code: 'SERVER_ERROR'\n                    });\n                }\n            }\n            const res = await edgeStoreSdk.requestUpload({\n                bucketName,\n                bucketType,\n                fileInfo\n            });\n            if (res.signedUrl) {\n                return {\n                    accessUrl: res.accessUrl,\n                    uploadUrl: res.signedUrl,\n                    thumbnailUrl: res.thumbnailUrl\n                };\n            }\n            throw new _edgestore_shared__WEBPACK_IMPORTED_MODULE_0__.EdgeStoreError({\n                message: 'Could not get upload url',\n                code: 'SERVER_ERROR'\n            });\n        },\n        requestUploadParts: async ({ multipart, path })=>{\n            const res = await edgeStoreSdk.requestUploadParts({\n                multipart,\n                key: path\n            });\n            return {\n                multipart: {\n                    uploadId: res.multipart.uploadId,\n                    parts: res.multipart.parts.map((part)=>({\n                            partNumber: part.partNumber,\n                            uploadUrl: part.signedUrl\n                        }))\n                }\n            };\n        },\n        completeMultipartUpload: async ({ uploadId, key, parts })=>{\n            return await edgeStoreSdk.completeMultipartUpload({\n                uploadId,\n                key,\n                parts\n            });\n        },\n        confirmUpload: async ({ url })=>{\n            return await edgeStoreSdk.confirmUpload({\n                url\n            });\n        },\n        deleteFile: async ({ url })=>{\n            return await edgeStoreSdk.deleteFile({\n                url\n            });\n        }\n    };\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvQGVkZ2VzdG9yZS9zZXJ2ZXIvZGlzdC9wcm92aWRlcnMvZWRnZXN0b3JlL2luZGV4Lm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBbUQ7QUFDOEM7O0FBRWpHO0FBQ0E7QUFDQSxZQUFZLCtGQUErRjtBQUMzRztBQUNBO0FBQ0Esa0JBQWtCLGtEQUF5QjtBQUMzQztBQUNBLHlCQUF5QixzREFBZ0I7QUFDekM7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLHVCQUF1QixhQUFhO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFNBQVM7QUFDVCwwQkFBMEIsS0FBSztBQUMvQixvQkFBb0Isc0JBQXNCO0FBQzFDO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULCtCQUErQixrQ0FBa0M7QUFDakU7QUFDQSwwREFBMEQ7QUFDMUQsNENBQTRDO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEIsOEJBQThCLDZEQUFjO0FBQzVDO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLDZEQUFjO0FBQ3BDO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNULHFDQUFxQyxpQkFBaUI7QUFDdEQ7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0EsU0FBUztBQUNULDBDQUEwQyxzQkFBc0I7QUFDaEU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNULGdDQUFnQyxLQUFLO0FBQ3JDO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNULDZCQUE2QixLQUFLO0FBQ2xDO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBOztBQUU2QiIsInNvdXJjZXMiOlsid2VicGFjazovL3N0b3JlLy4vbm9kZV9tb2R1bGVzL0BlZGdlc3RvcmUvc2VydmVyL2Rpc3QvcHJvdmlkZXJzL2VkZ2VzdG9yZS9pbmRleC5tanM/ZTYzNyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFZGdlU3RvcmVFcnJvciB9IGZyb20gJ0BlZGdlc3RvcmUvc2hhcmVkJztcbmltcG9ydCB7IEUgYXMgRWRnZVN0b3JlQ3JlZGVudGlhbHNFcnJvciwgaSBhcyBpbml0RWRnZVN0b3JlU2RrIH0gZnJvbSAnLi4vLi4vaW5kZXgtMjhlZmRhY2YubWpzJztcblxuY29uc3QgREVGQVVMVF9CQVNFX1VSTCA9ICdodHRwczovL2ZpbGVzLmVkZ2VzdG9yZS5kZXYnO1xuZnVuY3Rpb24gRWRnZVN0b3JlUHJvdmlkZXIob3B0aW9ucykge1xuICAgIGNvbnN0IHsgYWNjZXNzS2V5ID0gcHJvY2Vzcy5lbnYuRURHRV9TVE9SRV9BQ0NFU1NfS0VZLCBzZWNyZXRLZXkgPSBwcm9jZXNzLmVudi5FREdFX1NUT1JFX1NFQ1JFVF9LRVkgfSA9IG9wdGlvbnMgPz8ge307XG4gICAgY29uc3QgYmFzZVVybCA9IHByb2Nlc3MuZW52LkVER0VfU1RPUkVfQkFTRV9VUkwgPz8gREVGQVVMVF9CQVNFX1VSTDtcbiAgICBpZiAoIWFjY2Vzc0tleSB8fCAhc2VjcmV0S2V5KSB7XG4gICAgICAgIHRocm93IG5ldyBFZGdlU3RvcmVDcmVkZW50aWFsc0Vycm9yKCk7XG4gICAgfVxuICAgIGNvbnN0IGVkZ2VTdG9yZVNkayA9IGluaXRFZGdlU3RvcmVTZGsoe1xuICAgICAgICBhY2Nlc3NLZXksXG4gICAgICAgIHNlY3JldEtleVxuICAgIH0pO1xuICAgIHJldHVybiB7XG4gICAgICAgIGluaXQ6IGFzeW5jICh7IGN0eCwgcm91dGVyIH0pPT57XG4gICAgICAgICAgICBjb25zdCB0b2tlbiA9IGF3YWl0IGVkZ2VTdG9yZVNkay5nZXRUb2tlbih7XG4gICAgICAgICAgICAgICAgY3R4LFxuICAgICAgICAgICAgICAgIHJvdXRlclxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHRva2VuXG4gICAgICAgICAgICB9O1xuICAgICAgICB9LFxuICAgICAgICBnZXRCYXNlVXJsICgpIHtcbiAgICAgICAgICAgIHJldHVybiBiYXNlVXJsO1xuICAgICAgICB9LFxuICAgICAgICBnZXRGaWxlOiBhc3luYyAoeyB1cmwgfSk9PntcbiAgICAgICAgICAgIGNvbnN0IHsgdXBsb2FkZWRBdCwgLi4ucmVzdCB9ID0gYXdhaXQgZWRnZVN0b3JlU2RrLmdldEZpbGUoe1xuICAgICAgICAgICAgICAgIHVybFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHVwbG9hZGVkQXQ6IG5ldyBEYXRlKHVwbG9hZGVkQXQpLFxuICAgICAgICAgICAgICAgIC4uLnJlc3RcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0sXG4gICAgICAgIGFzeW5jIHJlcXVlc3RVcGxvYWQgKHsgYnVja2V0TmFtZSwgYnVja2V0VHlwZSwgZmlsZUluZm8gfSkge1xuICAgICAgICAgICAgLy8gbXVsdGlwYXJ0IHVwbG9hZCBpZiBmaWxlIGlzIGJpZ2dlciB0aGFuIGEgY2VydGFpbiBzaXplXG4gICAgICAgICAgICBjb25zdCBNVUxUSVBBUlRfVEhSRVNIT0xEID0gMTAgKiAxMDI0ICogMTAyNDsgLy8gMTBNQlxuICAgICAgICAgICAgbGV0IHBhcnRTaXplID0gNSAqIDEwMjQgKiAxMDI0OyAvLyA1TUJcbiAgICAgICAgICAgIGlmIChmaWxlSW5mby5zaXplID4gTVVMVElQQVJUX1RIUkVTSE9MRCkge1xuICAgICAgICAgICAgICAgIGxldCB0b3RhbFBhcnRzID0gTWF0aC5jZWlsKGZpbGVJbmZvLnNpemUgLyBwYXJ0U2l6ZSk7XG4gICAgICAgICAgICAgICAgaWYgKHRvdGFsUGFydHMgPiAxMDAwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHRoZSBtYXhpbXVtIG51bWJlciBvZiBwYXJ0cyBpcyAxMDAwXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsUGFydHMgPSAxMDAwO1xuICAgICAgICAgICAgICAgICAgICBwYXJ0U2l6ZSA9IE1hdGguY2VpbChmaWxlSW5mby5zaXplIC8gdG90YWxQYXJ0cyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGVkZ2VTdG9yZVNkay5yZXF1ZXN0VXBsb2FkKHtcbiAgICAgICAgICAgICAgICAgICAgYnVja2V0TmFtZSxcbiAgICAgICAgICAgICAgICAgICAgYnVja2V0VHlwZSxcbiAgICAgICAgICAgICAgICAgICAgZmlsZUluZm8sXG4gICAgICAgICAgICAgICAgICAgIG11bHRpcGFydDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFydHM6IEFycmF5LmZyb20oe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlbmd0aDogdG90YWxQYXJ0c1xuICAgICAgICAgICAgICAgICAgICAgICAgfSkubWFwKChfLCBpbmRleCk9PmluZGV4ICsgMSlcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGNvbnN0IG11bHRpcGFydCA9IHJlcy5tdWx0aXBhcnQgPyB7XG4gICAgICAgICAgICAgICAgICAgIGtleTogcmVzLm11bHRpcGFydC5rZXksXG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZElkOiByZXMubXVsdGlwYXJ0LnVwbG9hZElkLFxuICAgICAgICAgICAgICAgICAgICBwYXJ0czogcmVzLm11bHRpcGFydC5wYXJ0cy5tYXAoKHBhcnQpPT4oe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnROdW1iZXI6IHBhcnQucGFydE51bWJlcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRVcmw6IHBhcnQuc2lnbmVkVXJsXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSksXG4gICAgICAgICAgICAgICAgICAgIHBhcnRTaXplLFxuICAgICAgICAgICAgICAgICAgICB0b3RhbFBhcnRzXG4gICAgICAgICAgICAgICAgfSA6IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICBpZiAobXVsdGlwYXJ0KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhY2Nlc3NVcmw6IHJlcy5hY2Nlc3NVcmwsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHVtYm5haWxVcmw6IHJlcy50aHVtYm5haWxVcmwsXG4gICAgICAgICAgICAgICAgICAgICAgICBtdWx0aXBhcnRcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlcy5zaWduZWRVcmwpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjY2Vzc1VybDogcmVzLmFjY2Vzc1VybCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZFVybDogcmVzLnNpZ25lZFVybCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbFVybDogcmVzLnRodW1ibmFpbFVybFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFZGdlU3RvcmVFcnJvcih7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnQ291bGQgbm90IGdldCB1cGxvYWQgdXJsJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6ICdTRVJWRVJfRVJST1InXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGVkZ2VTdG9yZVNkay5yZXF1ZXN0VXBsb2FkKHtcbiAgICAgICAgICAgICAgICBidWNrZXROYW1lLFxuICAgICAgICAgICAgICAgIGJ1Y2tldFR5cGUsXG4gICAgICAgICAgICAgICAgZmlsZUluZm9cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKHJlcy5zaWduZWRVcmwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBhY2Nlc3NVcmw6IHJlcy5hY2Nlc3NVcmwsXG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZFVybDogcmVzLnNpZ25lZFVybCxcbiAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsVXJsOiByZXMudGh1bWJuYWlsVXJsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRocm93IG5ldyBFZGdlU3RvcmVFcnJvcih7XG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ0NvdWxkIG5vdCBnZXQgdXBsb2FkIHVybCcsXG4gICAgICAgICAgICAgICAgY29kZTogJ1NFUlZFUl9FUlJPUidcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICByZXF1ZXN0VXBsb2FkUGFydHM6IGFzeW5jICh7IG11bHRpcGFydCwgcGF0aCB9KT0+e1xuICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgZWRnZVN0b3JlU2RrLnJlcXVlc3RVcGxvYWRQYXJ0cyh7XG4gICAgICAgICAgICAgICAgbXVsdGlwYXJ0LFxuICAgICAgICAgICAgICAgIGtleTogcGF0aFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIG11bHRpcGFydDoge1xuICAgICAgICAgICAgICAgICAgICB1cGxvYWRJZDogcmVzLm11bHRpcGFydC51cGxvYWRJZCxcbiAgICAgICAgICAgICAgICAgICAgcGFydHM6IHJlcy5tdWx0aXBhcnQucGFydHMubWFwKChwYXJ0KT0+KHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJ0TnVtYmVyOiBwYXJ0LnBhcnROdW1iZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkVXJsOiBwYXJ0LnNpZ25lZFVybFxuICAgICAgICAgICAgICAgICAgICAgICAgfSkpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSxcbiAgICAgICAgY29tcGxldGVNdWx0aXBhcnRVcGxvYWQ6IGFzeW5jICh7IHVwbG9hZElkLCBrZXksIHBhcnRzIH0pPT57XG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgZWRnZVN0b3JlU2RrLmNvbXBsZXRlTXVsdGlwYXJ0VXBsb2FkKHtcbiAgICAgICAgICAgICAgICB1cGxvYWRJZCxcbiAgICAgICAgICAgICAgICBrZXksXG4gICAgICAgICAgICAgICAgcGFydHNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICBjb25maXJtVXBsb2FkOiBhc3luYyAoeyB1cmwgfSk9PntcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCBlZGdlU3RvcmVTZGsuY29uZmlybVVwbG9hZCh7XG4gICAgICAgICAgICAgICAgdXJsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgZGVsZXRlRmlsZTogYXN5bmMgKHsgdXJsIH0pPT57XG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgZWRnZVN0b3JlU2RrLmRlbGV0ZUZpbGUoe1xuICAgICAgICAgICAgICAgIHVybFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xufVxuXG5leHBvcnQgeyBFZGdlU3RvcmVQcm92aWRlciB9O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/@edgestore/server/dist/providers/edgestore/index.mjs\n");

/***/ }),

/***/ "(rsc)/./node_modules/@edgestore/server/dist/shared-039276af.mjs":
/*!*****************************************************************!*\
  !*** ./node_modules/@edgestore/server/dist/shared-039276af.mjs ***!
  \*****************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   a: () => (/* binding */ requestUploadParts),\n/* harmony export */   b: () => (/* binding */ buildPath),\n/* harmony export */   c: () => (/* binding */ completeMultipartUpload),\n/* harmony export */   d: () => (/* binding */ confirmUpload),\n/* harmony export */   e: () => (/* binding */ deleteFile),\n/* harmony export */   i: () => (/* binding */ init),\n/* harmony export */   p: () => (/* binding */ parsePath),\n/* harmony export */   r: () => (/* binding */ requestUpload)\n/* harmony export */ });\n/* harmony import */ var _edgestore_shared__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @edgestore/shared */ \"(rsc)/./node_modules/@edgestore/shared/dist/index.mjs\");\n/* harmony import */ var _panva_hkdf__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @panva/hkdf */ \"(rsc)/./node_modules/@panva/hkdf/dist/node/esm/index.js\");\n/* harmony import */ var cookie__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! cookie */ \"(rsc)/./node_modules/cookie/index.js\");\n/* harmony import */ var jose__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! jose */ \"(rsc)/./node_modules/jose/dist/node/esm/index.js\");\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! uuid */ \"(rsc)/./node_modules/uuid/dist/esm-node/v4.js\");\n\n\n\n\n\n\nconst IMAGE_MIME_TYPES = [\n    'image/jpeg',\n    'image/png',\n    'image/gif',\n    'image/webp',\n    'image/svg+xml',\n    'image/tiff',\n    'image/bmp',\n    'image/x-icon'\n];\n\n// TODO: change it to 1 hour when we have a way to refresh the token\nconst DEFAULT_MAX_AGE = 30 * 24 * 60 * 60; // 30 days\nasync function init(params) {\n    const log = globalThis._EDGE_STORE_LOGGER;\n    const { ctx, provider, router } = params;\n    log.debug('Running [init]', {\n        ctx\n    });\n    const ctxToken = await encryptJWT(ctx);\n    const { token } = await provider.init({\n        ctx,\n        router: router\n    });\n    const newCookies = [\n        (0,cookie__WEBPACK_IMPORTED_MODULE_2__.serialize)('edgestore-ctx', ctxToken, {\n            path: '/',\n            maxAge: DEFAULT_MAX_AGE\n        })\n    ];\n    if (token) {\n        newCookies.push((0,cookie__WEBPACK_IMPORTED_MODULE_2__.serialize)('edgestore-token', token, {\n            path: '/',\n            maxAge: DEFAULT_MAX_AGE\n        }));\n    }\n    const baseUrl = await provider.getBaseUrl();\n    log.debug('Finished [init]', {\n        ctx,\n        newCookies,\n        token,\n        baseUrl\n    });\n    return {\n        newCookies,\n        token,\n        baseUrl\n    };\n}\nasync function requestUpload(params) {\n    const { provider, router, ctxToken, body: { bucketName, input, fileInfo } } = params;\n    const log = globalThis._EDGE_STORE_LOGGER;\n    log.debug('Running [requestUpload]', {\n        bucketName,\n        input,\n        fileInfo\n    });\n    if (!ctxToken) {\n        throw new _edgestore_shared__WEBPACK_IMPORTED_MODULE_0__.EdgeStoreError({\n            message: 'Missing edgestore-ctx cookie',\n            code: 'UNAUTHORIZED'\n        });\n    }\n    const ctx = await getContext(ctxToken);\n    log.debug('Decrypted Context', {\n        ctx\n    });\n    const bucket = router.buckets[bucketName];\n    if (!bucket) {\n        throw new _edgestore_shared__WEBPACK_IMPORTED_MODULE_0__.EdgeStoreError({\n            message: `Bucket ${bucketName} not found`,\n            code: 'BAD_REQUEST'\n        });\n    }\n    if (bucket._def.beforeUpload) {\n        log.debug('Running [beforeUpload]');\n        const canUpload = await bucket._def.beforeUpload?.({\n            ctx,\n            input,\n            fileInfo: {\n                size: fileInfo.size,\n                type: fileInfo.type,\n                fileName: fileInfo.fileName,\n                extension: fileInfo.extension,\n                replaceTargetUrl: fileInfo.replaceTargetUrl,\n                temporary: fileInfo.temporary\n            }\n        });\n        log.debug('Finished [beforeUpload]', {\n            canUpload\n        });\n        if (!canUpload) {\n            throw new _edgestore_shared__WEBPACK_IMPORTED_MODULE_0__.EdgeStoreError({\n                message: 'Upload not allowed for the current context',\n                code: 'UPLOAD_NOT_ALLOWED'\n            });\n        }\n    }\n    if (bucket._def.type === 'IMAGE') {\n        if (!IMAGE_MIME_TYPES.includes(fileInfo.type)) {\n            throw new _edgestore_shared__WEBPACK_IMPORTED_MODULE_0__.EdgeStoreError({\n                code: 'MIME_TYPE_NOT_ALLOWED',\n                message: 'Only images are allowed in this bucket',\n                details: {\n                    allowedMimeTypes: IMAGE_MIME_TYPES,\n                    mimeType: fileInfo.type\n                }\n            });\n        }\n    }\n    if (bucket._def.bucketConfig?.maxSize) {\n        if (fileInfo.size > bucket._def.bucketConfig.maxSize) {\n            throw new _edgestore_shared__WEBPACK_IMPORTED_MODULE_0__.EdgeStoreError({\n                code: 'FILE_TOO_LARGE',\n                message: `File size is too big. Max size is ${bucket._def.bucketConfig.maxSize}`,\n                details: {\n                    maxFileSize: bucket._def.bucketConfig.maxSize,\n                    fileSize: fileInfo.size\n                }\n            });\n        }\n    }\n    if (bucket._def.bucketConfig?.accept) {\n        const accept = bucket._def.bucketConfig.accept;\n        let accepted = false;\n        for (const acceptedMimeType of accept){\n            if (acceptedMimeType.endsWith('/*')) {\n                const mimeType = acceptedMimeType.replace('/*', '');\n                if (fileInfo.type.startsWith(mimeType)) {\n                    accepted = true;\n                    break;\n                }\n            } else if (fileInfo.type === acceptedMimeType) {\n                accepted = true;\n                break;\n            }\n        }\n        if (!accepted) {\n            throw new _edgestore_shared__WEBPACK_IMPORTED_MODULE_0__.EdgeStoreError({\n                code: 'MIME_TYPE_NOT_ALLOWED',\n                message: `\"${fileInfo.type}\" is not allowed. Accepted types are ${JSON.stringify(accept)}`,\n                details: {\n                    allowedMimeTypes: accept,\n                    mimeType: fileInfo.type\n                }\n            });\n        }\n    }\n    const path = buildPath({\n        fileInfo,\n        bucket,\n        pathAttrs: {\n            ctx,\n            input\n        }\n    });\n    const metadata = await bucket._def.metadata?.({\n        ctx,\n        input\n    });\n    const isPublic = bucket._def.accessControl === undefined;\n    log.debug('upload info', {\n        path,\n        metadata,\n        isPublic,\n        bucketType: bucket._def.type\n    });\n    const requestUploadRes = await provider.requestUpload({\n        bucketName,\n        bucketType: bucket._def.type,\n        fileInfo: {\n            ...fileInfo,\n            path,\n            isPublic,\n            metadata\n        }\n    });\n    const { parsedPath, pathOrder } = parsePath(path);\n    log.debug('Finished [requestUpload]');\n    return {\n        ...requestUploadRes,\n        size: fileInfo.size,\n        uploadedAt: new Date().toISOString(),\n        path: parsedPath,\n        pathOrder,\n        metadata\n    };\n}\nasync function requestUploadParts(params) {\n    const { provider, ctxToken, body: { multipart, path } } = params;\n    const log = globalThis._EDGE_STORE_LOGGER;\n    log.debug('Running [requestUploadParts]', {\n        multipart,\n        path\n    });\n    if (!ctxToken) {\n        throw new _edgestore_shared__WEBPACK_IMPORTED_MODULE_0__.EdgeStoreError({\n            message: 'Missing edgestore-ctx cookie',\n            code: 'UNAUTHORIZED'\n        });\n    }\n    await getContext(ctxToken); // just to check if the token is valid\n    const res = await provider.requestUploadParts({\n        multipart,\n        path\n    });\n    log.debug('Finished [requestUploadParts]');\n    return res;\n}\nasync function completeMultipartUpload(params) {\n    const { provider, router, ctxToken, body: { bucketName, uploadId, key, parts } } = params;\n    const log = globalThis._EDGE_STORE_LOGGER;\n    log.debug('Running [completeMultipartUpload]', {\n        bucketName,\n        uploadId,\n        key\n    });\n    if (!ctxToken) {\n        throw new _edgestore_shared__WEBPACK_IMPORTED_MODULE_0__.EdgeStoreError({\n            message: 'Missing edgestore-ctx cookie',\n            code: 'UNAUTHORIZED'\n        });\n    }\n    await getContext(ctxToken); // just to check if the token is valid\n    const bucket = router.buckets[bucketName];\n    if (!bucket) {\n        throw new _edgestore_shared__WEBPACK_IMPORTED_MODULE_0__.EdgeStoreError({\n            message: `Bucket ${bucketName} not found`,\n            code: 'BAD_REQUEST'\n        });\n    }\n    const res = await provider.completeMultipartUpload({\n        uploadId,\n        key,\n        parts\n    });\n    log.debug('Finished [completeMultipartUpload]');\n    return res;\n}\nasync function confirmUpload(params) {\n    const { provider, router, ctxToken, body: { bucketName, url } } = params;\n    const log = globalThis._EDGE_STORE_LOGGER;\n    log.debug('Running [confirmUpload]', {\n        bucketName,\n        url\n    });\n    if (!ctxToken) {\n        throw new _edgestore_shared__WEBPACK_IMPORTED_MODULE_0__.EdgeStoreError({\n            message: 'Missing edgestore-ctx cookie',\n            code: 'UNAUTHORIZED'\n        });\n    }\n    await getContext(ctxToken); // just to check if the token is valid\n    const bucket = router.buckets[bucketName];\n    if (!bucket) {\n        throw new _edgestore_shared__WEBPACK_IMPORTED_MODULE_0__.EdgeStoreError({\n            message: `Bucket ${bucketName} not found`,\n            code: 'BAD_REQUEST'\n        });\n    }\n    const res = await provider.confirmUpload({\n        bucket,\n        url: unproxyUrl(url)\n    });\n    log.debug('Finished [confirmUpload]');\n    return res;\n}\nasync function deleteFile(params) {\n    const { provider, router, ctxToken, body: { bucketName, url } } = params;\n    const log = globalThis._EDGE_STORE_LOGGER;\n    log.debug('Running [deleteFile]', {\n        bucketName,\n        url\n    });\n    if (!ctxToken) {\n        throw new _edgestore_shared__WEBPACK_IMPORTED_MODULE_0__.EdgeStoreError({\n            message: 'Missing edgestore-ctx cookie',\n            code: 'UNAUTHORIZED'\n        });\n    }\n    const ctx = await getContext(ctxToken);\n    const bucket = router.buckets[bucketName];\n    if (!bucket) {\n        throw new _edgestore_shared__WEBPACK_IMPORTED_MODULE_0__.EdgeStoreError({\n            message: `Bucket ${bucketName} not found`,\n            code: 'BAD_REQUEST'\n        });\n    }\n    if (!bucket._def.beforeDelete) {\n        throw new _edgestore_shared__WEBPACK_IMPORTED_MODULE_0__.EdgeStoreError({\n            message: 'You need to define beforeDelete if you want to delete files directly from the frontend.',\n            code: 'SERVER_ERROR'\n        });\n    }\n    const fileInfo = await provider.getFile({\n        url: unproxyUrl(url)\n    });\n    const canDelete = await bucket._def.beforeDelete({\n        ctx,\n        fileInfo\n    });\n    if (!canDelete) {\n        throw new _edgestore_shared__WEBPACK_IMPORTED_MODULE_0__.EdgeStoreError({\n            message: 'Delete not allowed for the current context',\n            code: 'DELETE_NOT_ALLOWED'\n        });\n    }\n    const res = await provider.deleteFile({\n        bucket,\n        url: unproxyUrl(url)\n    });\n    log.debug('Finished [deleteFile]');\n    return res;\n}\nasync function encryptJWT(ctx) {\n    const secret = process.env.EDGE_STORE_JWT_SECRET ?? process.env.EDGE_STORE_SECRET_KEY;\n    if (!secret) {\n        throw new _edgestore_shared__WEBPACK_IMPORTED_MODULE_0__.EdgeStoreError({\n            message: 'EDGE_STORE_JWT_SECRET or EDGE_STORE_SECRET_KEY is not defined',\n            code: 'SERVER_ERROR'\n        });\n    }\n    const encryptionSecret = await getDerivedEncryptionKey(secret);\n    return await new jose__WEBPACK_IMPORTED_MODULE_3__.EncryptJWT(ctx).setProtectedHeader({\n        alg: 'dir',\n        enc: 'A256GCM'\n    }).setIssuedAt().setExpirationTime(Date.now() / 1000 + DEFAULT_MAX_AGE).setJti((0,uuid__WEBPACK_IMPORTED_MODULE_4__[\"default\"])()).encrypt(encryptionSecret);\n}\nasync function decryptJWT(token) {\n    const secret = process.env.EDGE_STORE_JWT_SECRET ?? process.env.EDGE_STORE_SECRET_KEY;\n    if (!secret) {\n        throw new _edgestore_shared__WEBPACK_IMPORTED_MODULE_0__.EdgeStoreError({\n            message: 'EDGE_STORE_JWT_SECRET or EDGE_STORE_SECRET_KEY is not defined',\n            code: 'SERVER_ERROR'\n        });\n    }\n    const encryptionSecret = await getDerivedEncryptionKey(secret);\n    const { payload } = await (0,jose__WEBPACK_IMPORTED_MODULE_3__.jwtDecrypt)(token, encryptionSecret, {\n        clockTolerance: 15\n    });\n    return payload;\n}\nasync function getDerivedEncryptionKey(secret) {\n    return await (0,_panva_hkdf__WEBPACK_IMPORTED_MODULE_1__.hkdf)('sha256', secret, '', 'Edge Store Generated Encryption Key', 32);\n}\nfunction buildPath(params) {\n    const { bucket } = params;\n    const pathParams = bucket._def.path;\n    const path = pathParams.map((param)=>{\n        const paramEntries = Object.entries(param);\n        if (paramEntries[0] === undefined) {\n            throw new _edgestore_shared__WEBPACK_IMPORTED_MODULE_0__.EdgeStoreError({\n                message: `Empty path param found in: ${JSON.stringify(pathParams)}`,\n                code: 'SERVER_ERROR'\n            });\n        }\n        const [key, value] = paramEntries[0];\n        // this is a string like: \"ctx.xxx\" or \"input.yyy.zzz\"\n        const currParamVal = value().split('.').reduce((acc2, key)=>{\n            if (acc2[key] === undefined) {\n                throw new _edgestore_shared__WEBPACK_IMPORTED_MODULE_0__.EdgeStoreError({\n                    message: `Missing key ${key} in ${JSON.stringify(acc2)}`,\n                    code: 'BAD_REQUEST'\n                });\n            }\n            return acc2[key];\n        }, params.pathAttrs);\n        return {\n            key,\n            value: currParamVal\n        };\n    });\n    return path;\n}\nfunction parsePath(path) {\n    const parsedPath = path.reduce((acc, curr)=>{\n        acc[curr.key] = curr.value;\n        return acc;\n    }, {});\n    const pathOrder = path.map((p)=>p.key);\n    return {\n        parsedPath,\n        pathOrder\n    };\n}\nasync function getContext(token) {\n    return await decryptJWT(token);\n}\n/**\n * On local development, protected files are proxied to the server,\n * which changes the original URL.\n *\n * This function is used to get the original URL,\n * so that we can delete or confirm the upload.\n */ function unproxyUrl(url) {\n    if ( true && url.startsWith('http://')) {\n        // get the url param from the query string\n        const urlParam = new URL(url).searchParams.get('url');\n        if (urlParam) {\n            return urlParam;\n        }\n    }\n    return url;\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvQGVkZ2VzdG9yZS9zZXJ2ZXIvZGlzdC9zaGFyZWQtMDM5Mjc2YWYubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBbUQ7QUFDaEI7QUFDQTtBQUNXO0FBQ3BCOztBQUUxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDJDQUEyQztBQUMzQztBQUNBO0FBQ0EsWUFBWSx3QkFBd0I7QUFDcEM7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLFlBQVksUUFBUTtBQUNwQjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsUUFBUSxpREFBUztBQUNqQjtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSx3QkFBd0IsaURBQVM7QUFDakM7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksb0NBQW9DLGdDQUFnQztBQUNoRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0Esa0JBQWtCLDZEQUFjO0FBQ2hDO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLGtCQUFrQiw2REFBYztBQUNoQywrQkFBK0IsWUFBWTtBQUMzQztBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxzQkFBc0IsNkRBQWM7QUFDcEM7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQiw2REFBYztBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0IsNkRBQWM7QUFDcEM7QUFDQSw4REFBOEQsaUNBQWlDO0FBQy9GO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLDZEQUFjO0FBQ3BDO0FBQ0EsNkJBQTZCLGNBQWMsdUNBQXVDLHVCQUF1QjtBQUN6RztBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWSx3QkFBd0I7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksNEJBQTRCLG9CQUFvQjtBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLGtCQUFrQiw2REFBYztBQUNoQztBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsZ0NBQWdDO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksb0NBQW9DLHFDQUFxQztBQUNyRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0Esa0JBQWtCLDZEQUFjO0FBQ2hDO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxnQ0FBZ0M7QUFDaEM7QUFDQTtBQUNBLGtCQUFrQiw2REFBYztBQUNoQywrQkFBK0IsWUFBWTtBQUMzQztBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxvQ0FBb0Msb0JBQW9CO0FBQ3BFO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0Esa0JBQWtCLDZEQUFjO0FBQ2hDO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxnQ0FBZ0M7QUFDaEM7QUFDQTtBQUNBLGtCQUFrQiw2REFBYztBQUNoQywrQkFBK0IsWUFBWTtBQUMzQztBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksb0NBQW9DLG9CQUFvQjtBQUNwRTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLGtCQUFrQiw2REFBYztBQUNoQztBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLDZEQUFjO0FBQ2hDLCtCQUErQixZQUFZO0FBQzNDO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxrQkFBa0IsNkRBQWM7QUFDaEM7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0Esa0JBQWtCLDZEQUFjO0FBQ2hDO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLDZEQUFjO0FBQ2hDO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLHFCQUFxQiw0Q0FBVTtBQUMvQjtBQUNBO0FBQ0EsS0FBSyw4RUFBOEUsZ0RBQUU7QUFDckY7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsNkRBQWM7QUFDaEM7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsWUFBWSxVQUFVLFFBQVEsZ0RBQVU7QUFDeEM7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLGlEQUFJO0FBQ3JCO0FBQ0E7QUFDQSxZQUFZLFNBQVM7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0IsNkRBQWM7QUFDcEMsdURBQXVELDJCQUEyQjtBQUNsRjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLDZEQUFjO0FBQ3hDLDRDQUE0QyxLQUFLLEtBQUsscUJBQXFCO0FBQzNFO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSyxJQUFJO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLEtBQXNDO0FBQzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRXFLIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc3RvcmUvLi9ub2RlX21vZHVsZXMvQGVkZ2VzdG9yZS9zZXJ2ZXIvZGlzdC9zaGFyZWQtMDM5Mjc2YWYubWpzP2JhYjEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRWRnZVN0b3JlRXJyb3IgfSBmcm9tICdAZWRnZXN0b3JlL3NoYXJlZCc7XG5pbXBvcnQgeyBoa2RmIH0gZnJvbSAnQHBhbnZhL2hrZGYnO1xuaW1wb3J0IHsgc2VyaWFsaXplIH0gZnJvbSAnY29va2llJztcbmltcG9ydCB7IEVuY3J5cHRKV1QsIGp3dERlY3J5cHQgfSBmcm9tICdqb3NlJztcbmltcG9ydCB7IHY0IH0gZnJvbSAndXVpZCc7XG5cbmNvbnN0IElNQUdFX01JTUVfVFlQRVMgPSBbXG4gICAgJ2ltYWdlL2pwZWcnLFxuICAgICdpbWFnZS9wbmcnLFxuICAgICdpbWFnZS9naWYnLFxuICAgICdpbWFnZS93ZWJwJyxcbiAgICAnaW1hZ2Uvc3ZnK3htbCcsXG4gICAgJ2ltYWdlL3RpZmYnLFxuICAgICdpbWFnZS9ibXAnLFxuICAgICdpbWFnZS94LWljb24nXG5dO1xuXG4vLyBUT0RPOiBjaGFuZ2UgaXQgdG8gMSBob3VyIHdoZW4gd2UgaGF2ZSBhIHdheSB0byByZWZyZXNoIHRoZSB0b2tlblxuY29uc3QgREVGQVVMVF9NQVhfQUdFID0gMzAgKiAyNCAqIDYwICogNjA7IC8vIDMwIGRheXNcbmFzeW5jIGZ1bmN0aW9uIGluaXQocGFyYW1zKSB7XG4gICAgY29uc3QgbG9nID0gZ2xvYmFsVGhpcy5fRURHRV9TVE9SRV9MT0dHRVI7XG4gICAgY29uc3QgeyBjdHgsIHByb3ZpZGVyLCByb3V0ZXIgfSA9IHBhcmFtcztcbiAgICBsb2cuZGVidWcoJ1J1bm5pbmcgW2luaXRdJywge1xuICAgICAgICBjdHhcbiAgICB9KTtcbiAgICBjb25zdCBjdHhUb2tlbiA9IGF3YWl0IGVuY3J5cHRKV1QoY3R4KTtcbiAgICBjb25zdCB7IHRva2VuIH0gPSBhd2FpdCBwcm92aWRlci5pbml0KHtcbiAgICAgICAgY3R4LFxuICAgICAgICByb3V0ZXI6IHJvdXRlclxuICAgIH0pO1xuICAgIGNvbnN0IG5ld0Nvb2tpZXMgPSBbXG4gICAgICAgIHNlcmlhbGl6ZSgnZWRnZXN0b3JlLWN0eCcsIGN0eFRva2VuLCB7XG4gICAgICAgICAgICBwYXRoOiAnLycsXG4gICAgICAgICAgICBtYXhBZ2U6IERFRkFVTFRfTUFYX0FHRVxuICAgICAgICB9KVxuICAgIF07XG4gICAgaWYgKHRva2VuKSB7XG4gICAgICAgIG5ld0Nvb2tpZXMucHVzaChzZXJpYWxpemUoJ2VkZ2VzdG9yZS10b2tlbicsIHRva2VuLCB7XG4gICAgICAgICAgICBwYXRoOiAnLycsXG4gICAgICAgICAgICBtYXhBZ2U6IERFRkFVTFRfTUFYX0FHRVxuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGNvbnN0IGJhc2VVcmwgPSBhd2FpdCBwcm92aWRlci5nZXRCYXNlVXJsKCk7XG4gICAgbG9nLmRlYnVnKCdGaW5pc2hlZCBbaW5pdF0nLCB7XG4gICAgICAgIGN0eCxcbiAgICAgICAgbmV3Q29va2llcyxcbiAgICAgICAgdG9rZW4sXG4gICAgICAgIGJhc2VVcmxcbiAgICB9KTtcbiAgICByZXR1cm4ge1xuICAgICAgICBuZXdDb29raWVzLFxuICAgICAgICB0b2tlbixcbiAgICAgICAgYmFzZVVybFxuICAgIH07XG59XG5hc3luYyBmdW5jdGlvbiByZXF1ZXN0VXBsb2FkKHBhcmFtcykge1xuICAgIGNvbnN0IHsgcHJvdmlkZXIsIHJvdXRlciwgY3R4VG9rZW4sIGJvZHk6IHsgYnVja2V0TmFtZSwgaW5wdXQsIGZpbGVJbmZvIH0gfSA9IHBhcmFtcztcbiAgICBjb25zdCBsb2cgPSBnbG9iYWxUaGlzLl9FREdFX1NUT1JFX0xPR0dFUjtcbiAgICBsb2cuZGVidWcoJ1J1bm5pbmcgW3JlcXVlc3RVcGxvYWRdJywge1xuICAgICAgICBidWNrZXROYW1lLFxuICAgICAgICBpbnB1dCxcbiAgICAgICAgZmlsZUluZm9cbiAgICB9KTtcbiAgICBpZiAoIWN0eFRva2VuKSB7XG4gICAgICAgIHRocm93IG5ldyBFZGdlU3RvcmVFcnJvcih7XG4gICAgICAgICAgICBtZXNzYWdlOiAnTWlzc2luZyBlZGdlc3RvcmUtY3R4IGNvb2tpZScsXG4gICAgICAgICAgICBjb2RlOiAnVU5BVVRIT1JJWkVEJ1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgY3R4ID0gYXdhaXQgZ2V0Q29udGV4dChjdHhUb2tlbik7XG4gICAgbG9nLmRlYnVnKCdEZWNyeXB0ZWQgQ29udGV4dCcsIHtcbiAgICAgICAgY3R4XG4gICAgfSk7XG4gICAgY29uc3QgYnVja2V0ID0gcm91dGVyLmJ1Y2tldHNbYnVja2V0TmFtZV07XG4gICAgaWYgKCFidWNrZXQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVkZ2VTdG9yZUVycm9yKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6IGBCdWNrZXQgJHtidWNrZXROYW1lfSBub3QgZm91bmRgLFxuICAgICAgICAgICAgY29kZTogJ0JBRF9SRVFVRVNUJ1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgaWYgKGJ1Y2tldC5fZGVmLmJlZm9yZVVwbG9hZCkge1xuICAgICAgICBsb2cuZGVidWcoJ1J1bm5pbmcgW2JlZm9yZVVwbG9hZF0nKTtcbiAgICAgICAgY29uc3QgY2FuVXBsb2FkID0gYXdhaXQgYnVja2V0Ll9kZWYuYmVmb3JlVXBsb2FkPy4oe1xuICAgICAgICAgICAgY3R4LFxuICAgICAgICAgICAgaW5wdXQsXG4gICAgICAgICAgICBmaWxlSW5mbzoge1xuICAgICAgICAgICAgICAgIHNpemU6IGZpbGVJbmZvLnNpemUsXG4gICAgICAgICAgICAgICAgdHlwZTogZmlsZUluZm8udHlwZSxcbiAgICAgICAgICAgICAgICBmaWxlTmFtZTogZmlsZUluZm8uZmlsZU5hbWUsXG4gICAgICAgICAgICAgICAgZXh0ZW5zaW9uOiBmaWxlSW5mby5leHRlbnNpb24sXG4gICAgICAgICAgICAgICAgcmVwbGFjZVRhcmdldFVybDogZmlsZUluZm8ucmVwbGFjZVRhcmdldFVybCxcbiAgICAgICAgICAgICAgICB0ZW1wb3Jhcnk6IGZpbGVJbmZvLnRlbXBvcmFyeVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgbG9nLmRlYnVnKCdGaW5pc2hlZCBbYmVmb3JlVXBsb2FkXScsIHtcbiAgICAgICAgICAgIGNhblVwbG9hZFxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKCFjYW5VcGxvYWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFZGdlU3RvcmVFcnJvcih7XG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ1VwbG9hZCBub3QgYWxsb3dlZCBmb3IgdGhlIGN1cnJlbnQgY29udGV4dCcsXG4gICAgICAgICAgICAgICAgY29kZTogJ1VQTE9BRF9OT1RfQUxMT1dFRCdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChidWNrZXQuX2RlZi50eXBlID09PSAnSU1BR0UnKSB7XG4gICAgICAgIGlmICghSU1BR0VfTUlNRV9UWVBFUy5pbmNsdWRlcyhmaWxlSW5mby50eXBlKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVkZ2VTdG9yZUVycm9yKHtcbiAgICAgICAgICAgICAgICBjb2RlOiAnTUlNRV9UWVBFX05PVF9BTExPV0VEJyxcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnT25seSBpbWFnZXMgYXJlIGFsbG93ZWQgaW4gdGhpcyBidWNrZXQnLFxuICAgICAgICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgICAgICAgICAgYWxsb3dlZE1pbWVUeXBlczogSU1BR0VfTUlNRV9UWVBFUyxcbiAgICAgICAgICAgICAgICAgICAgbWltZVR5cGU6IGZpbGVJbmZvLnR5cGVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoYnVja2V0Ll9kZWYuYnVja2V0Q29uZmlnPy5tYXhTaXplKSB7XG4gICAgICAgIGlmIChmaWxlSW5mby5zaXplID4gYnVja2V0Ll9kZWYuYnVja2V0Q29uZmlnLm1heFNpemUpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFZGdlU3RvcmVFcnJvcih7XG4gICAgICAgICAgICAgICAgY29kZTogJ0ZJTEVfVE9PX0xBUkdFJyxcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBgRmlsZSBzaXplIGlzIHRvbyBiaWcuIE1heCBzaXplIGlzICR7YnVja2V0Ll9kZWYuYnVja2V0Q29uZmlnLm1heFNpemV9YCxcbiAgICAgICAgICAgICAgICBkZXRhaWxzOiB7XG4gICAgICAgICAgICAgICAgICAgIG1heEZpbGVTaXplOiBidWNrZXQuX2RlZi5idWNrZXRDb25maWcubWF4U2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgZmlsZVNpemU6IGZpbGVJbmZvLnNpemVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoYnVja2V0Ll9kZWYuYnVja2V0Q29uZmlnPy5hY2NlcHQpIHtcbiAgICAgICAgY29uc3QgYWNjZXB0ID0gYnVja2V0Ll9kZWYuYnVja2V0Q29uZmlnLmFjY2VwdDtcbiAgICAgICAgbGV0IGFjY2VwdGVkID0gZmFsc2U7XG4gICAgICAgIGZvciAoY29uc3QgYWNjZXB0ZWRNaW1lVHlwZSBvZiBhY2NlcHQpe1xuICAgICAgICAgICAgaWYgKGFjY2VwdGVkTWltZVR5cGUuZW5kc1dpdGgoJy8qJykpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBtaW1lVHlwZSA9IGFjY2VwdGVkTWltZVR5cGUucmVwbGFjZSgnLyonLCAnJyk7XG4gICAgICAgICAgICAgICAgaWYgKGZpbGVJbmZvLnR5cGUuc3RhcnRzV2l0aChtaW1lVHlwZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgYWNjZXB0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGZpbGVJbmZvLnR5cGUgPT09IGFjY2VwdGVkTWltZVR5cGUpIHtcbiAgICAgICAgICAgICAgICBhY2NlcHRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFhY2NlcHRlZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVkZ2VTdG9yZUVycm9yKHtcbiAgICAgICAgICAgICAgICBjb2RlOiAnTUlNRV9UWVBFX05PVF9BTExPV0VEJyxcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBgXCIke2ZpbGVJbmZvLnR5cGV9XCIgaXMgbm90IGFsbG93ZWQuIEFjY2VwdGVkIHR5cGVzIGFyZSAke0pTT04uc3RyaW5naWZ5KGFjY2VwdCl9YCxcbiAgICAgICAgICAgICAgICBkZXRhaWxzOiB7XG4gICAgICAgICAgICAgICAgICAgIGFsbG93ZWRNaW1lVHlwZXM6IGFjY2VwdCxcbiAgICAgICAgICAgICAgICAgICAgbWltZVR5cGU6IGZpbGVJbmZvLnR5cGVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBwYXRoID0gYnVpbGRQYXRoKHtcbiAgICAgICAgZmlsZUluZm8sXG4gICAgICAgIGJ1Y2tldCxcbiAgICAgICAgcGF0aEF0dHJzOiB7XG4gICAgICAgICAgICBjdHgsXG4gICAgICAgICAgICBpbnB1dFxuICAgICAgICB9XG4gICAgfSk7XG4gICAgY29uc3QgbWV0YWRhdGEgPSBhd2FpdCBidWNrZXQuX2RlZi5tZXRhZGF0YT8uKHtcbiAgICAgICAgY3R4LFxuICAgICAgICBpbnB1dFxuICAgIH0pO1xuICAgIGNvbnN0IGlzUHVibGljID0gYnVja2V0Ll9kZWYuYWNjZXNzQ29udHJvbCA9PT0gdW5kZWZpbmVkO1xuICAgIGxvZy5kZWJ1ZygndXBsb2FkIGluZm8nLCB7XG4gICAgICAgIHBhdGgsXG4gICAgICAgIG1ldGFkYXRhLFxuICAgICAgICBpc1B1YmxpYyxcbiAgICAgICAgYnVja2V0VHlwZTogYnVja2V0Ll9kZWYudHlwZVxuICAgIH0pO1xuICAgIGNvbnN0IHJlcXVlc3RVcGxvYWRSZXMgPSBhd2FpdCBwcm92aWRlci5yZXF1ZXN0VXBsb2FkKHtcbiAgICAgICAgYnVja2V0TmFtZSxcbiAgICAgICAgYnVja2V0VHlwZTogYnVja2V0Ll9kZWYudHlwZSxcbiAgICAgICAgZmlsZUluZm86IHtcbiAgICAgICAgICAgIC4uLmZpbGVJbmZvLFxuICAgICAgICAgICAgcGF0aCxcbiAgICAgICAgICAgIGlzUHVibGljLFxuICAgICAgICAgICAgbWV0YWRhdGFcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIGNvbnN0IHsgcGFyc2VkUGF0aCwgcGF0aE9yZGVyIH0gPSBwYXJzZVBhdGgocGF0aCk7XG4gICAgbG9nLmRlYnVnKCdGaW5pc2hlZCBbcmVxdWVzdFVwbG9hZF0nKTtcbiAgICByZXR1cm4ge1xuICAgICAgICAuLi5yZXF1ZXN0VXBsb2FkUmVzLFxuICAgICAgICBzaXplOiBmaWxlSW5mby5zaXplLFxuICAgICAgICB1cGxvYWRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIHBhdGg6IHBhcnNlZFBhdGgsXG4gICAgICAgIHBhdGhPcmRlcixcbiAgICAgICAgbWV0YWRhdGFcbiAgICB9O1xufVxuYXN5bmMgZnVuY3Rpb24gcmVxdWVzdFVwbG9hZFBhcnRzKHBhcmFtcykge1xuICAgIGNvbnN0IHsgcHJvdmlkZXIsIGN0eFRva2VuLCBib2R5OiB7IG11bHRpcGFydCwgcGF0aCB9IH0gPSBwYXJhbXM7XG4gICAgY29uc3QgbG9nID0gZ2xvYmFsVGhpcy5fRURHRV9TVE9SRV9MT0dHRVI7XG4gICAgbG9nLmRlYnVnKCdSdW5uaW5nIFtyZXF1ZXN0VXBsb2FkUGFydHNdJywge1xuICAgICAgICBtdWx0aXBhcnQsXG4gICAgICAgIHBhdGhcbiAgICB9KTtcbiAgICBpZiAoIWN0eFRva2VuKSB7XG4gICAgICAgIHRocm93IG5ldyBFZGdlU3RvcmVFcnJvcih7XG4gICAgICAgICAgICBtZXNzYWdlOiAnTWlzc2luZyBlZGdlc3RvcmUtY3R4IGNvb2tpZScsXG4gICAgICAgICAgICBjb2RlOiAnVU5BVVRIT1JJWkVEJ1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgYXdhaXQgZ2V0Q29udGV4dChjdHhUb2tlbik7IC8vIGp1c3QgdG8gY2hlY2sgaWYgdGhlIHRva2VuIGlzIHZhbGlkXG4gICAgY29uc3QgcmVzID0gYXdhaXQgcHJvdmlkZXIucmVxdWVzdFVwbG9hZFBhcnRzKHtcbiAgICAgICAgbXVsdGlwYXJ0LFxuICAgICAgICBwYXRoXG4gICAgfSk7XG4gICAgbG9nLmRlYnVnKCdGaW5pc2hlZCBbcmVxdWVzdFVwbG9hZFBhcnRzXScpO1xuICAgIHJldHVybiByZXM7XG59XG5hc3luYyBmdW5jdGlvbiBjb21wbGV0ZU11bHRpcGFydFVwbG9hZChwYXJhbXMpIHtcbiAgICBjb25zdCB7IHByb3ZpZGVyLCByb3V0ZXIsIGN0eFRva2VuLCBib2R5OiB7IGJ1Y2tldE5hbWUsIHVwbG9hZElkLCBrZXksIHBhcnRzIH0gfSA9IHBhcmFtcztcbiAgICBjb25zdCBsb2cgPSBnbG9iYWxUaGlzLl9FREdFX1NUT1JFX0xPR0dFUjtcbiAgICBsb2cuZGVidWcoJ1J1bm5pbmcgW2NvbXBsZXRlTXVsdGlwYXJ0VXBsb2FkXScsIHtcbiAgICAgICAgYnVja2V0TmFtZSxcbiAgICAgICAgdXBsb2FkSWQsXG4gICAgICAgIGtleVxuICAgIH0pO1xuICAgIGlmICghY3R4VG9rZW4pIHtcbiAgICAgICAgdGhyb3cgbmV3IEVkZ2VTdG9yZUVycm9yKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdNaXNzaW5nIGVkZ2VzdG9yZS1jdHggY29va2llJyxcbiAgICAgICAgICAgIGNvZGU6ICdVTkFVVEhPUklaRUQnXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBhd2FpdCBnZXRDb250ZXh0KGN0eFRva2VuKTsgLy8ganVzdCB0byBjaGVjayBpZiB0aGUgdG9rZW4gaXMgdmFsaWRcbiAgICBjb25zdCBidWNrZXQgPSByb3V0ZXIuYnVja2V0c1tidWNrZXROYW1lXTtcbiAgICBpZiAoIWJ1Y2tldCkge1xuICAgICAgICB0aHJvdyBuZXcgRWRnZVN0b3JlRXJyb3Ioe1xuICAgICAgICAgICAgbWVzc2FnZTogYEJ1Y2tldCAke2J1Y2tldE5hbWV9IG5vdCBmb3VuZGAsXG4gICAgICAgICAgICBjb2RlOiAnQkFEX1JFUVVFU1QnXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCByZXMgPSBhd2FpdCBwcm92aWRlci5jb21wbGV0ZU11bHRpcGFydFVwbG9hZCh7XG4gICAgICAgIHVwbG9hZElkLFxuICAgICAgICBrZXksXG4gICAgICAgIHBhcnRzXG4gICAgfSk7XG4gICAgbG9nLmRlYnVnKCdGaW5pc2hlZCBbY29tcGxldGVNdWx0aXBhcnRVcGxvYWRdJyk7XG4gICAgcmV0dXJuIHJlcztcbn1cbmFzeW5jIGZ1bmN0aW9uIGNvbmZpcm1VcGxvYWQocGFyYW1zKSB7XG4gICAgY29uc3QgeyBwcm92aWRlciwgcm91dGVyLCBjdHhUb2tlbiwgYm9keTogeyBidWNrZXROYW1lLCB1cmwgfSB9ID0gcGFyYW1zO1xuICAgIGNvbnN0IGxvZyA9IGdsb2JhbFRoaXMuX0VER0VfU1RPUkVfTE9HR0VSO1xuICAgIGxvZy5kZWJ1ZygnUnVubmluZyBbY29uZmlybVVwbG9hZF0nLCB7XG4gICAgICAgIGJ1Y2tldE5hbWUsXG4gICAgICAgIHVybFxuICAgIH0pO1xuICAgIGlmICghY3R4VG9rZW4pIHtcbiAgICAgICAgdGhyb3cgbmV3IEVkZ2VTdG9yZUVycm9yKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdNaXNzaW5nIGVkZ2VzdG9yZS1jdHggY29va2llJyxcbiAgICAgICAgICAgIGNvZGU6ICdVTkFVVEhPUklaRUQnXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBhd2FpdCBnZXRDb250ZXh0KGN0eFRva2VuKTsgLy8ganVzdCB0byBjaGVjayBpZiB0aGUgdG9rZW4gaXMgdmFsaWRcbiAgICBjb25zdCBidWNrZXQgPSByb3V0ZXIuYnVja2V0c1tidWNrZXROYW1lXTtcbiAgICBpZiAoIWJ1Y2tldCkge1xuICAgICAgICB0aHJvdyBuZXcgRWRnZVN0b3JlRXJyb3Ioe1xuICAgICAgICAgICAgbWVzc2FnZTogYEJ1Y2tldCAke2J1Y2tldE5hbWV9IG5vdCBmb3VuZGAsXG4gICAgICAgICAgICBjb2RlOiAnQkFEX1JFUVVFU1QnXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCByZXMgPSBhd2FpdCBwcm92aWRlci5jb25maXJtVXBsb2FkKHtcbiAgICAgICAgYnVja2V0LFxuICAgICAgICB1cmw6IHVucHJveHlVcmwodXJsKVxuICAgIH0pO1xuICAgIGxvZy5kZWJ1ZygnRmluaXNoZWQgW2NvbmZpcm1VcGxvYWRdJyk7XG4gICAgcmV0dXJuIHJlcztcbn1cbmFzeW5jIGZ1bmN0aW9uIGRlbGV0ZUZpbGUocGFyYW1zKSB7XG4gICAgY29uc3QgeyBwcm92aWRlciwgcm91dGVyLCBjdHhUb2tlbiwgYm9keTogeyBidWNrZXROYW1lLCB1cmwgfSB9ID0gcGFyYW1zO1xuICAgIGNvbnN0IGxvZyA9IGdsb2JhbFRoaXMuX0VER0VfU1RPUkVfTE9HR0VSO1xuICAgIGxvZy5kZWJ1ZygnUnVubmluZyBbZGVsZXRlRmlsZV0nLCB7XG4gICAgICAgIGJ1Y2tldE5hbWUsXG4gICAgICAgIHVybFxuICAgIH0pO1xuICAgIGlmICghY3R4VG9rZW4pIHtcbiAgICAgICAgdGhyb3cgbmV3IEVkZ2VTdG9yZUVycm9yKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdNaXNzaW5nIGVkZ2VzdG9yZS1jdHggY29va2llJyxcbiAgICAgICAgICAgIGNvZGU6ICdVTkFVVEhPUklaRUQnXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCBjdHggPSBhd2FpdCBnZXRDb250ZXh0KGN0eFRva2VuKTtcbiAgICBjb25zdCBidWNrZXQgPSByb3V0ZXIuYnVja2V0c1tidWNrZXROYW1lXTtcbiAgICBpZiAoIWJ1Y2tldCkge1xuICAgICAgICB0aHJvdyBuZXcgRWRnZVN0b3JlRXJyb3Ioe1xuICAgICAgICAgICAgbWVzc2FnZTogYEJ1Y2tldCAke2J1Y2tldE5hbWV9IG5vdCBmb3VuZGAsXG4gICAgICAgICAgICBjb2RlOiAnQkFEX1JFUVVFU1QnXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAoIWJ1Y2tldC5fZGVmLmJlZm9yZURlbGV0ZSkge1xuICAgICAgICB0aHJvdyBuZXcgRWRnZVN0b3JlRXJyb3Ioe1xuICAgICAgICAgICAgbWVzc2FnZTogJ1lvdSBuZWVkIHRvIGRlZmluZSBiZWZvcmVEZWxldGUgaWYgeW91IHdhbnQgdG8gZGVsZXRlIGZpbGVzIGRpcmVjdGx5IGZyb20gdGhlIGZyb250ZW5kLicsXG4gICAgICAgICAgICBjb2RlOiAnU0VSVkVSX0VSUk9SJ1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgZmlsZUluZm8gPSBhd2FpdCBwcm92aWRlci5nZXRGaWxlKHtcbiAgICAgICAgdXJsOiB1bnByb3h5VXJsKHVybClcbiAgICB9KTtcbiAgICBjb25zdCBjYW5EZWxldGUgPSBhd2FpdCBidWNrZXQuX2RlZi5iZWZvcmVEZWxldGUoe1xuICAgICAgICBjdHgsXG4gICAgICAgIGZpbGVJbmZvXG4gICAgfSk7XG4gICAgaWYgKCFjYW5EZWxldGUpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVkZ2VTdG9yZUVycm9yKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdEZWxldGUgbm90IGFsbG93ZWQgZm9yIHRoZSBjdXJyZW50IGNvbnRleHQnLFxuICAgICAgICAgICAgY29kZTogJ0RFTEVURV9OT1RfQUxMT1dFRCdcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHByb3ZpZGVyLmRlbGV0ZUZpbGUoe1xuICAgICAgICBidWNrZXQsXG4gICAgICAgIHVybDogdW5wcm94eVVybCh1cmwpXG4gICAgfSk7XG4gICAgbG9nLmRlYnVnKCdGaW5pc2hlZCBbZGVsZXRlRmlsZV0nKTtcbiAgICByZXR1cm4gcmVzO1xufVxuYXN5bmMgZnVuY3Rpb24gZW5jcnlwdEpXVChjdHgpIHtcbiAgICBjb25zdCBzZWNyZXQgPSBwcm9jZXNzLmVudi5FREdFX1NUT1JFX0pXVF9TRUNSRVQgPz8gcHJvY2Vzcy5lbnYuRURHRV9TVE9SRV9TRUNSRVRfS0VZO1xuICAgIGlmICghc2VjcmV0KSB7XG4gICAgICAgIHRocm93IG5ldyBFZGdlU3RvcmVFcnJvcih7XG4gICAgICAgICAgICBtZXNzYWdlOiAnRURHRV9TVE9SRV9KV1RfU0VDUkVUIG9yIEVER0VfU1RPUkVfU0VDUkVUX0tFWSBpcyBub3QgZGVmaW5lZCcsXG4gICAgICAgICAgICBjb2RlOiAnU0VSVkVSX0VSUk9SJ1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgZW5jcnlwdGlvblNlY3JldCA9IGF3YWl0IGdldERlcml2ZWRFbmNyeXB0aW9uS2V5KHNlY3JldCk7XG4gICAgcmV0dXJuIGF3YWl0IG5ldyBFbmNyeXB0SldUKGN0eCkuc2V0UHJvdGVjdGVkSGVhZGVyKHtcbiAgICAgICAgYWxnOiAnZGlyJyxcbiAgICAgICAgZW5jOiAnQTI1NkdDTSdcbiAgICB9KS5zZXRJc3N1ZWRBdCgpLnNldEV4cGlyYXRpb25UaW1lKERhdGUubm93KCkgLyAxMDAwICsgREVGQVVMVF9NQVhfQUdFKS5zZXRKdGkodjQoKSkuZW5jcnlwdChlbmNyeXB0aW9uU2VjcmV0KTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGRlY3J5cHRKV1QodG9rZW4pIHtcbiAgICBjb25zdCBzZWNyZXQgPSBwcm9jZXNzLmVudi5FREdFX1NUT1JFX0pXVF9TRUNSRVQgPz8gcHJvY2Vzcy5lbnYuRURHRV9TVE9SRV9TRUNSRVRfS0VZO1xuICAgIGlmICghc2VjcmV0KSB7XG4gICAgICAgIHRocm93IG5ldyBFZGdlU3RvcmVFcnJvcih7XG4gICAgICAgICAgICBtZXNzYWdlOiAnRURHRV9TVE9SRV9KV1RfU0VDUkVUIG9yIEVER0VfU1RPUkVfU0VDUkVUX0tFWSBpcyBub3QgZGVmaW5lZCcsXG4gICAgICAgICAgICBjb2RlOiAnU0VSVkVSX0VSUk9SJ1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgZW5jcnlwdGlvblNlY3JldCA9IGF3YWl0IGdldERlcml2ZWRFbmNyeXB0aW9uS2V5KHNlY3JldCk7XG4gICAgY29uc3QgeyBwYXlsb2FkIH0gPSBhd2FpdCBqd3REZWNyeXB0KHRva2VuLCBlbmNyeXB0aW9uU2VjcmV0LCB7XG4gICAgICAgIGNsb2NrVG9sZXJhbmNlOiAxNVxuICAgIH0pO1xuICAgIHJldHVybiBwYXlsb2FkO1xufVxuYXN5bmMgZnVuY3Rpb24gZ2V0RGVyaXZlZEVuY3J5cHRpb25LZXkoc2VjcmV0KSB7XG4gICAgcmV0dXJuIGF3YWl0IGhrZGYoJ3NoYTI1NicsIHNlY3JldCwgJycsICdFZGdlIFN0b3JlIEdlbmVyYXRlZCBFbmNyeXB0aW9uIEtleScsIDMyKTtcbn1cbmZ1bmN0aW9uIGJ1aWxkUGF0aChwYXJhbXMpIHtcbiAgICBjb25zdCB7IGJ1Y2tldCB9ID0gcGFyYW1zO1xuICAgIGNvbnN0IHBhdGhQYXJhbXMgPSBidWNrZXQuX2RlZi5wYXRoO1xuICAgIGNvbnN0IHBhdGggPSBwYXRoUGFyYW1zLm1hcCgocGFyYW0pPT57XG4gICAgICAgIGNvbnN0IHBhcmFtRW50cmllcyA9IE9iamVjdC5lbnRyaWVzKHBhcmFtKTtcbiAgICAgICAgaWYgKHBhcmFtRW50cmllc1swXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRWRnZVN0b3JlRXJyb3Ioe1xuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGBFbXB0eSBwYXRoIHBhcmFtIGZvdW5kIGluOiAke0pTT04uc3RyaW5naWZ5KHBhdGhQYXJhbXMpfWAsXG4gICAgICAgICAgICAgICAgY29kZTogJ1NFUlZFUl9FUlJPUidcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IFtrZXksIHZhbHVlXSA9IHBhcmFtRW50cmllc1swXTtcbiAgICAgICAgLy8gdGhpcyBpcyBhIHN0cmluZyBsaWtlOiBcImN0eC54eHhcIiBvciBcImlucHV0Lnl5eS56enpcIlxuICAgICAgICBjb25zdCBjdXJyUGFyYW1WYWwgPSB2YWx1ZSgpLnNwbGl0KCcuJykucmVkdWNlKChhY2MyLCBrZXkpPT57XG4gICAgICAgICAgICBpZiAoYWNjMltrZXldID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRWRnZVN0b3JlRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBgTWlzc2luZyBrZXkgJHtrZXl9IGluICR7SlNPTi5zdHJpbmdpZnkoYWNjMil9YCxcbiAgICAgICAgICAgICAgICAgICAgY29kZTogJ0JBRF9SRVFVRVNUJ1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGFjYzJba2V5XTtcbiAgICAgICAgfSwgcGFyYW1zLnBhdGhBdHRycyk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBrZXksXG4gICAgICAgICAgICB2YWx1ZTogY3VyclBhcmFtVmFsXG4gICAgICAgIH07XG4gICAgfSk7XG4gICAgcmV0dXJuIHBhdGg7XG59XG5mdW5jdGlvbiBwYXJzZVBhdGgocGF0aCkge1xuICAgIGNvbnN0IHBhcnNlZFBhdGggPSBwYXRoLnJlZHVjZSgoYWNjLCBjdXJyKT0+e1xuICAgICAgICBhY2NbY3Vyci5rZXldID0gY3Vyci52YWx1ZTtcbiAgICAgICAgcmV0dXJuIGFjYztcbiAgICB9LCB7fSk7XG4gICAgY29uc3QgcGF0aE9yZGVyID0gcGF0aC5tYXAoKHApPT5wLmtleSk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcGFyc2VkUGF0aCxcbiAgICAgICAgcGF0aE9yZGVyXG4gICAgfTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGdldENvbnRleHQodG9rZW4pIHtcbiAgICByZXR1cm4gYXdhaXQgZGVjcnlwdEpXVCh0b2tlbik7XG59XG4vKipcbiAqIE9uIGxvY2FsIGRldmVsb3BtZW50LCBwcm90ZWN0ZWQgZmlsZXMgYXJlIHByb3hpZWQgdG8gdGhlIHNlcnZlcixcbiAqIHdoaWNoIGNoYW5nZXMgdGhlIG9yaWdpbmFsIFVSTC5cbiAqXG4gKiBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQgdG8gZ2V0IHRoZSBvcmlnaW5hbCBVUkwsXG4gKiBzbyB0aGF0IHdlIGNhbiBkZWxldGUgb3IgY29uZmlybSB0aGUgdXBsb2FkLlxuICovIGZ1bmN0aW9uIHVucHJveHlVcmwodXJsKSB7XG4gICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnICYmIHVybC5zdGFydHNXaXRoKCdodHRwOi8vJykpIHtcbiAgICAgICAgLy8gZ2V0IHRoZSB1cmwgcGFyYW0gZnJvbSB0aGUgcXVlcnkgc3RyaW5nXG4gICAgICAgIGNvbnN0IHVybFBhcmFtID0gbmV3IFVSTCh1cmwpLnNlYXJjaFBhcmFtcy5nZXQoJ3VybCcpO1xuICAgICAgICBpZiAodXJsUGFyYW0pIHtcbiAgICAgICAgICAgIHJldHVybiB1cmxQYXJhbTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdXJsO1xufVxuXG5leHBvcnQgeyByZXF1ZXN0VXBsb2FkUGFydHMgYXMgYSwgYnVpbGRQYXRoIGFzIGIsIGNvbXBsZXRlTXVsdGlwYXJ0VXBsb2FkIGFzIGMsIGNvbmZpcm1VcGxvYWQgYXMgZCwgZGVsZXRlRmlsZSBhcyBlLCBpbml0IGFzIGksIHBhcnNlUGF0aCBhcyBwLCByZXF1ZXN0VXBsb2FkIGFzIHIgfTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/@edgestore/server/dist/shared-039276af.mjs\n");

/***/ }),

/***/ "(rsc)/./node_modules/@edgestore/shared/dist/index.mjs":
/*!*******************************************************!*\
  !*** ./node_modules/@edgestore/shared/dist/index.mjs ***!
  \*******************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   EDGE_STORE_ERROR_CODES: () => (/* binding */ EDGE_STORE_ERROR_CODES),\n/* harmony export */   EdgeStoreApiClientError: () => (/* binding */ EdgeStoreApiClientError),\n/* harmony export */   EdgeStoreError: () => (/* binding */ EdgeStoreError),\n/* harmony export */   initEdgeStore: () => (/* binding */ initEdgeStore)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! zod */ \"(rsc)/./node_modules/zod/lib/index.mjs\");\n\n\nfunction _define_property$1(obj, key, value) {\n    if (key in obj) {\n        Object.defineProperty(obj, key, {\n            value: value,\n            enumerable: true,\n            configurable: true,\n            writable: true\n        });\n    } else {\n        obj[key] = value;\n    }\n    return obj;\n}\n/* eslint-disable @typescript-eslint/no-non-null-assertion */ const EDGE_STORE_ERROR_CODES = {\n    BAD_REQUEST: 400,\n    FILE_TOO_LARGE: 400,\n    MIME_TYPE_NOT_ALLOWED: 400,\n    UNAUTHORIZED: 401,\n    UPLOAD_NOT_ALLOWED: 403,\n    DELETE_NOT_ALLOWED: 403,\n    CREATE_CONTEXT_ERROR: 500,\n    SERVER_ERROR: 500\n};\nclass EdgeStoreError extends Error {\n    formattedMessage() {\n        return `${this.message}${this.details ? `\\n    Details: ${JSON.stringify(this.details)}` : ''}${this.cause ? `\\n    Caused by: ${this.cause.message}` : ''}`;\n    }\n    formattedJson() {\n        return {\n            message: this.code === 'SERVER_ERROR' ? 'Internal server error' : this.message,\n            code: this.code,\n            details: this.details\n        };\n    }\n    constructor(opts){\n        super(opts.message);\n        _define_property$1(this, \"cause\", void 0);\n        _define_property$1(this, \"code\", void 0);\n        _define_property$1(this, \"level\", void 0);\n        _define_property$1(this, \"details\", void 0);\n        this.name = 'EdgeStoreError';\n        this.code = opts.code;\n        this.cause = opts.cause;\n        this.level = EDGE_STORE_ERROR_CODES[opts.code] >= 500 ? 'error' : 'warn';\n        this.details = 'details' in opts ? opts.details : undefined;\n    }\n}\n\nfunction _define_property(obj, key, value) {\n    if (key in obj) {\n        Object.defineProperty(obj, key, {\n            value: value,\n            enumerable: true,\n            configurable: true,\n            writable: true\n        });\n    } else {\n        obj[key] = value;\n    }\n    return obj;\n}\nclass EdgeStoreApiClientError extends Error {\n    constructor(opts){\n        super(opts.response.message);\n        _define_property(this, \"data\", void 0);\n        this.name = 'EdgeStoreApiClientError';\n        this.data = opts.response;\n    }\n}\n\n/**\n * Creates a Proxy that prints the path to the property when called.\n *\n * Example:\n *\n * ```ts\n * const pathParamProxy = createPathParamProxy();\n * console.log(pathParamProxy.ctx.user.id());\n * // Logs: \"ctx.user.id\"\n * console.log(pathParamProxy.input.type());\n * // Logs: \"input.type\"\n * ```\n */ function createPathParamProxy() {\n    const getPath = (target, _prop)=>{\n        const proxyFunction = ()=>target;\n        return new Proxy(proxyFunction, {\n            get: (_target, propChild)=>{\n                return getPath(`${target}.${String(propChild)}`);\n            }\n        });\n    };\n    return new Proxy(()=>'', {\n        get: (_target, prop)=>{\n            return getPath(String(prop));\n        }\n    });\n}\n\nconst createNewBuilder = (initDef, newDef)=>{\n    const mergedDef = {\n        ...initDef,\n        ...newDef\n    };\n    return createBuilder({\n        type: mergedDef.type\n    }, mergedDef);\n};\nfunction createBuilder(opts, initDef) {\n    const _def = {\n        type: opts.type,\n        input: zod__WEBPACK_IMPORTED_MODULE_0__.z.never(),\n        path: [],\n        metadata: ()=>({}),\n        ...initDef\n    };\n    return {\n        $config: {\n            ctx: undefined\n        },\n        // @ts-expect-error - I think it would be too much work to make this type correct.\n        _def,\n        input (input) {\n            return createNewBuilder(_def, {\n                input\n            });\n        },\n        path (pathResolver) {\n            // TODO: Should throw a runtime error in the following cases:\n            // 1. in case of multiple keys in one object\n            // 2. in case of duplicate keys\n            const pathParamProxy = createPathParamProxy();\n            const params = pathResolver(pathParamProxy);\n            return createNewBuilder(_def, {\n                path: params\n            });\n        },\n        metadata (metadata) {\n            return createNewBuilder(_def, {\n                metadata\n            });\n        },\n        accessControl (accessControl) {\n            return createNewBuilder(_def, {\n                accessControl: accessControl\n            });\n        },\n        beforeUpload (beforeUpload) {\n            return createNewBuilder(_def, {\n                beforeUpload\n            });\n        },\n        beforeDelete (beforeDelete) {\n            return createNewBuilder(_def, {\n                beforeDelete\n            });\n        }\n    };\n}\nclass EdgeStoreBuilder {\n    context() {\n        return new EdgeStoreBuilder();\n    }\n    create() {\n        return createEdgeStoreInner()();\n    }\n}\nfunction createRouterFactory() {\n    return function createRouterInner(buckets) {\n        return {\n            $config: {\n                ctx: undefined\n            },\n            buckets\n        };\n    };\n}\nfunction initBucket(type, config) {\n    return createBuilder({\n        type\n    }, {\n        bucketConfig: config\n    });\n}\nfunction createEdgeStoreInner() {\n    return function initEdgeStoreInner() {\n        return {\n            /**\n       * Builder object for creating an image bucket\n       */ imageBucket (config) {\n                return initBucket('IMAGE', config);\n            },\n            /**\n       * Builder object for creating a file bucket\n       */ fileBucket (config) {\n                return initBucket('FILE', config);\n            },\n            /**\n       * Create a router\n       */ router: createRouterFactory()\n        };\n    };\n}\n/**\n * Initialize EdgeStore - be done exactly once per backend\n */ const initEdgeStore = new EdgeStoreBuilder(); // ↓↓↓ TYPE TESTS ↓↓↓\n // type Context = {\n //   userId: string;\n //   userRole: 'admin' | 'visitor';\n // };\n // const es = initEdgeStore.context<Context>().create();\n // const imagesBucket = es.imageBucket()\n //   .input(\n //     z.object({\n //       type: z.enum(['profile', 'post']),\n //       extension: z.string().optional(),\n //     }),\n //   )\n //   .path(({ ctx, input }) => [{ author: ctx.userId }, { type: input.type }])\n //   .metadata(({ ctx, input }) => ({\n //     extension: input.extension,\n //     role: ctx.userRole,\n //   }))\n //   .beforeUpload(() => {\n //     return true;\n //   });\n // const a = es.imageBucket()\n //   .input(z.object({ type: z.string(), someMeta: z.string().optional() }))\n //   .path(({ ctx, input }) => [{ author: ctx.userId }, { type: input.type }])\n //   .metadata(({ ctx, input }) => ({\n //     role: ctx.userRole,\n //     someMeta: input.someMeta,\n //   }))\n //   .accessControl({\n //     OR: [\n //       {\n //         userId: { path: 'author' }, // this will check if the userId is the same as the author in the path parameter\n //       },\n //       {\n //         userRole: 'admin', // this is the same as { userRole: { eq: \"admin\" } }\n //       },\n //     ],\n //   })\n //   .beforeUpload(({ ctx, input }) => {\n //     return true;\n //   })\n //   .beforeDelete(({ ctx, file }) => {\n //     return true;\n //   });\n // const b = es.imageBucket().path(({ ctx }) => [{ author: ctx.userId }]);\n // const router = es.router({\n //   original: imagesBucket,\n //   imageBucket: a,\n //   imageBucket2: b,\n // });\n // export { router };\n // type ListFilesResponse<TBucket extends AnyRouter['buckets'][string]> = {\n //   data: {\n //     // url: string;\n //     // size: number;\n //     // uploadedAt: Date;\n //     // metadata: InferMetadataObject<TBucket>;\n //     path: InferBucketPathKeys<TBucket> extends string ? {\n //       [key: string]: string;\n //     } :{\n //       [TKey in InferBucketPathKeys<TBucket>]: string;\n //     };\n //   }[];\n //   pagination: {\n //     currentPage: number;\n //     totalPages: number;\n //     totalCount: number;\n //   };\n // };\n // type TPathKeys = 'author' | 'type';\n // type TPathKeys2 = InferBucketPathKeys<AnyBuilder>;\n // type ObjectWithKeys<TKeys extends string> = {\n //   [TKey in TKeys]: string;\n // };\n // type Test1 = ObjectWithKeys<TPathKeys>;\n // type Test2 = ObjectWithKeys<TPathKeys2>;\n // type PathKeys = InferBucketPathKeys<typeof router.buckets.imageBucket>;\n // type MetadataKeys = InferMetadataObject<typeof router.buckets.imageBucket>;\n // type MyEdgeStoreRouter = typeof router;\n // type MyAccessControl = AccessControlSchema<Context, AnyDef>;\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvQGVkZ2VzdG9yZS9zaGFyZWQvZGlzdC9pbmRleC5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBd0I7O0FBRXhCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixhQUFhLEVBQUUsaUNBQWlDLDZCQUE2QixPQUFPLEVBQUUsaUNBQWlDLG1CQUFtQixPQUFPO0FBQ25LO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsT0FBTyxHQUFHLGtCQUFrQjtBQUM5RDtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSxrQ0FBQztBQUNoQjtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrREFBa0Q7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxlQUFlLFlBQVksUUFBUSxvQkFBb0IsSUFBSSxrQkFBa0I7QUFDN0UsbUJBQW1CLFlBQVk7QUFDL0I7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0Esd0JBQXdCLG1EQUFtRDtBQUMzRSxlQUFlLFlBQVksUUFBUSxvQkFBb0IsSUFBSSxrQkFBa0I7QUFDN0UsbUJBQW1CLFlBQVk7QUFDL0I7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQSxzQkFBc0IsZ0JBQWdCO0FBQ3RDLFdBQVc7QUFDWDtBQUNBLHdEQUF3RCxZQUFZO0FBQ3BFLFdBQVc7QUFDWDtBQUNBLE9BQU87QUFDUCx1QkFBdUIsWUFBWTtBQUNuQztBQUNBLE9BQU87QUFDUCx1QkFBdUIsV0FBVztBQUNsQztBQUNBLE9BQU87QUFDUCx1Q0FBdUMsS0FBSyxRQUFRLG9CQUFvQjtBQUN4RTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRTBGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc3RvcmUvLi9ub2RlX21vZHVsZXMvQGVkZ2VzdG9yZS9zaGFyZWQvZGlzdC9pbmRleC5tanM/Y2MzYiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB6IH0gZnJvbSAnem9kJztcblxuZnVuY3Rpb24gX2RlZmluZV9wcm9wZXJ0eSQxKG9iaiwga2V5LCB2YWx1ZSkge1xuICAgIGlmIChrZXkgaW4gb2JqKSB7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwge1xuICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlXG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIG9ialtrZXldID0gdmFsdWU7XG4gICAgfVxuICAgIHJldHVybiBvYmo7XG59XG4vKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tbm9uLW51bGwtYXNzZXJ0aW9uICovIGNvbnN0IEVER0VfU1RPUkVfRVJST1JfQ09ERVMgPSB7XG4gICAgQkFEX1JFUVVFU1Q6IDQwMCxcbiAgICBGSUxFX1RPT19MQVJHRTogNDAwLFxuICAgIE1JTUVfVFlQRV9OT1RfQUxMT1dFRDogNDAwLFxuICAgIFVOQVVUSE9SSVpFRDogNDAxLFxuICAgIFVQTE9BRF9OT1RfQUxMT1dFRDogNDAzLFxuICAgIERFTEVURV9OT1RfQUxMT1dFRDogNDAzLFxuICAgIENSRUFURV9DT05URVhUX0VSUk9SOiA1MDAsXG4gICAgU0VSVkVSX0VSUk9SOiA1MDBcbn07XG5jbGFzcyBFZGdlU3RvcmVFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgICBmb3JtYXR0ZWRNZXNzYWdlKCkge1xuICAgICAgICByZXR1cm4gYCR7dGhpcy5tZXNzYWdlfSR7dGhpcy5kZXRhaWxzID8gYFxcbiAgICBEZXRhaWxzOiAke0pTT04uc3RyaW5naWZ5KHRoaXMuZGV0YWlscyl9YCA6ICcnfSR7dGhpcy5jYXVzZSA/IGBcXG4gICAgQ2F1c2VkIGJ5OiAke3RoaXMuY2F1c2UubWVzc2FnZX1gIDogJyd9YDtcbiAgICB9XG4gICAgZm9ybWF0dGVkSnNvbigpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG1lc3NhZ2U6IHRoaXMuY29kZSA9PT0gJ1NFUlZFUl9FUlJPUicgPyAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyA6IHRoaXMubWVzc2FnZSxcbiAgICAgICAgICAgIGNvZGU6IHRoaXMuY29kZSxcbiAgICAgICAgICAgIGRldGFpbHM6IHRoaXMuZGV0YWlsc1xuICAgICAgICB9O1xuICAgIH1cbiAgICBjb25zdHJ1Y3RvcihvcHRzKXtcbiAgICAgICAgc3VwZXIob3B0cy5tZXNzYWdlKTtcbiAgICAgICAgX2RlZmluZV9wcm9wZXJ0eSQxKHRoaXMsIFwiY2F1c2VcIiwgdm9pZCAwKTtcbiAgICAgICAgX2RlZmluZV9wcm9wZXJ0eSQxKHRoaXMsIFwiY29kZVwiLCB2b2lkIDApO1xuICAgICAgICBfZGVmaW5lX3Byb3BlcnR5JDEodGhpcywgXCJsZXZlbFwiLCB2b2lkIDApO1xuICAgICAgICBfZGVmaW5lX3Byb3BlcnR5JDEodGhpcywgXCJkZXRhaWxzXCIsIHZvaWQgMCk7XG4gICAgICAgIHRoaXMubmFtZSA9ICdFZGdlU3RvcmVFcnJvcic7XG4gICAgICAgIHRoaXMuY29kZSA9IG9wdHMuY29kZTtcbiAgICAgICAgdGhpcy5jYXVzZSA9IG9wdHMuY2F1c2U7XG4gICAgICAgIHRoaXMubGV2ZWwgPSBFREdFX1NUT1JFX0VSUk9SX0NPREVTW29wdHMuY29kZV0gPj0gNTAwID8gJ2Vycm9yJyA6ICd3YXJuJztcbiAgICAgICAgdGhpcy5kZXRhaWxzID0gJ2RldGFpbHMnIGluIG9wdHMgPyBvcHRzLmRldGFpbHMgOiB1bmRlZmluZWQ7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfZGVmaW5lX3Byb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkge1xuICAgIGlmIChrZXkgaW4gb2JqKSB7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwge1xuICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlXG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIG9ialtrZXldID0gdmFsdWU7XG4gICAgfVxuICAgIHJldHVybiBvYmo7XG59XG5jbGFzcyBFZGdlU3RvcmVBcGlDbGllbnRFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgICBjb25zdHJ1Y3RvcihvcHRzKXtcbiAgICAgICAgc3VwZXIob3B0cy5yZXNwb25zZS5tZXNzYWdlKTtcbiAgICAgICAgX2RlZmluZV9wcm9wZXJ0eSh0aGlzLCBcImRhdGFcIiwgdm9pZCAwKTtcbiAgICAgICAgdGhpcy5uYW1lID0gJ0VkZ2VTdG9yZUFwaUNsaWVudEVycm9yJztcbiAgICAgICAgdGhpcy5kYXRhID0gb3B0cy5yZXNwb25zZTtcbiAgICB9XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIFByb3h5IHRoYXQgcHJpbnRzIHRoZSBwYXRoIHRvIHRoZSBwcm9wZXJ0eSB3aGVuIGNhbGxlZC5cbiAqXG4gKiBFeGFtcGxlOlxuICpcbiAqIGBgYHRzXG4gKiBjb25zdCBwYXRoUGFyYW1Qcm94eSA9IGNyZWF0ZVBhdGhQYXJhbVByb3h5KCk7XG4gKiBjb25zb2xlLmxvZyhwYXRoUGFyYW1Qcm94eS5jdHgudXNlci5pZCgpKTtcbiAqIC8vIExvZ3M6IFwiY3R4LnVzZXIuaWRcIlxuICogY29uc29sZS5sb2cocGF0aFBhcmFtUHJveHkuaW5wdXQudHlwZSgpKTtcbiAqIC8vIExvZ3M6IFwiaW5wdXQudHlwZVwiXG4gKiBgYGBcbiAqLyBmdW5jdGlvbiBjcmVhdGVQYXRoUGFyYW1Qcm94eSgpIHtcbiAgICBjb25zdCBnZXRQYXRoID0gKHRhcmdldCwgX3Byb3ApPT57XG4gICAgICAgIGNvbnN0IHByb3h5RnVuY3Rpb24gPSAoKT0+dGFyZ2V0O1xuICAgICAgICByZXR1cm4gbmV3IFByb3h5KHByb3h5RnVuY3Rpb24sIHtcbiAgICAgICAgICAgIGdldDogKF90YXJnZXQsIHByb3BDaGlsZCk9PntcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UGF0aChgJHt0YXJnZXR9LiR7U3RyaW5nKHByb3BDaGlsZCl9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgcmV0dXJuIG5ldyBQcm94eSgoKT0+JycsIHtcbiAgICAgICAgZ2V0OiAoX3RhcmdldCwgcHJvcCk9PntcbiAgICAgICAgICAgIHJldHVybiBnZXRQYXRoKFN0cmluZyhwcm9wKSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cblxuY29uc3QgY3JlYXRlTmV3QnVpbGRlciA9IChpbml0RGVmLCBuZXdEZWYpPT57XG4gICAgY29uc3QgbWVyZ2VkRGVmID0ge1xuICAgICAgICAuLi5pbml0RGVmLFxuICAgICAgICAuLi5uZXdEZWZcbiAgICB9O1xuICAgIHJldHVybiBjcmVhdGVCdWlsZGVyKHtcbiAgICAgICAgdHlwZTogbWVyZ2VkRGVmLnR5cGVcbiAgICB9LCBtZXJnZWREZWYpO1xufTtcbmZ1bmN0aW9uIGNyZWF0ZUJ1aWxkZXIob3B0cywgaW5pdERlZikge1xuICAgIGNvbnN0IF9kZWYgPSB7XG4gICAgICAgIHR5cGU6IG9wdHMudHlwZSxcbiAgICAgICAgaW5wdXQ6IHoubmV2ZXIoKSxcbiAgICAgICAgcGF0aDogW10sXG4gICAgICAgIG1ldGFkYXRhOiAoKT0+KHt9KSxcbiAgICAgICAgLi4uaW5pdERlZlxuICAgIH07XG4gICAgcmV0dXJuIHtcbiAgICAgICAgJGNvbmZpZzoge1xuICAgICAgICAgICAgY3R4OiB1bmRlZmluZWRcbiAgICAgICAgfSxcbiAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciAtIEkgdGhpbmsgaXQgd291bGQgYmUgdG9vIG11Y2ggd29yayB0byBtYWtlIHRoaXMgdHlwZSBjb3JyZWN0LlxuICAgICAgICBfZGVmLFxuICAgICAgICBpbnB1dCAoaW5wdXQpIHtcbiAgICAgICAgICAgIHJldHVybiBjcmVhdGVOZXdCdWlsZGVyKF9kZWYsIHtcbiAgICAgICAgICAgICAgICBpbnB1dFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHBhdGggKHBhdGhSZXNvbHZlcikge1xuICAgICAgICAgICAgLy8gVE9ETzogU2hvdWxkIHRocm93IGEgcnVudGltZSBlcnJvciBpbiB0aGUgZm9sbG93aW5nIGNhc2VzOlxuICAgICAgICAgICAgLy8gMS4gaW4gY2FzZSBvZiBtdWx0aXBsZSBrZXlzIGluIG9uZSBvYmplY3RcbiAgICAgICAgICAgIC8vIDIuIGluIGNhc2Ugb2YgZHVwbGljYXRlIGtleXNcbiAgICAgICAgICAgIGNvbnN0IHBhdGhQYXJhbVByb3h5ID0gY3JlYXRlUGF0aFBhcmFtUHJveHkoKTtcbiAgICAgICAgICAgIGNvbnN0IHBhcmFtcyA9IHBhdGhSZXNvbHZlcihwYXRoUGFyYW1Qcm94eSk7XG4gICAgICAgICAgICByZXR1cm4gY3JlYXRlTmV3QnVpbGRlcihfZGVmLCB7XG4gICAgICAgICAgICAgICAgcGF0aDogcGFyYW1zXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgbWV0YWRhdGEgKG1ldGFkYXRhKSB7XG4gICAgICAgICAgICByZXR1cm4gY3JlYXRlTmV3QnVpbGRlcihfZGVmLCB7XG4gICAgICAgICAgICAgICAgbWV0YWRhdGFcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICBhY2Nlc3NDb250cm9sIChhY2Nlc3NDb250cm9sKSB7XG4gICAgICAgICAgICByZXR1cm4gY3JlYXRlTmV3QnVpbGRlcihfZGVmLCB7XG4gICAgICAgICAgICAgICAgYWNjZXNzQ29udHJvbDogYWNjZXNzQ29udHJvbFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIGJlZm9yZVVwbG9hZCAoYmVmb3JlVXBsb2FkKSB7XG4gICAgICAgICAgICByZXR1cm4gY3JlYXRlTmV3QnVpbGRlcihfZGVmLCB7XG4gICAgICAgICAgICAgICAgYmVmb3JlVXBsb2FkXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgYmVmb3JlRGVsZXRlIChiZWZvcmVEZWxldGUpIHtcbiAgICAgICAgICAgIHJldHVybiBjcmVhdGVOZXdCdWlsZGVyKF9kZWYsIHtcbiAgICAgICAgICAgICAgICBiZWZvcmVEZWxldGVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbn1cbmNsYXNzIEVkZ2VTdG9yZUJ1aWxkZXIge1xuICAgIGNvbnRleHQoKSB7XG4gICAgICAgIHJldHVybiBuZXcgRWRnZVN0b3JlQnVpbGRlcigpO1xuICAgIH1cbiAgICBjcmVhdGUoKSB7XG4gICAgICAgIHJldHVybiBjcmVhdGVFZGdlU3RvcmVJbm5lcigpKCk7XG4gICAgfVxufVxuZnVuY3Rpb24gY3JlYXRlUm91dGVyRmFjdG9yeSgpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gY3JlYXRlUm91dGVySW5uZXIoYnVja2V0cykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgJGNvbmZpZzoge1xuICAgICAgICAgICAgICAgIGN0eDogdW5kZWZpbmVkXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYnVja2V0c1xuICAgICAgICB9O1xuICAgIH07XG59XG5mdW5jdGlvbiBpbml0QnVja2V0KHR5cGUsIGNvbmZpZykge1xuICAgIHJldHVybiBjcmVhdGVCdWlsZGVyKHtcbiAgICAgICAgdHlwZVxuICAgIH0sIHtcbiAgICAgICAgYnVja2V0Q29uZmlnOiBjb25maWdcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZUVkZ2VTdG9yZUlubmVyKCkge1xuICAgIHJldHVybiBmdW5jdGlvbiBpbml0RWRnZVN0b3JlSW5uZXIoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAvKipcbiAgICAgICAqIEJ1aWxkZXIgb2JqZWN0IGZvciBjcmVhdGluZyBhbiBpbWFnZSBidWNrZXRcbiAgICAgICAqLyBpbWFnZUJ1Y2tldCAoY29uZmlnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGluaXRCdWNrZXQoJ0lNQUdFJywgY29uZmlnKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvKipcbiAgICAgICAqIEJ1aWxkZXIgb2JqZWN0IGZvciBjcmVhdGluZyBhIGZpbGUgYnVja2V0XG4gICAgICAgKi8gZmlsZUJ1Y2tldCAoY29uZmlnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGluaXRCdWNrZXQoJ0ZJTEUnLCBjb25maWcpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8qKlxuICAgICAgICogQ3JlYXRlIGEgcm91dGVyXG4gICAgICAgKi8gcm91dGVyOiBjcmVhdGVSb3V0ZXJGYWN0b3J5KClcbiAgICAgICAgfTtcbiAgICB9O1xufVxuLyoqXG4gKiBJbml0aWFsaXplIEVkZ2VTdG9yZSAtIGJlIGRvbmUgZXhhY3RseSBvbmNlIHBlciBiYWNrZW5kXG4gKi8gY29uc3QgaW5pdEVkZ2VTdG9yZSA9IG5ldyBFZGdlU3RvcmVCdWlsZGVyKCk7IC8vIOKGk+KGk+KGkyBUWVBFIFRFU1RTIOKGk+KGk+KGk1xuIC8vIHR5cGUgQ29udGV4dCA9IHtcbiAvLyAgIHVzZXJJZDogc3RyaW5nO1xuIC8vICAgdXNlclJvbGU6ICdhZG1pbicgfCAndmlzaXRvcic7XG4gLy8gfTtcbiAvLyBjb25zdCBlcyA9IGluaXRFZGdlU3RvcmUuY29udGV4dDxDb250ZXh0PigpLmNyZWF0ZSgpO1xuIC8vIGNvbnN0IGltYWdlc0J1Y2tldCA9IGVzLmltYWdlQnVja2V0KClcbiAvLyAgIC5pbnB1dChcbiAvLyAgICAgei5vYmplY3Qoe1xuIC8vICAgICAgIHR5cGU6IHouZW51bShbJ3Byb2ZpbGUnLCAncG9zdCddKSxcbiAvLyAgICAgICBleHRlbnNpb246IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAvLyAgICAgfSksXG4gLy8gICApXG4gLy8gICAucGF0aCgoeyBjdHgsIGlucHV0IH0pID0+IFt7IGF1dGhvcjogY3R4LnVzZXJJZCB9LCB7IHR5cGU6IGlucHV0LnR5cGUgfV0pXG4gLy8gICAubWV0YWRhdGEoKHsgY3R4LCBpbnB1dCB9KSA9PiAoe1xuIC8vICAgICBleHRlbnNpb246IGlucHV0LmV4dGVuc2lvbixcbiAvLyAgICAgcm9sZTogY3R4LnVzZXJSb2xlLFxuIC8vICAgfSkpXG4gLy8gICAuYmVmb3JlVXBsb2FkKCgpID0+IHtcbiAvLyAgICAgcmV0dXJuIHRydWU7XG4gLy8gICB9KTtcbiAvLyBjb25zdCBhID0gZXMuaW1hZ2VCdWNrZXQoKVxuIC8vICAgLmlucHV0KHoub2JqZWN0KHsgdHlwZTogei5zdHJpbmcoKSwgc29tZU1ldGE6IHouc3RyaW5nKCkub3B0aW9uYWwoKSB9KSlcbiAvLyAgIC5wYXRoKCh7IGN0eCwgaW5wdXQgfSkgPT4gW3sgYXV0aG9yOiBjdHgudXNlcklkIH0sIHsgdHlwZTogaW5wdXQudHlwZSB9XSlcbiAvLyAgIC5tZXRhZGF0YSgoeyBjdHgsIGlucHV0IH0pID0+ICh7XG4gLy8gICAgIHJvbGU6IGN0eC51c2VyUm9sZSxcbiAvLyAgICAgc29tZU1ldGE6IGlucHV0LnNvbWVNZXRhLFxuIC8vICAgfSkpXG4gLy8gICAuYWNjZXNzQ29udHJvbCh7XG4gLy8gICAgIE9SOiBbXG4gLy8gICAgICAge1xuIC8vICAgICAgICAgdXNlcklkOiB7IHBhdGg6ICdhdXRob3InIH0sIC8vIHRoaXMgd2lsbCBjaGVjayBpZiB0aGUgdXNlcklkIGlzIHRoZSBzYW1lIGFzIHRoZSBhdXRob3IgaW4gdGhlIHBhdGggcGFyYW1ldGVyXG4gLy8gICAgICAgfSxcbiAvLyAgICAgICB7XG4gLy8gICAgICAgICB1c2VyUm9sZTogJ2FkbWluJywgLy8gdGhpcyBpcyB0aGUgc2FtZSBhcyB7IHVzZXJSb2xlOiB7IGVxOiBcImFkbWluXCIgfSB9XG4gLy8gICAgICAgfSxcbiAvLyAgICAgXSxcbiAvLyAgIH0pXG4gLy8gICAuYmVmb3JlVXBsb2FkKCh7IGN0eCwgaW5wdXQgfSkgPT4ge1xuIC8vICAgICByZXR1cm4gdHJ1ZTtcbiAvLyAgIH0pXG4gLy8gICAuYmVmb3JlRGVsZXRlKCh7IGN0eCwgZmlsZSB9KSA9PiB7XG4gLy8gICAgIHJldHVybiB0cnVlO1xuIC8vICAgfSk7XG4gLy8gY29uc3QgYiA9IGVzLmltYWdlQnVja2V0KCkucGF0aCgoeyBjdHggfSkgPT4gW3sgYXV0aG9yOiBjdHgudXNlcklkIH1dKTtcbiAvLyBjb25zdCByb3V0ZXIgPSBlcy5yb3V0ZXIoe1xuIC8vICAgb3JpZ2luYWw6IGltYWdlc0J1Y2tldCxcbiAvLyAgIGltYWdlQnVja2V0OiBhLFxuIC8vICAgaW1hZ2VCdWNrZXQyOiBiLFxuIC8vIH0pO1xuIC8vIGV4cG9ydCB7IHJvdXRlciB9O1xuIC8vIHR5cGUgTGlzdEZpbGVzUmVzcG9uc2U8VEJ1Y2tldCBleHRlbmRzIEFueVJvdXRlclsnYnVja2V0cyddW3N0cmluZ10+ID0ge1xuIC8vICAgZGF0YToge1xuIC8vICAgICAvLyB1cmw6IHN0cmluZztcbiAvLyAgICAgLy8gc2l6ZTogbnVtYmVyO1xuIC8vICAgICAvLyB1cGxvYWRlZEF0OiBEYXRlO1xuIC8vICAgICAvLyBtZXRhZGF0YTogSW5mZXJNZXRhZGF0YU9iamVjdDxUQnVja2V0PjtcbiAvLyAgICAgcGF0aDogSW5mZXJCdWNrZXRQYXRoS2V5czxUQnVja2V0PiBleHRlbmRzIHN0cmluZyA/IHtcbiAvLyAgICAgICBba2V5OiBzdHJpbmddOiBzdHJpbmc7XG4gLy8gICAgIH0gOntcbiAvLyAgICAgICBbVEtleSBpbiBJbmZlckJ1Y2tldFBhdGhLZXlzPFRCdWNrZXQ+XTogc3RyaW5nO1xuIC8vICAgICB9O1xuIC8vICAgfVtdO1xuIC8vICAgcGFnaW5hdGlvbjoge1xuIC8vICAgICBjdXJyZW50UGFnZTogbnVtYmVyO1xuIC8vICAgICB0b3RhbFBhZ2VzOiBudW1iZXI7XG4gLy8gICAgIHRvdGFsQ291bnQ6IG51bWJlcjtcbiAvLyAgIH07XG4gLy8gfTtcbiAvLyB0eXBlIFRQYXRoS2V5cyA9ICdhdXRob3InIHwgJ3R5cGUnO1xuIC8vIHR5cGUgVFBhdGhLZXlzMiA9IEluZmVyQnVja2V0UGF0aEtleXM8QW55QnVpbGRlcj47XG4gLy8gdHlwZSBPYmplY3RXaXRoS2V5czxUS2V5cyBleHRlbmRzIHN0cmluZz4gPSB7XG4gLy8gICBbVEtleSBpbiBUS2V5c106IHN0cmluZztcbiAvLyB9O1xuIC8vIHR5cGUgVGVzdDEgPSBPYmplY3RXaXRoS2V5czxUUGF0aEtleXM+O1xuIC8vIHR5cGUgVGVzdDIgPSBPYmplY3RXaXRoS2V5czxUUGF0aEtleXMyPjtcbiAvLyB0eXBlIFBhdGhLZXlzID0gSW5mZXJCdWNrZXRQYXRoS2V5czx0eXBlb2Ygcm91dGVyLmJ1Y2tldHMuaW1hZ2VCdWNrZXQ+O1xuIC8vIHR5cGUgTWV0YWRhdGFLZXlzID0gSW5mZXJNZXRhZGF0YU9iamVjdDx0eXBlb2Ygcm91dGVyLmJ1Y2tldHMuaW1hZ2VCdWNrZXQ+O1xuIC8vIHR5cGUgTXlFZGdlU3RvcmVSb3V0ZXIgPSB0eXBlb2Ygcm91dGVyO1xuIC8vIHR5cGUgTXlBY2Nlc3NDb250cm9sID0gQWNjZXNzQ29udHJvbFNjaGVtYTxDb250ZXh0LCBBbnlEZWY+O1xuXG5leHBvcnQgeyBFREdFX1NUT1JFX0VSUk9SX0NPREVTLCBFZGdlU3RvcmVBcGlDbGllbnRFcnJvciwgRWRnZVN0b3JlRXJyb3IsIGluaXRFZGdlU3RvcmUgfTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/@edgestore/shared/dist/index.mjs\n");

/***/ })

};
;